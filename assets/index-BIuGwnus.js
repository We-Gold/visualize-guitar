(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const Fo="15.1.22",Ai=(n,t,e)=>({endTime:t,insertTime:e,type:"exponentialRampToValue",value:n}),Ni=(n,t,e)=>({endTime:t,insertTime:e,type:"linearRampToValue",value:n}),lr=(n,t)=>({startTime:t,type:"setValue",value:n}),Ro=(n,t,e)=>({duration:e,startTime:t,type:"setValueCurve",values:n}),Vo=(n,t,{startTime:e,target:s,timeConstant:r})=>s+(t-s)*Math.exp((e-n)/r),qe=n=>n.type==="exponentialRampToValue",as=n=>n.type==="linearRampToValue",ue=n=>qe(n)||as(n),Er=n=>n.type==="setValue",Kt=n=>n.type==="setValueCurve",cs=(n,t,e,s)=>{const r=n[t];return r===void 0?s:ue(r)||Er(r)?r.value:Kt(r)?r.values[r.values.length-1]:Vo(e,cs(n,t-1,r.startTime,s),r)},Ii=(n,t,e,s,r)=>e===void 0?[s.insertTime,r]:ue(e)?[e.endTime,e.value]:Er(e)?[e.startTime,e.value]:Kt(e)?[e.startTime+e.duration,e.values[e.values.length-1]]:[e.startTime,cs(n,t-1,e.startTime,r)],hr=n=>n.type==="cancelAndHold",fr=n=>n.type==="cancelScheduledValues",ce=n=>hr(n)||fr(n)?n.cancelTime:qe(n)||as(n)?n.endTime:n.startTime,Mi=(n,t,e,{endTime:s,value:r})=>e===r?r:0<e&&0<r||e<0&&r<0?e*(r/e)**((n-t)/(s-t)):0,Oi=(n,t,e,{endTime:s,value:r})=>e+(n-t)/(s-t)*(r-e),Ac=(n,t)=>{const e=Math.floor(t),s=Math.ceil(t);return e===s?n[e]:(1-(t-e))*n[e]+(1-(s-t))*n[s]},Nc=(n,{duration:t,startTime:e,values:s})=>{const r=(n-e)/t*(s.length-1);return Ac(s,r)},zn=n=>n.type==="setTarget";class Ic{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=ce(t);if(hr(t)||fr(t)){const s=this._automationEvents.findIndex(i=>fr(t)&&Kt(i)?i.startTime+i.duration>=e:ce(i)>=e),r=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),hr(t)){const i=this._automationEvents[this._automationEvents.length-1];if(r!==void 0&&ue(r)){if(i!==void 0&&zn(i))throw new Error("The internal list is malformed.");const o=i===void 0?r.insertTime:Kt(i)?i.startTime+i.duration:ce(i),a=i===void 0?this._defaultValue:Kt(i)?i.values[i.values.length-1]:i.value,c=qe(r)?Mi(e,o,a,r):Oi(e,o,a,r),u=qe(r)?Ai(c,e,this._currenTime):Ni(c,e,this._currenTime);this._automationEvents.push(u)}if(i!==void 0&&zn(i)&&this._automationEvents.push(lr(this.getValue(e),e)),i!==void 0&&Kt(i)&&i.startTime+i.duration>e){const o=e-i.startTime,a=(i.values.length-1)/i.duration,c=Math.max(2,1+Math.ceil(o*a)),u=o/(c-1)*a,l=i.values.slice(0,c);if(u<1)for(let h=1;h<c;h+=1){const f=u*h%1;l[h]=i.values[h-1]*(1-f)+i.values[h]*f}this._automationEvents[this._automationEvents.length-1]=Ro(l,i.startTime,o)}}}else{const s=this._automationEvents.findIndex(o=>ce(o)>e),r=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(r!==void 0&&Kt(r)&&ce(r)+r.duration>e)return!1;const i=qe(t)?Ai(t.value,t.endTime,this._currenTime):as(t)?Ni(t.value,e,this._currenTime):t;if(s===-1)this._automationEvents.push(i);else{if(Kt(t)&&e+t.duration>ce(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,i)}}return!0}flush(t){const e=this._automationEvents.findIndex(s=>ce(s)>t);if(e>1){const s=this._automationEvents.slice(e-1),r=s[0];zn(r)&&s.unshift(lr(cs(this._automationEvents,e-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=s}}getValue(t){if(this._automationEvents.length===0)return this._defaultValue;const e=this._automationEvents.findIndex(o=>ce(o)>t),s=this._automationEvents[e],r=(e===-1?this._automationEvents.length:e)-1,i=this._automationEvents[r];if(i!==void 0&&zn(i)&&(s===void 0||!ue(s)||s.insertTime>t))return Vo(t,cs(this._automationEvents,r-1,i.startTime,this._defaultValue),i);if(i!==void 0&&Er(i)&&(s===void 0||!ue(s)))return i.value;if(i!==void 0&&Kt(i)&&(s===void 0||!ue(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?Nc(t,i):i.values[i.values.length-1];if(i!==void 0&&ue(i)&&(s===void 0||!ue(s)))return i.value;if(s!==void 0&&qe(s)){const[o,a]=Ii(this._automationEvents,r,i,s,this._defaultValue);return Mi(t,o,a,s)}if(s!==void 0&&as(s)){const[o,a]=Ii(this._automationEvents,r,i,s,this._defaultValue);return Oi(t,o,a,s)}return this._defaultValue}}const Mc=n=>({cancelTime:n,type:"cancelAndHold"}),Oc=n=>({cancelTime:n,type:"cancelScheduledValues"}),Ec=(n,t)=>({endTime:t,type:"exponentialRampToValue",value:n}),Dc=(n,t)=>({endTime:t,type:"linearRampToValue",value:n}),Pc=(n,t,e)=>({startTime:t,target:n,timeConstant:e,type:"setTarget"}),Fc=()=>new DOMException("","AbortError"),Rc=n=>(t,e,[s,r,i],o)=>{n(t[r],[e,s,i],a=>a[0]===e&&a[1]===s,o)},Vc=n=>(t,e,s)=>{const r=[];for(let i=0;i<s.numberOfInputs;i+=1)r.push(new Set);n.set(t,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:e})},qc=n=>(t,e)=>{n.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})},ze=new WeakSet,qo=new WeakMap,Dr=new WeakMap,Uo=new WeakMap,Pr=new WeakMap,Ds=new WeakMap,Lo=new WeakMap,dr=new WeakMap,pr=new WeakMap,mr=new WeakMap,Bo={construct(){return Bo}},Uc=n=>{try{const t=new Proxy(n,Bo);new t}catch{return!1}return!0},Ei=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Di=(n,t)=>{const e=[];let s=n.replace(/^[\s]+/,""),r=s.match(Ei);for(;r!==null;){const i=r[1].slice(1,-1),o=r[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());e.push(o),s=s.slice(r[0].length).replace(/^[\s]+/,""),r=s.match(Ei)}return[e.join(";"),s]},Pi=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Fi=n=>{if(!Uc(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Lc=(n,t,e,s,r,i,o,a,c,u,l,h,f)=>{let d=0;return(p,m,g={credentials:"omit"})=>{const _=l.get(p);if(_!==void 0&&_.has(m))return Promise.resolve();const w=u.get(p);if(w!==void 0){const y=w.get(m);if(y!==void 0)return y}const T=i(p),v=T.audioWorklet===void 0?r(m).then(([y,b])=>{const[S,x]=Di(y,b),N=`${S};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${x}
})})(window,'_AWGS')`;return e(N)}).then(()=>{const y=f._AWGS.pop();if(y===void 0)throw new SyntaxError;s(T.currentTime,T.sampleRate,()=>y(class{},void 0,(b,S)=>{if(b.trim()==="")throw t();const x=pr.get(T);if(x!==void 0){if(x.has(b))throw t();Fi(S),Pi(S.parameterDescriptors),x.set(b,S)}else Fi(S),Pi(S.parameterDescriptors),pr.set(T,new Map([[b,S]]))},T.sampleRate,void 0,void 0))}):Promise.all([r(m),Promise.resolve(n(h,h))]).then(([[y,b],S])=>{const x=d+1;d=x;const[N,A]=Di(y,b),I=`${N};((AudioWorkletProcessor,registerProcessor)=>{${A}
})(${S?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${S?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${S?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${x}',class extends AudioWorkletProcessor{process(){return !1}})`,P=new Blob([I],{type:"application/javascript; charset=utf-8"}),E=URL.createObjectURL(P);return T.audioWorklet.addModule(E,g).then(()=>{if(a(T))return T;const D=o(T);return D.audioWorklet.addModule(E,g).then(()=>D)}).then(D=>{if(c===null)throw new SyntaxError;try{new c(D,`__sac${x}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(E))});return w===void 0?u.set(p,new Map([[m,v]])):w.set(m,v),v.then(()=>{const y=l.get(p);y===void 0?l.set(p,new Set([m])):y.add(m)}).finally(()=>{const y=u.get(p);y!==void 0&&y.delete(m)}),v}},Lt=(n,t)=>{const e=n.get(t);if(e===void 0)throw new Error("A value with the given key could not be found.");return e},Ps=(n,t)=>{const e=Array.from(n).filter(t);if(e.length>1)throw Error("More than one element was found.");if(e.length===0)throw Error("No element was found.");const[s]=e;return n.delete(s),s},Wo=(n,t,e,s)=>{const r=Lt(n,t),i=Ps(r,o=>o[0]===e&&o[1]===s);return r.size===0&&n.delete(t),i},Mn=n=>Lt(Lo,n),Ge=n=>{if(ze.has(n))throw new Error("The AudioNode is already stored.");ze.add(n),Mn(n).forEach(t=>t(!0))},$o=n=>"port"in n,On=n=>{if(!ze.has(n))throw new Error("The AudioNode is not stored.");ze.delete(n),Mn(n).forEach(t=>t(!1))},gr=(n,t)=>{!$o(n)&&t.every(e=>e.size===0)&&On(n)},Bc=(n,t,e,s,r,i,o,a,c,u,l,h,f)=>{const d=new WeakMap;return(p,m,g,_,w)=>{const{activeInputs:T,passiveInputs:v}=i(m),{outputs:y}=i(p),b=a(p),S=x=>{const N=c(m),A=c(p);if(x){const k=Wo(v,p,g,_);n(T,p,k,!1),!w&&!h(p)&&e(A,N,g,_),f(m)&&Ge(m)}else{const k=s(T,p,g,_);t(v,_,k,!1),!w&&!h(p)&&r(A,N,g,_);const C=o(m);if(C===0)l(m)&&gr(m,T);else{const M=d.get(m);M!==void 0&&clearTimeout(M),d.set(m,setTimeout(()=>{l(m)&&gr(m,T)},C*1e3))}}};return u(y,[m,g,_],x=>x[0]===m&&x[1]===g&&x[2]===_,!0)?(b.add(S),l(p)?n(T,p,[g,_,S],!0):t(v,_,[p,g,S],!0),!0):!1}},Wc=n=>(t,e,[s,r,i],o)=>{const a=t.get(s);a===void 0?t.set(s,new Set([[r,e,i]])):n(a,[r,e,i],c=>c[0]===r&&c[1]===e,o)},$c=n=>(t,e)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(t.destination);const r=()=>{e.removeEventListener("ended",r),e.disconnect(s),s.disconnect()};e.addEventListener("ended",r)},jc=n=>(t,e)=>{n(t).add(e)},zc={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Gc=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=r(a),l={...zc,...c},h=s(u,l),f=i(u)?t():null;super(a,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,e()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,e()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},gt=(n,t)=>n.context===t,Xc=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=t(i);if(!gt(a,o)){const u={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,u)}return s.set(o,a),await e(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},us=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Xt=()=>new DOMException("","IndexSizeError"),Fr=n=>{n.getChannelData=(t=>e=>{try{return t.call(n,e)}catch(s){throw s.code===12?Xt():s}})(n.getChannelData)},Hc={numberOfChannels:1},Yc=(n,t,e,s,r,i,o,a)=>{let c=null;return class jo{constructor(l){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}={...Hc,...l};c===null&&(c=new r(1,1,44100));const p=s!==null&&t(i,i)?new s({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(p.numberOfChannels===0)throw e();return typeof p.copyFromChannel!="function"?(o(p),Fr(p)):t(us,()=>us(p))||a(p),n.add(p),p}static[Symbol.hasInstance](l){return l!==null&&typeof l=="object"&&Object.getPrototypeOf(l)===jo.prototype||n.has(l)}}},bt=-34028234663852886e22,yt=-bt,te=n=>ze.has(n),Zc={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Qc=(n,t,e,s,r,i,o,a)=>class extends n{constructor(u,l){const h=i(u),f={...Zc,...l},d=r(h,f),p=o(h),m=p?t():null;super(u,!1,d,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=e(this,p,d.playbackRate,yt,bt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(u){if(this._nativeAudioBufferSourceNode.buffer=u,u!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(u){this._nativeAudioBufferSourceNode.loop=u}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(u){this._nativeAudioBufferSourceNode.loopEnd=u}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(u){this._nativeAudioBufferSourceNode.loopStart=u}get onended(){return this._onended}set onended(u){const l=typeof u=="function"?a(this,u):null;this._nativeAudioBufferSourceNode.onended=l;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===l?u:h}get playbackRate(){return this._playbackRate}start(u=0,l=0,h){if(this._nativeAudioBufferSourceNode.start(u,l,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[u,l]:[u,l,h]),this.context.state!=="closed"){Ge(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),te(this)&&On(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(u=0){this._nativeAudioBufferSourceNode.stop(u),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=u)}},Jc=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(u,l)=>{let h=e(u);const f=gt(h,l);if(!f){const d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=t(l,d),o!==null&&h.start(...o),a!==null&&h.stop(a)}return i.set(l,h),f?await n(l,u.playbackRate,h.playbackRate):await s(l,u.playbackRate,h.playbackRate),await r(u,l,h),h};return{set start(u){o=u},set stop(u){a=u},render(u,l){const h=i.get(l);return h!==void 0?Promise.resolve(h):c(u,l)}}},Kc=n=>"playbackRate"in n,tu=n=>"frequency"in n&&"gain"in n,eu=n=>"offset"in n,nu=n=>!("frequency"in n)&&"gain"in n,su=n=>"detune"in n&&"frequency"in n&&!("gain"in n),ru=n=>"pan"in n,vt=n=>Lt(qo,n),En=n=>Lt(Uo,n),_r=(n,t)=>{const{activeInputs:e}=vt(n);e.forEach(r=>r.forEach(([i])=>{t.includes(n)||_r(i,[...t,n])}));const s=Kc(n)?[n.playbackRate]:$o(n)?Array.from(n.parameters.values()):tu(n)?[n.Q,n.detune,n.frequency,n.gain]:eu(n)?[n.offset]:nu(n)?[n.gain]:su(n)?[n.detune,n.frequency]:ru(n)?[n.pan]:[];for(const r of s){const i=En(r);i!==void 0&&i.activeInputs.forEach(([o])=>_r(o,t))}te(n)&&On(n)},zo=n=>{_r(n.destination,[])},iu=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),ou=(n,t,e,s,r,i,o,a,c)=>class extends n{constructor(l={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(l)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?e():p}if(h===null)throw s();if(!iu(l.latencyHint))throw new TypeError(`The provided value '${l.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(l.sampleRate!==void 0&&h.sampleRate!==l.sampleRate)throw e();super(h,2);const{latencyHint:f}=l,{sampleRate:d}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/d:f==="interactive"||f===void 0?256/d:f==="playback"?1024/d:Math.max(2,Math.min(128,Math.round(f*d/128)))*128/d,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),zo(this)}))}createMediaElementSource(l){return new r(this,{mediaElement:l})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(l){return new o(this,{mediaStream:l})}createMediaStreamTrackSource(l){return new a(this,{mediaStreamTrack:l})}resume(){return this._state==="suspended"?new Promise((l,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?l():this.resume().then(l,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(l=>{throw l===void 0||l.code===15?t():l})}suspend(){return this._nativeAudioContext.suspend().catch(l=>{throw l===void 0?t():l})}},au=(n,t,e,s,r,i,o,a)=>class extends n{constructor(u,l){const h=i(u),f=o(h),d=r(h,l,f),p=f?t(a):null;super(u,!1,d,p),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(u){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(u>this._nativeAudioDestinationNode.maxChannelCount)throw e();this._nativeAudioDestinationNode.channelCount=u}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(u){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=u}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},cu=n=>{const t=new WeakMap,e=async(s,r)=>{const i=r.destination;return t.set(r,i),await n(s,r,i),i};return{render(s,r){const i=t.get(r);return i!==void 0?Promise.resolve(i):e(s,r)}}},uu=(n,t,e,s,r,i,o,a)=>(c,u)=>{const l=u.listener,h=()=>{const y=new Float32Array(1),b=t(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),S=o(u);let x=!1,N=[0,0,-1,0,1,0],A=[0,0,0];const k=()=>{if(x)return;x=!0;const P=s(u,256,9,0);P.onaudioprocess=({inputBuffer:E})=>{const D=[i(E,y,0),i(E,y,1),i(E,y,2),i(E,y,3),i(E,y,4),i(E,y,5)];D.some((F,R)=>F!==N[R])&&(l.setOrientation(...D),N=D);const $=[i(E,y,6),i(E,y,7),i(E,y,8)];$.some((F,R)=>F!==A[R])&&(l.setPosition(...$),A=$)},b.connect(P)},C=P=>E=>{E!==N[P]&&(N[P]=E,l.setOrientation(...N))},M=P=>E=>{E!==A[P]&&(A[P]=E,l.setPosition(...A))},I=(P,E,D)=>{const $=e(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:E});$.connect(b,0,P),$.start(),Object.defineProperty($.offset,"defaultValue",{get(){return E}});const F=n({context:c},S,$.offset,yt,bt);return a(F,"value",R=>()=>R.call(F),R=>B=>{try{R.call(F,B)}catch(X){if(X.code!==9)throw X}k(),S&&D(B)}),F.cancelAndHoldAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.cancelAndHoldAtTime),F.cancelScheduledValues=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.cancelScheduledValues),F.exponentialRampToValueAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.exponentialRampToValueAtTime),F.linearRampToValueAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.linearRampToValueAtTime),F.setTargetAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.setTargetAtTime),F.setValueAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.setValueAtTime),F.setValueCurveAtTime=(R=>S?()=>{throw r()}:(...B)=>{const X=R.apply(F,B);return k(),X})(F.setValueCurveAtTime),F};return{forwardX:I(0,0,C(0)),forwardY:I(1,0,C(1)),forwardZ:I(2,-1,C(2)),positionX:I(6,0,M(0)),positionY:I(7,0,M(1)),positionZ:I(8,0,M(2)),upX:I(3,0,C(3)),upY:I(4,1,C(4)),upZ:I(5,0,C(5))}},{forwardX:f,forwardY:d,forwardZ:p,positionX:m,positionY:g,positionZ:_,upX:w,upY:T,upZ:v}=l.forwardX===void 0?h():l;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return p},get positionX(){return m},get positionY(){return g},get positionZ(){return _},get upX(){return w},get upY(){return T},get upZ(){return v}}},ls=n=>"context"in n,Dn=n=>ls(n[0]),Oe=(n,t,e,s)=>{for(const r of n)if(e(r)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(t),!0},Ri=(n,t,[e,s],r)=>{Oe(n,[t,e,s],i=>i[0]===t&&i[1]===e,r)},Vi=(n,[t,e,s],r)=>{const i=n.get(t);i===void 0?n.set(t,new Set([[e,s]])):Oe(i,[e,s],o=>o[0]===e,r)},nn=n=>"inputs"in n,hs=(n,t,e,s)=>{if(nn(t)){const r=t.inputs[s];return n.connect(r,e,0),[r,e,0]}return n.connect(t,e,s),[t,e,s]},Go=(n,t,e)=>{for(const s of n)if(s[0]===t&&s[1]===e)return n.delete(s),s;return null},lu=(n,t,e)=>Ps(n,s=>s[0]===t&&s[1]===e),Xo=(n,t)=>{if(!Mn(n).delete(t))throw new Error("Missing the expected event listener.")},Ho=(n,t,e)=>{const s=Lt(n,t),r=Ps(s,i=>i[0]===e);return s.size===0&&n.delete(t),r},fs=(n,t,e,s)=>{nn(t)?n.disconnect(t.inputs[s],e,0):n.disconnect(t,e,s)},K=n=>Lt(Dr,n),xn=n=>Lt(Pr,n),ke=n=>dr.has(n),ts=n=>!ze.has(n),qi=(n,t)=>new Promise(e=>{if(t!==null)e(!0);else{const s=n.createScriptProcessor(256,1,1),r=n.createGain(),i=n.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=i,a.loop=!0,a.connect(s).connect(n.destination),a.connect(r),a.disconnect(r),s.onaudioprocess=c=>{const u=c.inputBuffer.getChannelData(0);Array.prototype.some.call(u,l=>l===1)?e(!0):e(!1),a.stop(),s.onaudioprocess=null,a.disconnect(s),s.disconnect(n.destination)},a.start()}}),er=(n,t)=>{const e=new Map;for(const s of n)for(const r of s){const i=e.get(r);e.set(r,i===void 0?1:i+1)}e.forEach((s,r)=>t(r,s))},ds=n=>"context"in n,hu=n=>{const t=new Map;n.connect=(e=>(s,r=0,i=0)=>{const o=ds(s)?e(s,r,i):e(s,r),a=t.get(s);return a===void 0?t.set(s,[{input:i,output:r}]):a.every(c=>c.input!==i||c.output!==r)&&a.push({input:i,output:r}),o})(n.connect.bind(n)),n.disconnect=(e=>(s,r,i)=>{if(e.apply(n),s===void 0)t.clear();else if(typeof s=="number")for(const[o,a]of t){const c=a.filter(u=>u.output!==s);c.length===0?t.delete(o):t.set(o,c)}else if(t.has(s))if(r===void 0)t.delete(s);else{const o=t.get(s);if(o!==void 0){const a=o.filter(c=>c.output!==r&&(c.input!==i||i===void 0));a.length===0?t.delete(s):t.set(s,a)}}for(const[o,a]of t)a.forEach(c=>{ds(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},fu=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=En(t),{outputs:o}=vt(n),a=Mn(n),c=u=>{const l=K(n),h=xn(t);if(u){const f=Ho(i,n,e);Ri(r,n,f,!1),!s&&!ke(n)&&l.connect(h,e)}else{const f=lu(r,n,e);Vi(i,f,!1),!s&&!ke(n)&&l.disconnect(h,e)}};return Oe(o,[t,e],u=>u[0]===t&&u[1]===e,!0)?(a.add(c),te(n)?Ri(r,n,[e,c],!0):Vi(i,[n,e,c],!0),!0):!1},du=(n,t,e,s)=>{const{activeInputs:r,passiveInputs:i}=vt(t),o=Go(r[s],n,e);return o===null?[Wo(i,n,e,s)[2],!1]:[o[2],!0]},pu=(n,t,e)=>{const{activeInputs:s,passiveInputs:r}=En(t),i=Go(s,n,e);return i===null?[Ho(r,n,e)[1],!1]:[i[2],!0]},Rr=(n,t,e,s,r)=>{const[i,o]=du(n,e,s,r);if(i!==null&&(Xo(n,i),o&&!t&&!ke(n)&&fs(K(n),K(e),s,r)),te(e)){const{activeInputs:a}=vt(e);gr(e,a)}},Vr=(n,t,e,s)=>{const[r,i]=pu(n,e,s);r!==null&&(Xo(n,r),i&&!t&&!ke(n)&&K(n).disconnect(xn(e),s))},mu=(n,t)=>{const e=vt(n),s=[];for(const r of e.outputs)Dn(r)?Rr(n,t,...r):Vr(n,t,...r),s.push(r[0]);return e.outputs.clear(),s},gu=(n,t,e)=>{const s=vt(n),r=[];for(const i of s.outputs)i[1]===e&&(Dn(i)?Rr(n,t,...i):Vr(n,t,...i),r.push(i[0]),s.outputs.delete(i));return r},_u=(n,t,e,s,r)=>{const i=vt(n);return Array.from(i.outputs).filter(o=>o[0]===e&&(s===void 0||o[1]===s)&&(r===void 0||o[2]===r)).map(o=>(Dn(o)?Rr(n,t,...o):Vr(n,t,...o),i.outputs.delete(o),o[0]))},yu=(n,t,e,s,r,i,o,a,c,u,l,h,f,d,p,m)=>class extends u{constructor(_,w,T,v){super(T),this._context=_,this._nativeAudioNode=T;const y=l(_);h(y)&&e(qi,()=>qi(y,m))!==!0&&hu(T),Dr.set(this,T),Lo.set(this,new Set),_.state!=="closed"&&w&&Ge(this),n(this,v,T)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(_){this._nativeAudioNode.channelCount=_}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(_){this._nativeAudioNode.channelCountMode=_}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(_){this._nativeAudioNode.channelInterpretation=_}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(_,w=0,T=0){if(w<0||w>=this._nativeAudioNode.numberOfOutputs)throw r();const v=l(this._context),y=p(v);if(f(_)||d(_))throw i();if(ls(_)){const x=K(_);try{const A=hs(this._nativeAudioNode,x,w,T),k=ts(this);(y||k)&&this._nativeAudioNode.disconnect(...A),this.context.state!=="closed"&&!k&&ts(_)&&Ge(_)}catch(A){throw A.code===12?i():A}if(t(this,_,w,T,y)){const A=c([this],_);er(A,s(y))}return _}const b=xn(_);if(b.name==="playbackRate"&&b.maxValue===1024)throw o();try{this._nativeAudioNode.connect(b,w),(y||ts(this))&&this._nativeAudioNode.disconnect(b,w)}catch(x){throw x.code===12?i():x}if(fu(this,_,w,y)){const x=c([this],_);er(x,s(y))}}disconnect(_,w,T){let v;const y=l(this._context),b=p(y);if(_===void 0)v=mu(this,b);else if(typeof _=="number"){if(_<0||_>=this.numberOfOutputs)throw r();v=gu(this,b,_)}else{if(w!==void 0&&(w<0||w>=this.numberOfOutputs)||ls(_)&&T!==void 0&&(T<0||T>=_.numberOfInputs))throw r();if(v=_u(this,b,_,w,T),v.length===0)throw i()}for(const S of v){const x=c([this],S);er(x,a)}}},vu=(n,t,e,s,r,i,o,a,c,u,l,h,f)=>(d,p,m,g=null,_=null)=>{const w=m.value,T=new Ic(w),v=p?s(T):null,y={get defaultValue(){return w},get maxValue(){return g===null?m.maxValue:g},get minValue(){return _===null?m.minValue:_},get value(){return m.value},set value(b){m.value=b,y.setValueAtTime(b,d.context.currentTime)},cancelAndHoldAtTime(b){if(typeof m.cancelAndHoldAtTime=="function")v===null&&T.flush(d.context.currentTime),T.add(r(b)),m.cancelAndHoldAtTime(b);else{const S=Array.from(T).pop();v===null&&T.flush(d.context.currentTime),T.add(r(b));const x=Array.from(T).pop();m.cancelScheduledValues(b),S!==x&&x!==void 0&&(x.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(x.value,x.endTime):x.type==="linearRampToValue"?m.linearRampToValueAtTime(x.value,x.endTime):x.type==="setValue"?m.setValueAtTime(x.value,x.startTime):x.type==="setValueCurve"&&m.setValueCurveAtTime(x.values,x.startTime,x.duration))}return y},cancelScheduledValues(b){return v===null&&T.flush(d.context.currentTime),T.add(i(b)),m.cancelScheduledValues(b),y},exponentialRampToValueAtTime(b,S){if(b===0)throw new RangeError;if(!Number.isFinite(S)||S<0)throw new RangeError;const x=d.context.currentTime;return v===null&&T.flush(x),Array.from(T).length===0&&(T.add(u(w,x)),m.setValueAtTime(w,x)),T.add(o(b,S)),m.exponentialRampToValueAtTime(b,S),y},linearRampToValueAtTime(b,S){const x=d.context.currentTime;return v===null&&T.flush(x),Array.from(T).length===0&&(T.add(u(w,x)),m.setValueAtTime(w,x)),T.add(a(b,S)),m.linearRampToValueAtTime(b,S),y},setTargetAtTime(b,S,x){return v===null&&T.flush(d.context.currentTime),T.add(c(b,S,x)),m.setTargetAtTime(b,S,x),y},setValueAtTime(b,S){return v===null&&T.flush(d.context.currentTime),T.add(u(b,S)),m.setValueAtTime(b,S),y},setValueCurveAtTime(b,S,x){const N=b instanceof Float32Array?b:new Float32Array(b);if(h!==null&&h.name==="webkitAudioContext"){const A=S+x,k=d.context.sampleRate,C=Math.ceil(S*k),M=Math.floor(A*k),I=M-C,P=new Float32Array(I);for(let D=0;D<I;D+=1){const $=(N.length-1)/x*((C+D)/k-S),F=Math.floor($),R=Math.ceil($);P[D]=F===R?N[F]:(1-($-F))*N[F]+(1-(R-$))*N[R]}v===null&&T.flush(d.context.currentTime),T.add(l(P,S,x)),m.setValueCurveAtTime(P,S,x);const E=M/k;E<A&&f(y,P[P.length-1],E),f(y,N[N.length-1],A)}else v===null&&T.flush(d.context.currentTime),T.add(l(N,S,x)),m.setValueCurveAtTime(N,S,x);return y}};return e.set(y,m),t.set(y,d),n(y,v),y},wu=n=>({replay(t){for(const e of n)if(e.type==="exponentialRampToValue"){const{endTime:s,value:r}=e;t.exponentialRampToValueAtTime(r,s)}else if(e.type==="linearRampToValue"){const{endTime:s,value:r}=e;t.linearRampToValueAtTime(r,s)}else if(e.type==="setTarget"){const{startTime:s,target:r,timeConstant:i}=e;t.setTargetAtTime(r,s,i)}else if(e.type==="setValue"){const{startTime:s,value:r}=e;t.setValueAtTime(r,s)}else if(e.type==="setValueCurve"){const{duration:s,startTime:r,values:i}=e;t.setValueCurveAtTime(i,r,s)}else throw new Error("Can't apply an unknown automation.")}});class Yo{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((s,r)=>t.call(e,s,r,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const bu={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Tu=(n,t,e,s,r,i,o,a,c,u,l,h,f,d)=>class extends t{constructor(m,g,_){var w;const T=a(m),v=c(T),y=l({...bu,..._});f(y);const b=pr.get(T),S=b?.get(g),x=v||T.state!=="closed"?T:(w=o(T))!==null&&w!==void 0?w:T,N=r(x,v?null:m.baseLatency,u,g,S,y),A=v?s(g,y,S):null;super(m,!0,N,A);const k=[];N.parameters.forEach((M,I)=>{const P=e(this,v,M);k.push([I,P])}),this._nativeAudioWorkletNode=N,this._onprocessorerror=null,this._parameters=new Yo(k),v&&n(T,this);const{activeInputs:C}=i(this);h(N,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const g=typeof m=="function"?d(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;const _=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=_!==null&&_===g?m:_}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function ps(n,t,e,s,r){if(typeof n.copyFromChannel=="function")t[e].byteLength===0&&(t[e]=new Float32Array(128)),n.copyFromChannel(t[e],s,r);else{const i=n.getChannelData(s);if(t[e].byteLength===0)t[e]=i.slice(r,r+128);else{const o=new Float32Array(i.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);t[e].set(o)}}}const Zo=(n,t,e,s,r)=>{typeof n.copyToChannel=="function"?t[e].byteLength!==0&&n.copyToChannel(t[e],s,r):t[e].byteLength!==0&&n.getChannelData(s).set(t[e],r)},ms=(n,t)=>{const e=[];for(let s=0;s<n;s+=1){const r=[],i=typeof t=="number"?t:t[s];for(let o=0;o<i;o+=1)r.push(new Float32Array(128));e.push(r)}return e},xu=(n,t)=>{const e=Lt(mr,n),s=K(t);return Lt(e,s)},Su=async(n,t,e,s,r,i,o)=>{const a=t===null?Math.ceil(n.context.length/128)*128:t.length,c=s.channelCount*s.numberOfInputs,u=r.reduce((g,_)=>g+_,0),l=u===0?null:e.createBuffer(u,a,e.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const h=vt(n),f=await xu(e,n),d=ms(s.numberOfInputs,s.channelCount),p=ms(s.numberOfOutputs,r),m=Array.from(n.parameters.keys()).reduce((g,_)=>({...g,[_]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(s.numberOfInputs>0&&t!==null)for(let _=0;_<s.numberOfInputs;_+=1)for(let w=0;w<s.channelCount;w+=1)ps(t,d[_],w,w,g);i.parameterDescriptors!==void 0&&t!==null&&i.parameterDescriptors.forEach(({name:_},w)=>{ps(t,m,_,c+w,g)});for(let _=0;_<s.numberOfInputs;_+=1)for(let w=0;w<r[_];w+=1)p[_][w].byteLength===0&&(p[_][w]=new Float32Array(128));try{const _=d.map((T,v)=>h.activeInputs[v].size===0?[]:T),w=o(g/e.sampleRate,e.sampleRate,()=>f.process(_,p,m));if(l!==null)for(let T=0,v=0;T<s.numberOfOutputs;T+=1){for(let y=0;y<r[T];y+=1)Zo(l,p[T],y,v+y,g);v+=r[T]}if(!w)break}catch(_){n.dispatchEvent(new ErrorEvent("processorerror",{colno:_.colno,filename:_.filename,lineno:_.lineno,message:_.message}));break}}return l},Cu=(n,t,e,s,r,i,o,a,c,u,l,h,f,d,p,m)=>(g,_,w)=>{const T=new WeakMap;let v=null;const y=async(b,S)=>{let x=l(b),N=null;const A=gt(x,S),k=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(h===null){const C=k.reduce((E,D)=>E+D,0),M=r(S,{channelCount:Math.max(1,C),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,C)}),I=[];for(let E=0;E<b.numberOfOutputs;E+=1)I.push(s(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:k[E]}));const P=o(S,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});P.connect=t.bind(null,I),P.disconnect=c.bind(null,I),N=[M,I,P]}else A||(x=new h(S,g));if(T.set(S,N===null?x:N[2]),N!==null){if(v===null){if(w===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const D=b.channelCount*b.numberOfInputs,$=w.parameterDescriptors===void 0?0:w.parameterDescriptors.length,F=D+$;v=Su(b,F===0?null:await(async()=>{const B=new f(F,Math.ceil(b.context.length/128)*128,S.sampleRate),X=[],Ct=[];for(let tt=0;tt<_.numberOfInputs;tt+=1)X.push(o(B,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),Ct.push(r(B,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const kt=await Promise.all(Array.from(b.parameters.values()).map(async tt=>{const _t=i(B,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:tt.value});return await d(B,tt,_t.offset),_t})),j=s(B,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,D+$)});for(let tt=0;tt<_.numberOfInputs;tt+=1){X[tt].connect(Ct[tt]);for(let _t=0;_t<_.channelCount;_t+=1)Ct[tt].connect(j,_t,tt*_.channelCount+_t)}for(const[tt,_t]of kt.entries())_t.connect(j,0,D+tt),_t.start(0);return j.connect(B.destination),await Promise.all(X.map(tt=>p(b,B,tt))),m(B)})(),S,_,k,w,u)}const C=await v,M=e(S,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[I,P,E]=N;C!==null&&(M.buffer=C,M.start(0)),M.connect(I);for(let D=0,$=0;D<b.numberOfOutputs;D+=1){const F=P[D];for(let R=0;R<k[D];R+=1)I.connect(F,$+R,R);$+=k[D]}return E}if(A)for(const[C,M]of b.parameters.entries())await n(S,M,x.parameters.get(C));else for(const[C,M]of b.parameters.entries())await d(S,M,x.parameters.get(C));return await p(b,S,x),x};return{render(b,S){a(S,b);const x=T.get(S);return x!==void 0?Promise.resolve(x):y(b,S)}}},ku=(n,t,e,s,r,i,o,a,c,u,l,h,f,d,p,m,g,_,w,T)=>class extends p{constructor(y,b){super(y,b),this._nativeContext=y,this._audioWorklet=n===void 0?void 0:{addModule:(S,x)=>n(this,S,x)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new r(this)}createBuffer(y,b,S){return new e({length:b,numberOfChannels:y,sampleRate:S})}createBufferSource(){return new s(this)}createChannelMerger(y=6){return new i(this,{numberOfInputs:y})}createChannelSplitter(y=6){return new o(this,{numberOfOutputs:y})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(y=1){return new l(this,{maxDelayTime:y})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(y,b){return new d(this,{feedback:b,feedforward:y})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(y,b,S={disableNormalization:!1}){return new _(this,{...S,imag:b,real:y})}createStereoPanner(){return new w(this)}createWaveShaper(){return new T(this)}decodeAudioData(y,b,S){return u(this._nativeContext,y).then(x=>(typeof b=="function"&&b(x),x),x=>{throw typeof S=="function"&&S(x),x})}},Au={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Nu=(n,t,e,s,r,i,o,a)=>class extends n{constructor(u,l){const h=i(u),f={...Au,...l},d=r(h,f),p=o(h),m=p?e():null;super(u,!1,d,m),this._Q=t(this,p,d.Q,yt,bt),this._detune=t(this,p,d.detune,1200*Math.log2(yt),-1200*Math.log2(yt)),this._frequency=t(this,p,d.frequency,u.sampleRate/2,0),this._gain=t(this,p,d.gain,40*Math.log10(yt),bt),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(u){this._nativeBiquadFilterNode.type=u}getFrequencyResponse(u,l,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(u,l,h)}catch(f){throw f.code===11?s():f}if(u.length!==l.length||l.length!==h.length)throw s()}},Iu=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let u=e(a);const l=gt(u,c);if(!l){const h={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=t(c,h)}return i.set(c,u),l?(await n(c,a.Q,u.Q),await n(c,a.detune,u.detune),await n(c,a.frequency,u.frequency),await n(c,a.gain,u.gain)):(await s(c,a.Q,u.Q),await s(c,a.detune,u.detune),await s(c,a.frequency,u.frequency),await s(c,a.gain,u.gain)),await r(a,c,u),u};return{render(a,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):o(a,c)}}},Mu=(n,t)=>(e,s)=>{const r=t.get(e);if(r!==void 0)return r;const i=n.get(e);if(i!==void 0)return i;try{const o=s();return o instanceof Promise?(n.set(e,o),o.catch(()=>!1).then(a=>(n.delete(e),t.set(e,a),a))):(t.set(e,o),o)}catch{return t.set(e,!1),!1}},Ou={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Eu=(n,t,e,s,r)=>class extends n{constructor(o,a){const c=s(o),u={...Ou,...a},l=e(c,u),h=r(c)?t():null;super(o,!1,l,h)}},Du=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=t(i);if(!gt(a,o)){const u={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,u)}return s.set(o,a),await e(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Pu={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Fu=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=s(a),l=i({...Pu,...c}),h=e(u,l),f=r(u)?t():null;super(a,!1,h,f)}},Ru=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=t(i);if(!gt(a,o)){const u={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,u)}return s.set(o,a),await e(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Vu=n=>(t,e,s)=>n(e,t,s),qu=n=>(t,e,s=0,r=0)=>{const i=t[s];if(i===void 0)throw n();return ds(e)?i.connect(e,0,r):i.connect(e,0)},Uu=n=>(t,e)=>{const s=n(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=t.createBuffer(1,2,44100);return s.buffer=r,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}},Lu={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Bu=(n,t,e,s,r,i,o)=>class extends n{constructor(c,u){const l=r(c),h={...Lu,...u},f=s(l,h),d=i(l),p=d?e():null;super(c,!1,f,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=f,this._offset=t(this,d,f.offset,yt,bt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=u;const l=this._nativeConstantSourceNode.onended;this._onended=l!==null&&l===u?c:l}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Ge(this);const u=()=>{this._nativeConstantSourceNode.removeEventListener("ended",u),te(this)&&On(this)};this._nativeConstantSourceNode.addEventListener("ended",u)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Wu=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,a=null;const c=async(u,l)=>{let h=e(u);const f=gt(h,l);if(!f){const d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=t(l,d),o!==null&&h.start(o),a!==null&&h.stop(a)}return i.set(l,h),f?await n(l,u.offset,h.offset):await s(l,u.offset,h.offset),await r(u,l,h),h};return{set start(u){o=u},set stop(u){a=u},render(u,l){const h=i.get(l);return h!==void 0?Promise.resolve(h):c(u,l)}}},$u=n=>t=>(n[0]=t,n[0]),ju={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},zu=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=s(a),l={...ju,...c},h=e(u,l),d=r(u)?t():null;super(a,!1,h,d),this._isBufferNullified=!1,this._nativeConvolverNode=h,l.buffer!==null&&i(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},Gu=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=t(i);if(!gt(a,o)){const u={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,u)}return s.set(o,a),nn(a)?await e(i,o,a.inputs[0]):await e(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},Xu=(n,t)=>(e,s,r)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(e,s,r)}catch(i){throw i.name==="SyntaxError"?n():i}},Hu=()=>new DOMException("","DataCloneError"),Ui=n=>{const{port1:t,port2:e}=new MessageChannel;return new Promise(s=>{const r=()=>{e.onmessage=null,t.close(),e.close(),s()};e.onmessage=()=>r();try{t.postMessage(n,[n])}catch{}finally{r()}})},Yu=(n,t,e,s,r,i,o,a,c,u,l)=>(h,f)=>{const d=o(h)?h:i(h);if(r.has(f)){const p=e();return Promise.reject(p)}try{r.add(f)}catch{}return t(c,()=>c(d))?d.decodeAudioData(f).then(p=>(Ui(f).catch(()=>{}),t(a,()=>a(p))||l(p),n.add(p),p)):new Promise((p,m)=>{const g=async()=>{try{await Ui(f)}catch{}},_=w=>{m(w),g()};try{d.decodeAudioData(f,w=>{typeof w.copyFromChannel!="function"&&(u(w),Fr(w)),n.add(w),g().then(()=>p(w))},w=>{_(w===null?s():w)})}catch(w){_(w)}})},Zu=(n,t,e,s,r,i,o,a)=>(c,u)=>{const l=t.get(c);if(l===void 0)throw new Error("Missing the expected cycle count.");const h=i(c.context),f=a(h);if(l===u){if(t.delete(c),!f&&o(c)){const d=s(c),{outputs:p}=e(c);for(const m of p)if(Dn(m)){const g=s(m[0]);n(d,g,m[1],m[2])}else{const g=r(m[0]);d.connect(g,m[1])}}}else t.set(c,l-u)},Qu={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Ju=(n,t,e,s,r,i,o)=>class extends n{constructor(c,u){const l=r(c),h={...Qu,...u},f=s(l,h),d=i(l),p=d?e(h.maxDelayTime):null;super(c,!1,f,p),this._delayTime=t(this,d,f.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Ku=(n,t,e,s,r)=>i=>{const o=new WeakMap,a=async(c,u)=>{let l=e(c);const h=gt(l,u);if(!h){const f={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:i};l=t(u,f)}return o.set(u,l),h?await n(u,c.delayTime,l.delayTime):await s(u,c.delayTime,l.delayTime),await r(c,u,l),l};return{render(c,u){const l=o.get(u);return l!==void 0?Promise.resolve(l):a(c,u)}}},tl=n=>(t,e,s,r)=>n(t[r],i=>i[0]===e&&i[1]===s),el=n=>(t,e)=>{n(t).delete(e)},nl=n=>"delayTime"in n,sl=(n,t,e)=>function s(r,i){const o=ls(i)?i:e(n,i);if(nl(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:a}=t(o);return Array.from(a).map(c=>s([...r,o],c[0])).reduce((c,u)=>c.concat(u),[])},Gn=(n,t,e)=>{const s=t[e];if(s===void 0)throw n();return s},rl=n=>(t,e=void 0,s=void 0,r=0)=>e===void 0?t.forEach(i=>i.disconnect()):typeof e=="number"?Gn(n,t,e).disconnect():ds(e)?s===void 0?t.forEach(i=>i.disconnect(e)):r===void 0?Gn(n,t,s).disconnect(e,0):Gn(n,t,s).disconnect(e,0,r):s===void 0?t.forEach(i=>i.disconnect(e)):Gn(n,t,s).disconnect(e,0),il={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ol=(n,t,e,s,r,i,o,a)=>class extends n{constructor(u,l){const h=i(u),f={...il,...l},d=s(h,f),p=o(h),m=p?e():null;super(u,!1,d,m),this._attack=t(this,p,d.attack),this._knee=t(this,p,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=t(this,p,d.ratio),this._release=t(this,p,d.release),this._threshold=t(this,p,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(u){const l=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=u,u>2)throw this._nativeDynamicsCompressorNode.channelCount=l,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(u){const l=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=u,u==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=l,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},al=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let u=e(a);const l=gt(u,c);if(!l){const h={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=t(c,h)}return i.set(c,u),l?(await n(c,a.attack,u.attack),await n(c,a.knee,u.knee),await n(c,a.ratio,u.ratio),await n(c,a.release,u.release),await n(c,a.threshold,u.threshold)):(await s(c,a.attack,u.attack),await s(c,a.knee,u.knee),await s(c,a.ratio,u.ratio),await s(c,a.release,u.release),await s(c,a.threshold,u.threshold)),await r(a,c,u),u};return{render(a,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):o(a,c)}}},cl=()=>new DOMException("","EncodingError"),ul=n=>t=>new Promise((e,s)=>{if(n===null){s(new SyntaxError);return}const r=n.document.head;if(r===null)s(new SyntaxError);else{const i=n.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,u=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(l,h,f,d,p)=>{if(h===a||h===n.location.href&&f===1&&d===1)return u(),s(p),!1;if(c!==null)return c(l,h,f,d,p)},i.onerror=()=>{u(),s(new SyntaxError)},i.onload=()=>{u(),e()},i.src=a,i.type="module",r.appendChild(i)}}),ll=n=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(e,s,r){if(s!==null){let i=this._listeners.get(s);i===void 0&&(i=n(this,s),typeof s=="function"&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,r)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,s,r){const i=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(e,i===void 0?null:i,r)}},hl=n=>(t,e,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(t*e)}},currentTime:{configurable:!0,get(){return t}}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},fl=n=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw n()},dl={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},pl=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=r(a),l={...dl,...c},h=s(u,l),f=i(u),d=f?e():null;super(a,!1,h,d),this._gain=t(this,f,h.gain,yt,bt)}get gain(){return this._gain}},ml=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let u=e(a);const l=gt(u,c);if(!l){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=t(c,h)}return i.set(c,u),l?await n(c,a.gain,u.gain):await s(c,a.gain,u.gain),await r(a,c,u),u};return{render(a,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):o(a,c)}}},gl=(n,t)=>e=>t(n,e),_l=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer},yl=n=>t=>{var e;return(e=n.get(t))!==null&&e!==void 0?e:0},vl=n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer},wl=n=>t=>n.get(t),pt=()=>new DOMException("","InvalidStateError"),bl=n=>t=>{const e=n.get(t);if(e===void 0)throw pt();return e},Tl=(n,t)=>e=>{let s=n.get(e);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),n.set(e,s),s},xl=n=>t=>{const e=n.get(t);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e},Fs=()=>new DOMException("","InvalidAccessError"),Sl=n=>{n.getFrequencyResponse=(t=>(e,s,r)=>{if(e.length!==s.length||s.length!==r.length)throw Fs();return t.call(n,e,s,r)})(n.getFrequencyResponse)},Cl={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},kl=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=s(a),l=r(u),h={...Cl,...c},f=t(u,l?null:a.baseLatency,h),d=l?e(h.feedback,h.feedforward):null;super(a,!1,f,d),Sl(f),this._nativeIIRFilterNode=f,i(this,1)}getFrequencyResponse(a,c,u){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,u)}},Qo=(n,t,e,s,r,i,o,a,c,u,l)=>{const h=u.length;let f=a;for(let d=0;d<h;d+=1){let p=e[0]*u[d];for(let m=1;m<r;m+=1){const g=f-m&c-1;p+=e[m]*i[g],p-=n[m]*o[g]}for(let m=r;m<s;m+=1)p+=e[m]*i[f-m&c-1];for(let m=r;m<t;m+=1)p-=n[m]*o[f-m&c-1];i[f]=u[d],o[f]=p,f=f+1&c-1,l[d]=p}return f},Al=(n,t,e,s)=>{const r=e instanceof Float64Array?e:new Float64Array(e),i=s instanceof Float64Array?s:new Float64Array(s),o=r.length,a=i.length,c=Math.min(o,a);if(r[0]!==1){for(let p=0;p<o;p+=1)i[p]/=r[0];for(let p=1;p<a;p+=1)r[p]/=r[0]}const u=32,l=new Float32Array(u),h=new Float32Array(u),f=t.createBuffer(n.numberOfChannels,n.length,n.sampleRate),d=n.numberOfChannels;for(let p=0;p<d;p+=1){const m=n.getChannelData(p),g=f.getChannelData(p);l.fill(0),h.fill(0),Qo(r,o,i,a,c,l,h,0,u,m,g)}return f},Nl=(n,t,e,s,r)=>(i,o)=>{const a=new WeakMap;let c=null;const u=async(l,h)=>{let f=null,d=t(l);const p=gt(d,h);if(h.createIIRFilter===void 0?f=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=h.createIIRFilter(o,i)),a.set(h,f===null?d:f),f!==null){if(c===null){if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");const g=new e(l.context.destination.channelCount,l.context.length,h.sampleRate);c=(async()=>{await s(l,g,g.destination);const _=await r(g);return Al(_,h,i,o)})()}const m=await c;return f.buffer=m,f.start(0),f}return await s(l,h,d),d};return{render(l,h){const f=a.get(h);return f!==void 0?Promise.resolve(f):u(l,h)}}},Il=(n,t,e,s,r,i)=>o=>(a,c)=>{const u=n.get(a);if(u===void 0){if(!o&&i(a)){const l=s(a),{outputs:h}=e(a);for(const f of h)if(Dn(f)){const d=s(f[0]);t(l,d,f[1],f[2])}else{const d=r(f[0]);l.disconnect(d,f[1])}}n.set(a,c)}else n.set(a,u+c)},Ml=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},Ol=(n,t)=>e=>n.has(e)||t(e),El=(n,t)=>e=>n.has(e)||t(e),Dl=(n,t)=>e=>{const s=n.get(e);return t(s)||t(e)},Pl=n=>t=>n!==null&&t instanceof n,Fl=n=>t=>n!==null&&typeof n.AudioNode=="function"&&t instanceof n.AudioNode,Rl=n=>t=>n!==null&&typeof n.AudioParam=="function"&&t instanceof n.AudioParam,Vl=(n,t)=>e=>n(e)||t(e),ql=n=>t=>n!==null&&t instanceof n,Ul=n=>n!==null&&n.isSecureContext,Ll=(n,t,e,s)=>class extends n{constructor(i,o){const a=e(i),c=t(a,o);if(s(a))throw TypeError();super(i,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Bl={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Wl=(n,t,e,s)=>class extends n{constructor(i,o){const a=e(i);if(s(a))throw new TypeError;const c={...Bl,...o},u=t(a,c);super(i,!1,u,null),this._nativeMediaStreamAudioDestinationNode=u}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},$l=(n,t,e,s)=>class extends n{constructor(i,o){const a=e(i),c=t(a,o);if(s(a))throw new TypeError;super(i,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},jl=(n,t,e)=>class extends n{constructor(r,i){const o=e(r),a=t(o,i);super(r,!0,a,null)}},zl=(n,t,e,s,r,i)=>class extends e{constructor(a,c){super(a),this._nativeContext=a,Ds.set(this,a),s(a)&&r.set(a,new Set),this._destination=new n(this,c),this._listener=t(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?i(this,a):null;this._nativeContext.onstatechange=c;const u=this._nativeContext.onstatechange;this._onstatechange=u!==null&&u===c?a:u}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Sn=n=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const e=n.decodeAudioData(t.buffer,()=>{});return e===void 0?!1:(e.catch(()=>{}),!0)}catch{}return!1},Gl=(n,t)=>(e,s,r)=>{const i=new Set;return e.connect=(o=>(a,c=0,u=0)=>{const l=i.size===0;if(t(a))return o.call(e,a,c,u),n(i,[a,c,u],h=>h[0]===a&&h[1]===c&&h[2]===u,!0),l&&s(),a;o.call(e,a,c),n(i,[a,c],h=>h[0]===a&&h[1]===c,!0),l&&s()})(e.connect),e.disconnect=(o=>(a,c,u)=>{const l=i.size>0;if(a===void 0)o.apply(e),i.clear();else if(typeof a=="number"){o.call(e,a);for(const f of i)f[1]===a&&i.delete(f)}else{t(a)?o.call(e,a,c,u):o.call(e,a,c);for(const f of i)f[0]===a&&(c===void 0||f[1]===c)&&(u===void 0||f[2]===u)&&i.delete(f)}const h=i.size===0;l&&h&&r()})(e.disconnect),e},et=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e]&&(n[e]=s)},dt=(n,t)=>{et(n,t,"channelCount"),et(n,t,"channelCountMode"),et(n,t,"channelInterpretation")},Li=n=>typeof n.getFloatTimeDomainData=="function",Xl=n=>{n.getFloatTimeDomainData=t=>{const e=new Uint8Array(t.length);n.getByteTimeDomainData(e);const s=Math.max(e.length,n.fftSize);for(let r=0;r<s;r+=1)t[r]=(e[r]-128)*.0078125;return t}},Hl=(n,t)=>(e,s)=>{const r=e.createAnalyser();if(dt(r,s),!(s.maxDecibels>s.minDecibels))throw t();return et(r,s,"fftSize"),et(r,s,"maxDecibels"),et(r,s,"minDecibels"),et(r,s,"smoothingTimeConstant"),n(Li,()=>Li(r))||Xl(r),r},Yl=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,it=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e].value&&(n[e].value=s)},Zl=n=>{n.start=(t=>{let e=!1;return(s=0,r=0,i)=>{if(e)throw pt();t.call(n,s,r,i),e=!0}})(n.start)},qr=n=>{n.start=(t=>(e=0,s=0,r)=>{if(typeof r=="number"&&r<0||s<0||e<0)throw new RangeError("The parameters can't be negative.");t.call(n,e,s,r)})(n.start)},Ur=n=>{n.stop=(t=>(e=0)=>{if(e<0)throw new RangeError("The parameter can't be negative.");t.call(n,e)})(n.stop)},Ql=(n,t,e,s,r,i,o,a,c,u,l)=>(h,f)=>{const d=h.createBufferSource();return dt(d,f),it(d,f,"playbackRate"),et(d,f,"buffer"),et(d,f,"loop"),et(d,f,"loopEnd"),et(d,f,"loopStart"),t(e,()=>e(h))||Zl(d),t(s,()=>s(h))||c(d),t(r,()=>r(h))||u(d,h),t(i,()=>i(h))||qr(d),t(o,()=>o(h))||l(d,h),t(a,()=>a(h))||Ur(d),n(h,d),d},Jl=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,Kl=(n,t)=>(e,s,r)=>{const i=e.destination;if(i.channelCount!==s)try{i.channelCount=s}catch{}r&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:s});const o=n(e,{channelCount:s,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{i.channelCount=c}catch(u){if(c>i.maxChannelCount)throw u}}),t(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelCountMode=c}),t(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),i.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},th=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,eh=n=>{const{port1:t}=new MessageChannel;try{t.postMessage(n)}finally{t.close()}},nh=(n,t,e,s,r)=>(i,o,a,c,u,l)=>{if(a!==null)try{const h=new a(i,c,l),f=new Map;let d=null;if(Object.defineProperties(h,{channelCount:{get:()=>l.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>d,set:p=>{typeof d=="function"&&h.removeEventListener("processorerror",d),d=typeof p=="function"?p:null,typeof d=="function"&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){const _=f.get(m[1]);_!==void 0?m[1]=_:(m[1]=w=>{w.type==="error"?(Object.defineProperties(w,{type:{value:"processorerror"}}),g(w)):g(new ErrorEvent(m[0],{...w}))},f.set(g,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const g=f.get(m[1]);g!==void 0&&(f.delete(m[1]),m[1]=g)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),l.numberOfOutputs!==0){const p=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(i.destination),r(h,()=>p.disconnect(),()=>p.connect(i.destination))}return h}catch(h){throw h.code===11?s():h}if(u===void 0)throw s();return eh(l),t(i,o,u,l)},Jo=(n,t)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*t))))),sh=n=>new Promise((t,e)=>{const{port1:s,port2:r}=new MessageChannel;s.onmessage=({data:i})=>{s.close(),r.close(),t(i)},s.onmessageerror=({data:i})=>{s.close(),r.close(),e(i)},r.postMessage(n)}),rh=async(n,t)=>{const e=await sh(t);return new n(e)},ih=(n,t,e,s)=>{let r=mr.get(n);r===void 0&&(r=new WeakMap,mr.set(n,r));const i=rh(e,s);return r.set(t,i),i},oh=(n,t,e,s,r,i,o,a,c,u,l,h,f)=>(d,p,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some(O=>O<1))throw c();if(_.length!==g.numberOfOutputs)throw t();if(g.channelCountMode!=="explicit")throw c();const w=g.channelCount*g.numberOfInputs,T=_.reduce((O,q)=>O+q,0),v=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(w+v>6||T>6)throw c();const y=new MessageChannel,b=[],S=[];for(let O=0;O<g.numberOfInputs;O+=1)b.push(o(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),S.push(r(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const x=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:O,maxValue:q,minValue:ht,name:nt}of m.parameterDescriptors){const G=i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[nt]!==void 0?g.parameterData[nt]:O===void 0?0:O});Object.defineProperties(G.offset,{defaultValue:{get:()=>O===void 0?0:O},maxValue:{get:()=>q===void 0?yt:q},minValue:{get:()=>ht===void 0?bt:ht}}),x.push(G)}const N=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,w+v)}),A=Jo(p,d.sampleRate),k=a(d,A,w+v,Math.max(1,T)),C=r(d,{channelCount:Math.max(1,T),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,T)}),M=[];for(let O=0;O<g.numberOfOutputs;O+=1)M.push(s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[O]}));for(let O=0;O<g.numberOfInputs;O+=1){b[O].connect(S[O]);for(let q=0;q<g.channelCount;q+=1)S[O].connect(N,q,O*g.channelCount+q)}const I=new Yo(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:O},q)=>{const ht=x[q];return ht.connect(N,0,w+q),ht.start(0),[O,ht.offset]}));N.connect(k);let P=g.channelInterpretation,E=null;const D=g.numberOfOutputs===0?[k]:M,$={get bufferSize(){return A},get channelCount(){return g.channelCount},set channelCount(O){throw e()},get channelCountMode(){return g.channelCountMode},set channelCountMode(O){throw e()},get channelInterpretation(){return P},set channelInterpretation(O){for(const q of b)q.channelInterpretation=O;P=O},get context(){return k.context},get inputs(){return b},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return E},set onprocessorerror(O){typeof E=="function"&&$.removeEventListener("processorerror",E),E=typeof O=="function"?O:null,typeof E=="function"&&$.addEventListener("processorerror",E)},get parameters(){return I},get port(){return y.port2},addEventListener(...O){return k.addEventListener(O[0],O[1],O[2])},connect:n.bind(null,D),disconnect:u.bind(null,D),dispatchEvent(...O){return k.dispatchEvent(O[0])},removeEventListener(...O){return k.removeEventListener(O[0],O[1],O[2])}},F=new Map;y.port1.addEventListener=(O=>(...q)=>{if(q[0]==="message"){const ht=typeof q[1]=="function"?q[1]:typeof q[1]=="object"&&q[1]!==null&&typeof q[1].handleEvent=="function"?q[1].handleEvent:null;if(ht!==null){const nt=F.get(q[1]);nt!==void 0?q[1]=nt:(q[1]=G=>{l(d.currentTime,d.sampleRate,()=>ht(G))},F.set(ht,q[1]))}}return O.call(y.port1,q[0],q[1],q[2])})(y.port1.addEventListener),y.port1.removeEventListener=(O=>(...q)=>{if(q[0]==="message"){const ht=F.get(q[1]);ht!==void 0&&(F.delete(q[1]),q[1]=ht)}return O.call(y.port1,q[0],q[1],q[2])})(y.port1.removeEventListener);let R=null;Object.defineProperty(y.port1,"onmessage",{get:()=>R,set:O=>{typeof R=="function"&&y.port1.removeEventListener("message",R),R=typeof O=="function"?O:null,typeof R=="function"&&(y.port1.addEventListener("message",R),y.port1.start())}}),m.prototype.port=y.port1;let B=null;ih(d,$,m,g).then(O=>B=O);const Ct=ms(g.numberOfInputs,g.channelCount),kt=ms(g.numberOfOutputs,_),j=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((O,{name:q})=>({...O,[q]:new Float32Array(128)}),{});let tt=!0;const _t=()=>{g.numberOfOutputs>0&&k.disconnect(C);for(let O=0,q=0;O<g.numberOfOutputs;O+=1){const ht=M[O];for(let nt=0;nt<_[O];nt+=1)C.disconnect(ht,q+nt,nt);q+=_[O]}},V=new Map;k.onaudioprocess=({inputBuffer:O,outputBuffer:q})=>{if(B!==null){const ht=h($);for(let nt=0;nt<A;nt+=128){for(let G=0;G<g.numberOfInputs;G+=1)for(let rt=0;rt<g.channelCount;rt+=1)ps(O,Ct[G],rt,rt,nt);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:G},rt)=>{ps(O,j,G,w+rt,nt)});for(let G=0;G<g.numberOfInputs;G+=1)for(let rt=0;rt<_[G];rt+=1)kt[G][rt].byteLength===0&&(kt[G][rt]=new Float32Array(128));try{const G=Ct.map((Ot,ae)=>{if(ht[ae].size>0)return V.set(ae,A/128),Ot;const tr=V.get(ae);return tr===void 0?[]:(Ot.every(Cc=>Cc.every(kc=>kc===0))&&(tr===1?V.delete(ae):V.set(ae,tr-1)),Ot)});tt=l(d.currentTime+nt/d.sampleRate,d.sampleRate,()=>B.process(G,kt,j));for(let Ot=0,ae=0;Ot<g.numberOfOutputs;Ot+=1){for(let ln=0;ln<_[Ot];ln+=1)Zo(q,kt[Ot],ln,ae+ln,nt);ae+=_[Ot]}}catch(G){tt=!1,$.dispatchEvent(new ErrorEvent("processorerror",{colno:G.colno,filename:G.filename,lineno:G.lineno,message:G.message}))}if(!tt){for(let G=0;G<g.numberOfInputs;G+=1){b[G].disconnect(S[G]);for(let rt=0;rt<g.channelCount;rt+=1)S[nt].disconnect(N,rt,G*g.channelCount+rt)}if(m.parameterDescriptors!==void 0){const G=m.parameterDescriptors.length;for(let rt=0;rt<G;rt+=1){const Ot=x[rt];Ot.disconnect(N,0,w+rt),Ot.stop()}}N.disconnect(k),k.onaudioprocess=null,ge?_t():Fe();break}}}};let ge=!1;const _e=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Pe=()=>k.connect(_e).connect(d.destination),Fe=()=>{k.disconnect(_e),_e.disconnect()},xc=()=>{if(tt){Fe(),g.numberOfOutputs>0&&k.connect(C);for(let O=0,q=0;O<g.numberOfOutputs;O+=1){const ht=M[O];for(let nt=0;nt<_[O];nt+=1)C.connect(ht,q+nt,nt);q+=_[O]}}ge=!0},Sc=()=>{tt&&(Pe(),_t()),ge=!1};return Pe(),f($,xc,Sc)},Ko=(n,t)=>{const e=n.createBiquadFilter();return dt(e,t),it(e,t,"Q"),it(e,t,"detune"),it(e,t,"frequency"),it(e,t,"gain"),et(e,t,"type"),e},ah=(n,t)=>(e,s)=>{const r=e.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&t(e,r),dt(r,s),r},ch=n=>{const t=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw pt()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:e=>{if(e!=="explicit")throw pt()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:e=>{if(e!=="discrete")throw pt()}})},Pn=(n,t)=>{const e=n.createChannelSplitter(t.numberOfOutputs);return dt(e,t),ch(e),e},uh=(n,t,e,s,r)=>(i,o)=>{if(i.createConstantSource===void 0)return e(i,o);const a=i.createConstantSource();return dt(a,o),it(a,o,"offset"),t(s,()=>s(i))||qr(a),t(r,()=>r(i))||Ur(a),n(i,a),a},sn=(n,t)=>(n.connect=t.connect.bind(t),n.disconnect=t.disconnect.bind(t),n),lh=(n,t,e,s)=>(r,{offset:i,...o})=>{const a=r.createBuffer(1,2,44100),c=t(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=e(r,{...o,gain:i}),l=a.getChannelData(0);l[0]=1,l[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(p){u.channelCount=p},get channelCountMode(){return u.channelCountMode},set channelCountMode(p){u.channelCountMode=p},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(p){u.channelInterpretation=p},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},f=()=>c.connect(u),d=()=>c.disconnect(u);return n(r,c),s(sn(h,u),f,d)},hh=(n,t)=>(e,s)=>{const r=e.createConvolver();if(dt(r,s),s.disableNormalization===r.normalize&&(r.normalize=!s.disableNormalization),et(r,s,"buffer"),s.channelCount>2||(t(r,"channelCount",i=>()=>i.call(r),i=>o=>{if(o>2)throw n();return i.call(r,o)}),s.channelCountMode==="max"))throw n();return t(r,"channelCountMode",i=>()=>i.call(r),i=>o=>{if(o==="max")throw n();return i.call(r,o)}),r},ta=(n,t)=>{const e=n.createDelay(t.maxDelayTime);return dt(e,t),it(e,t,"delayTime"),e},fh=n=>(t,e)=>{const s=t.createDynamicsCompressor();if(dt(s,e),e.channelCount>2||e.channelCountMode==="max")throw n();return it(s,e,"attack"),it(s,e,"knee"),it(s,e,"ratio"),it(s,e,"release"),it(s,e,"threshold"),s},St=(n,t)=>{const e=n.createGain();return dt(e,t),it(e,t,"gain"),e},dh=n=>(t,e,s)=>{if(t.createIIRFilter===void 0)return n(t,e,s);const r=t.createIIRFilter(s.feedforward,s.feedback);return dt(r,s),r};function ph(n,t){const e=t[0]*t[0]+t[1]*t[1];return[(n[0]*t[0]+n[1]*t[1])/e,(n[1]*t[0]-n[0]*t[1])/e]}function mh(n,t){return[n[0]*t[0]-n[1]*t[1],n[0]*t[1]+n[1]*t[0]]}function Bi(n,t){let e=[0,0];for(let s=n.length-1;s>=0;s-=1)e=mh(e,t),e[0]+=n[s];return e}const gh=(n,t,e,s)=>(r,i,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:u,feedforward:l})=>{const h=Jo(i,r.sampleRate),f=u instanceof Float64Array?u:new Float64Array(u),d=l instanceof Float64Array?l:new Float64Array(l),p=f.length,m=d.length,g=Math.min(p,m);if(p===0||p>20)throw s();if(f[0]===0)throw t();if(m===0||m>20)throw s();if(d[0]===0)throw t();if(f[0]!==1){for(let x=0;x<m;x+=1)d[x]/=f[0];for(let x=1;x<p;x+=1)f[x]/=f[0]}const _=e(r,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const w=32,T=[],v=[],y=[];for(let x=0;x<o;x+=1){T.push(0);const N=new Float32Array(w),A=new Float32Array(w);N.fill(0),A.fill(0),v.push(N),y.push(A)}_.onaudioprocess=x=>{const N=x.inputBuffer,A=x.outputBuffer,k=N.numberOfChannels;for(let C=0;C<k;C+=1){const M=N.getChannelData(C),I=A.getChannelData(C);T[C]=Qo(f,p,d,m,g,v[C],y[C],T[C],w,M,I)}};const b=r.sampleRate/2;return sn({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(x){_.channelCount=x},get channelCountMode(){return _.channelCountMode},set channelCountMode(x){_.channelCountMode=x},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(x){_.channelInterpretation=x},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener(...x){return _.addEventListener(x[0],x[1],x[2])},dispatchEvent(...x){return _.dispatchEvent(x[0])},getFrequencyResponse(x,N,A){if(x.length!==N.length||N.length!==A.length)throw n();const k=x.length;for(let C=0;C<k;C+=1){const M=-Math.PI*(x[C]/b),I=[Math.cos(M),Math.sin(M)],P=Bi(d,I),E=Bi(f,I),D=ph(P,E);N[C]=Math.sqrt(D[0]*D[0]+D[1]*D[1]),A[C]=Math.atan2(D[1],D[0])}},removeEventListener(...x){return _.removeEventListener(x[0],x[1],x[2])}},_)},_h=(n,t)=>n.createMediaElementSource(t.mediaElement),yh=(n,t)=>{const e=n.createMediaStreamDestination();return dt(e,t),e.numberOfOutputs===1&&Object.defineProperty(e,"numberOfOutputs",{get:()=>0}),e},vh=(n,{mediaStream:t})=>{const e=t.getAudioTracks();e.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const s=e.slice(0,1),r=n.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(r,"mediaStream",{value:t}),r},wh=(n,t)=>(e,{mediaStreamTrack:s})=>{if(typeof e.createMediaStreamTrackSource=="function")return e.createMediaStreamTrackSource(s);const r=new MediaStream([s]),i=e.createMediaStreamSource(r);if(s.kind!=="audio")throw n();if(t(e))throw new TypeError;return i},bh=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,Th=(n,t,e,s,r,i)=>(o,a)=>{const c=o.createOscillator();return dt(c,a),it(c,a,"detune"),it(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):et(c,a,"type"),t(e,()=>e(o))||qr(c),t(s,()=>s(o))||i(c,o),t(r,()=>r(o))||Ur(c),n(o,c),c},xh=n=>(t,e)=>{const s=t.createPanner();return s.orientationX===void 0?n(t,e):(dt(s,e),it(s,e,"orientationX"),it(s,e,"orientationY"),it(s,e,"orientationZ"),it(s,e,"positionX"),it(s,e,"positionY"),it(s,e,"positionZ"),et(s,e,"coneInnerAngle"),et(s,e,"coneOuterAngle"),et(s,e,"coneOuterGain"),et(s,e,"distanceModel"),et(s,e,"maxDistance"),et(s,e,"panningModel"),et(s,e,"refDistance"),et(s,e,"rolloffFactor"),s)},Sh=(n,t,e,s,r,i,o,a,c,u)=>(l,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:d,distanceModel:p,maxDistance:m,orientationX:g,orientationY:_,orientationZ:w,panningModel:T,positionX:v,positionY:y,positionZ:b,refDistance:S,rolloffFactor:x,...N})=>{const A=l.createPanner();if(N.channelCount>2||N.channelCountMode==="max")throw o();dt(A,N);const k={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},C=e(l,{...k,channelInterpretation:"speakers",numberOfInputs:6}),M=s(l,{...N,gain:1}),I=s(l,{...k,gain:1}),P=s(l,{...k,gain:0}),E=s(l,{...k,gain:0}),D=s(l,{...k,gain:0}),$=s(l,{...k,gain:0}),F=s(l,{...k,gain:0}),R=r(l,256,6,1),B=i(l,{...k,curve:new Float32Array([1,1]),oversample:"none"});let X=[g,_,w],Ct=[v,y,b];const kt=new Float32Array(1);R.onaudioprocess=({inputBuffer:V})=>{const ge=[c(V,kt,0),c(V,kt,1),c(V,kt,2)];ge.some((Pe,Fe)=>Pe!==X[Fe])&&(A.setOrientation(...ge),X=ge);const _e=[c(V,kt,3),c(V,kt,4),c(V,kt,5)];_e.some((Pe,Fe)=>Pe!==Ct[Fe])&&(A.setPosition(..._e),Ct=_e)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const j={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(V){if(V>2)throw o();M.channelCount=V,A.channelCount=V},get channelCountMode(){return A.channelCountMode},set channelCountMode(V){if(V==="max")throw o();M.channelCountMode=V,A.channelCountMode=V},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(V){M.channelInterpretation=V,A.channelInterpretation=V},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(V){A.coneInnerAngle=V},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(V){A.coneOuterAngle=V},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(V){if(V<0||V>1)throw t();A.coneOuterGain=V},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(V){A.distanceModel=V},get inputs(){return[M]},get maxDistance(){return A.maxDistance},set maxDistance(V){if(V<0)throw new RangeError;A.maxDistance=V},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return I.gain},get orientationY(){return P.gain},get orientationZ(){return E.gain},get panningModel(){return A.panningModel},set panningModel(V){A.panningModel=V},get positionX(){return D.gain},get positionY(){return $.gain},get positionZ(){return F.gain},get refDistance(){return A.refDistance},set refDistance(V){if(V<0)throw new RangeError;A.refDistance=V},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(V){if(V<0)throw new RangeError;A.rolloffFactor=V},addEventListener(...V){return M.addEventListener(V[0],V[1],V[2])},dispatchEvent(...V){return M.dispatchEvent(V[0])},removeEventListener(...V){return M.removeEventListener(V[0],V[1],V[2])}};h!==j.coneInnerAngle&&(j.coneInnerAngle=h),f!==j.coneOuterAngle&&(j.coneOuterAngle=f),d!==j.coneOuterGain&&(j.coneOuterGain=d),p!==j.distanceModel&&(j.distanceModel=p),m!==j.maxDistance&&(j.maxDistance=m),g!==j.orientationX.value&&(j.orientationX.value=g),_!==j.orientationY.value&&(j.orientationY.value=_),w!==j.orientationZ.value&&(j.orientationZ.value=w),T!==j.panningModel&&(j.panningModel=T),v!==j.positionX.value&&(j.positionX.value=v),y!==j.positionY.value&&(j.positionY.value=y),b!==j.positionZ.value&&(j.positionZ.value=b),S!==j.refDistance&&(j.refDistance=S),x!==j.rolloffFactor&&(j.rolloffFactor=x),(X[0]!==1||X[1]!==0||X[2]!==0)&&A.setOrientation(...X),(Ct[0]!==0||Ct[1]!==0||Ct[2]!==0)&&A.setPosition(...Ct);const tt=()=>{M.connect(A),n(M,B,0,0),B.connect(I).connect(C,0,0),B.connect(P).connect(C,0,1),B.connect(E).connect(C,0,2),B.connect(D).connect(C,0,3),B.connect($).connect(C,0,4),B.connect(F).connect(C,0,5),C.connect(R).connect(l.destination)},_t=()=>{M.disconnect(A),a(M,B,0,0),B.disconnect(I),I.disconnect(C),B.disconnect(P),P.disconnect(C),B.disconnect(E),E.disconnect(C),B.disconnect(D),D.disconnect(C),B.disconnect($),$.disconnect(C),B.disconnect(F),F.disconnect(C),C.disconnect(R),R.disconnect(l.destination)};return u(sn(j,A),tt,_t)},Ch=n=>(t,{disableNormalization:e,imag:s,real:r})=>{const i=s instanceof Float32Array?s:new Float32Array(s),o=r instanceof Float32Array?r:new Float32Array(r),a=t.createPeriodicWave(o,i,{disableNormalization:e});if(Array.from(s).length<2)throw n();return a},Fn=(n,t,e,s)=>n.createScriptProcessor(t,e,s),kh=(n,t)=>(e,s)=>{const r=s.channelCountMode;if(r==="clamped-max")throw t();if(e.createStereoPanner===void 0)return n(e,s);const i=e.createStereoPanner();return dt(i,s),it(i,s,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>r,set:o=>{if(o!==r)throw t()}}),i},Ah=(n,t,e,s,r,i)=>{const a=new Float32Array([1,1]),c=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...u,oversample:"none"},h=(p,m,g,_)=>{const w=new Float32Array(16385),T=new Float32Array(16385);for(let N=0;N<16385;N+=1){const A=N/16384*c;w[N]=Math.cos(A),T[N]=Math.sin(A)}const v=e(p,{...u,gain:0}),y=s(p,{...l,curve:w}),b=s(p,{...l,curve:a}),S=e(p,{...u,gain:0}),x=s(p,{...l,curve:T});return{connectGraph(){m.connect(v),m.connect(b.inputs===void 0?b:b.inputs[0]),m.connect(S),b.connect(g),g.connect(y.inputs===void 0?y:y.inputs[0]),g.connect(x.inputs===void 0?x:x.inputs[0]),y.connect(v.gain),x.connect(S.gain),v.connect(_,0,0),S.connect(_,0,1)},disconnectGraph(){m.disconnect(v),m.disconnect(b.inputs===void 0?b:b.inputs[0]),m.disconnect(S),b.disconnect(g),g.disconnect(y.inputs===void 0?y:y.inputs[0]),g.disconnect(x.inputs===void 0?x:x.inputs[0]),y.disconnect(v.gain),x.disconnect(S.gain),v.disconnect(_,0,0),S.disconnect(_,0,1)}}},f=(p,m,g,_)=>{const w=new Float32Array(16385),T=new Float32Array(16385),v=new Float32Array(16385),y=new Float32Array(16385),b=Math.floor(16385/2);for(let D=0;D<16385;D+=1)if(D>b){const $=(D-b)/(16384-b)*c;w[D]=Math.cos($),T[D]=Math.sin($),v[D]=0,y[D]=1}else{const $=D/(16384-b)*c;w[D]=1,T[D]=0,v[D]=Math.cos($),y[D]=Math.sin($)}const S=t(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),x=e(p,{...u,gain:0}),N=s(p,{...l,curve:w}),A=e(p,{...u,gain:0}),k=s(p,{...l,curve:T}),C=s(p,{...l,curve:a}),M=e(p,{...u,gain:0}),I=s(p,{...l,curve:v}),P=e(p,{...u,gain:0}),E=s(p,{...l,curve:y});return{connectGraph(){m.connect(S),m.connect(C.inputs===void 0?C:C.inputs[0]),S.connect(x,0),S.connect(A,0),S.connect(M,1),S.connect(P,1),C.connect(g),g.connect(N.inputs===void 0?N:N.inputs[0]),g.connect(k.inputs===void 0?k:k.inputs[0]),g.connect(I.inputs===void 0?I:I.inputs[0]),g.connect(E.inputs===void 0?E:E.inputs[0]),N.connect(x.gain),k.connect(A.gain),I.connect(M.gain),E.connect(P.gain),x.connect(_,0,0),M.connect(_,0,0),A.connect(_,0,1),P.connect(_,0,1)},disconnectGraph(){m.disconnect(S),m.disconnect(C.inputs===void 0?C:C.inputs[0]),S.disconnect(x,0),S.disconnect(A,0),S.disconnect(M,1),S.disconnect(P,1),C.disconnect(g),g.disconnect(N.inputs===void 0?N:N.inputs[0]),g.disconnect(k.inputs===void 0?k:k.inputs[0]),g.disconnect(I.inputs===void 0?I:I.inputs[0]),g.disconnect(E.inputs===void 0?E:E.inputs[0]),N.disconnect(x.gain),k.disconnect(A.gain),I.disconnect(M.gain),E.disconnect(P.gain),x.disconnect(_,0,0),M.disconnect(_,0,0),A.disconnect(_,0,1),P.disconnect(_,0,1)}}},d=(p,m,g,_,w)=>{if(m===1)return h(p,g,_,w);if(m===2)return f(p,g,_,w);throw r()};return(p,{channelCount:m,channelCountMode:g,pan:_,...w})=>{if(g==="max")throw r();const T=n(p,{...w,channelCount:1,channelCountMode:g,numberOfInputs:2}),v=e(p,{...w,channelCount:m,channelCountMode:g,gain:1}),y=e(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:_});let{connectGraph:b,disconnectGraph:S}=d(p,m,v,y,T);Object.defineProperty(y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(y.gain,"maxValue",{get:()=>1}),Object.defineProperty(y.gain,"minValue",{get:()=>-1});const x={get bufferSize(){},get channelCount(){return v.channelCount},set channelCount(C){v.channelCount!==C&&(N&&S(),{connectGraph:b,disconnectGraph:S}=d(p,C,v,y,T),N&&b()),v.channelCount=C},get channelCountMode(){return v.channelCountMode},set channelCountMode(C){if(C==="clamped-max"||C==="max")throw r();v.channelCountMode=C},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(C){v.channelInterpretation=C},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get pan(){return y.gain},addEventListener(...C){return v.addEventListener(C[0],C[1],C[2])},dispatchEvent(...C){return v.dispatchEvent(C[0])},removeEventListener(...C){return v.removeEventListener(C[0],C[1],C[2])}};let N=!1;const A=()=>{b(),N=!0},k=()=>{S(),N=!1};return i(sn(x,T),A,k)}},Nh=(n,t,e,s,r,i,o)=>(a,c)=>{const u=a.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return e(a,c);dt(u,c);const l=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(l!==null&&l.length<2)throw t();et(u,{curve:l},"curve"),et(u,c,"oversample");let h=null,f=!1;return o(u,"curve",m=>()=>m.call(u),m=>g=>(m.call(u,g),f&&(s(g)&&h===null?h=n(a,u):!s(g)&&h!==null&&(h(),h=null)),g)),r(u,()=>{f=!0,s(u.curve)&&(h=n(a,u))},()=>{f=!1,h!==null&&(h(),h=null)})},Ih=(n,t,e,s,r)=>(i,{curve:o,oversample:a,...c})=>{const u=i.createWaveShaper(),l=i.createWaveShaper();dt(u,c),dt(l,c);const h=e(i,{...c,gain:1}),f=e(i,{...c,gain:-1}),d=e(i,{...c,gain:1}),p=e(i,{...c,gain:-1});let m=null,g=!1,_=null;const w={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(y){h.channelCount=y,f.channelCount=y,u.channelCount=y,d.channelCount=y,l.channelCount=y,p.channelCount=y},get channelCountMode(){return u.channelCountMode},set channelCountMode(y){h.channelCountMode=y,f.channelCountMode=y,u.channelCountMode=y,d.channelCountMode=y,l.channelCountMode=y,p.channelCountMode=y},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(y){h.channelInterpretation=y,f.channelInterpretation=y,u.channelInterpretation=y,d.channelInterpretation=y,l.channelInterpretation=y,p.channelInterpretation=y},get context(){return u.context},get curve(){return _},set curve(y){if(y!==null&&y.length<2)throw t();if(y===null)u.curve=y,l.curve=y;else{const b=y.length,S=new Float32Array(b+2-b%2),x=new Float32Array(b+2-b%2);S[0]=y[0],x[0]=-y[b-1];const N=Math.ceil((b+1)/2),A=(b+1)/2-1;for(let k=1;k<N;k+=1){const C=k/N*A,M=Math.floor(C),I=Math.ceil(C);S[k]=M===I?y[M]:(1-(C-M))*y[M]+(1-(I-C))*y[I],x[k]=M===I?-y[b-1-M]:-((1-(C-M))*y[b-1-M])-(1-(I-C))*y[b-1-I]}S[N]=b%2===1?y[N-1]:(y[N-2]+y[N-1])/2,u.curve=S,l.curve=x}_=y,g&&(s(_)&&m===null?m=n(i,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(y){u.oversample=y,l.oversample=y},addEventListener(...y){return h.addEventListener(y[0],y[1],y[2])},dispatchEvent(...y){return h.dispatchEvent(y[0])},removeEventListener(...y){return h.removeEventListener(y[0],y[1],y[2])}};o!==null&&(w.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==w.oversample&&(w.oversample=a);const T=()=>{h.connect(u).connect(d),h.connect(f).connect(l).connect(p).connect(d),g=!0,s(_)&&(m=n(i,h))},v=()=>{h.disconnect(u),u.disconnect(d),h.disconnect(f),f.disconnect(l),l.disconnect(p),p.disconnect(d),g=!1,m!==null&&(m(),m=null)};return r(sn(w,d),T,v)},wt=()=>new DOMException("","NotSupportedError"),Mh={numberOfChannels:1},Oh=(n,t,e,s,r)=>class extends n{constructor(o,a,c){let u;if(typeof o=="number"&&a!==void 0&&c!==void 0)u={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")u=o;else throw new Error("The given parameters are not valid.");const{length:l,numberOfChannels:h,sampleRate:f}={...Mh,...u},d=s(h,l,f);t(Sn,()=>Sn(d))||d.addEventListener("statechange",(()=>{let p=0;const m=g=>{this._state==="running"&&(p>0?(d.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):p+=1)};return m})()),super(d,h),this._length=l,this._nativeOfflineAudioContext=d,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,zo(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},Eh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Dh=(n,t,e,s,r,i,o)=>class extends n{constructor(c,u){const l=r(c),h={...Eh,...u},f=e(l,h),d=i(l),p=d?s():null,m=c.sampleRate/2;super(c,!1,f,p),this._detune=t(this,d,f.detune,153600,-153600),this._frequency=t(this,d,f.frequency,m,-m),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=u;const l=this._nativeOscillatorNode.onended;this._onended=l!==null&&l===u?c:l}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Ge(this);const u=()=>{this._nativeOscillatorNode.removeEventListener("ended",u),te(this)&&On(this)};this._nativeOscillatorNode.addEventListener("ended",u)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Ph=(n,t,e,s,r)=>()=>{const i=new WeakMap;let o=null,a=null,c=null;const u=async(l,h)=>{let f=e(l);const d=gt(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:o===null?void 0:o,type:f.type};f=t(h,p),a!==null&&f.start(a),c!==null&&f.stop(c)}return i.set(h,f),d?(await n(h,l.detune,f.detune),await n(h,l.frequency,f.frequency)):(await s(h,l.detune,f.detune),await s(h,l.frequency,f.frequency)),await r(l,h,f),f};return{set periodicWave(l){o=l},set start(l){a=l},set stop(l){c=l},render(l,h){const f=i.get(h);return f!==void 0?Promise.resolve(f):u(l,h)}}},Fh={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Rh=(n,t,e,s,r,i,o)=>class extends n{constructor(c,u){const l=r(c),h={...Fh,...u},f=e(l,h),d=i(l),p=d?s():null;super(c,!1,f,p),this._nativePannerNode=f,this._orientationX=t(this,d,f.orientationX,yt,bt),this._orientationY=t(this,d,f.orientationY,yt,bt),this._orientationZ=t(this,d,f.orientationZ,yt,bt),this._positionX=t(this,d,f.positionX,yt,bt),this._positionY=t(this,d,f.positionY,yt,bt),this._positionZ=t(this,d,f.positionZ,yt,bt),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Vh=(n,t,e,s,r,i,o,a,c,u)=>()=>{const l=new WeakMap;let h=null;const f=async(d,p)=>{let m=null,g=i(d);const _={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},w={..._,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},T=gt(g,p);if("bufferSize"in g)m=s(p,{..._,gain:1});else if(!T){const v={...w,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=r(p,v)}if(l.set(p,m===null?g:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const k=new o(6,d.context.length,p.sampleRate),C=t(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});C.connect(k.destination),h=(async()=>{const M=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(I,P)=>{const E=e(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P===0?1:0});return await a(k,I,E.offset),E}));for(let I=0;I<6;I+=1)M[I].connect(C,0,I),M[I].start(0);return u(k)})()}const v=await h,y=s(p,{..._,gain:1});await c(d,p,y);const b=[];for(let k=0;k<v.numberOfChannels;k+=1)b.push(v.getChannelData(k));let S=[b[0][0],b[1][0],b[2][0]],x=[b[3][0],b[4][0],b[5][0]],N=s(p,{..._,gain:1}),A=r(p,{...w,orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:x[0],positionY:x[1],positionZ:x[2]});y.connect(N).connect(A.inputs[0]),A.connect(m);for(let k=128;k<v.length;k+=128){const C=[b[0][k],b[1][k],b[2][k]],M=[b[3][k],b[4][k],b[5][k]];if(C.some((I,P)=>I!==S[P])||M.some((I,P)=>I!==x[P])){S=C,x=M;const I=k/p.sampleRate;N.gain.setValueAtTime(0,I),N=s(p,{..._,gain:0}),A=r(p,{...w,orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:x[0],positionY:x[1],positionZ:x[2]}),N.gain.setValueAtTime(1,I),y.connect(N).connect(A.inputs[0]),A.connect(m)}}return m}return T?(await n(p,d.orientationX,g.orientationX),await n(p,d.orientationY,g.orientationY),await n(p,d.orientationZ,g.orientationZ),await n(p,d.positionX,g.positionX),await n(p,d.positionY,g.positionY),await n(p,d.positionZ,g.positionZ)):(await a(p,d.orientationX,g.orientationX),await a(p,d.orientationY,g.orientationY),await a(p,d.orientationZ,g.orientationZ),await a(p,d.positionX,g.positionX),await a(p,d.positionY,g.positionY),await a(p,d.positionZ,g.positionZ)),nn(g)?await c(d,p,g.inputs[0]):await c(d,p,g),g};return{render(d,p){const m=l.get(p);return m!==void 0?Promise.resolve(m):f(d,p)}}},qh={disableNormalization:!1},Uh=(n,t,e,s)=>class ea{constructor(i,o){const a=t(i),c=s({...qh,...o}),u=n(a,c);return e.add(u),u}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===ea.prototype||e.has(i)}},Lh=(n,t)=>(e,s,r)=>(n(s).replay(r),t(s,e,r)),Bh=(n,t,e)=>async(s,r,i)=>{const o=n(s);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([u,l])=>{const f=await t(u).render(u,r),d=s.context.destination;!e(u)&&(s!==d||!e(s))&&f.connect(i,l,c)})).reduce((a,c)=>[...a,...c],[]))},Wh=(n,t,e)=>async(s,r,i)=>{const o=t(s);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const l=await n(a).render(a,r);e(a)||l.connect(i,c)}))},$h=(n,t,e,s)=>r=>n(Sn,()=>Sn(r))?Promise.resolve(n(s,s)).then(i=>{if(!i){const o=e(r,512,0,1);r.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>r.currentTime,o.connect(r.destination)}return r.startRendering()}):new Promise(i=>{const o=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=a=>{o.disconnect(),i(a.renderedBuffer)},o.connect(r.destination),r.startRendering()}),jh=n=>(t,e)=>{n.set(t,e)},zh=n=>(t,e)=>n.set(t,e),Gh=(n,t,e,s,r,i,o,a)=>(c,u)=>e(c).render(c,u).then(()=>Promise.all(Array.from(s(u)).map(l=>e(l).render(l,u)))).then(()=>r(u)).then(l=>(typeof l.copyFromChannel!="function"?(o(l),Fr(l)):t(i,()=>i(l))||a(l),n.add(l),l)),Xh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Hh=(n,t,e,s,r,i)=>class extends n{constructor(a,c){const u=r(a),l={...Xh,...c},h=e(u,l),f=i(u),d=f?s():null;super(a,!1,h,d),this._pan=t(this,f,h.pan)}get pan(){return this._pan}},Yh=(n,t,e,s,r)=>()=>{const i=new WeakMap,o=async(a,c)=>{let u=e(a);const l=gt(u,c);if(!l){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=t(c,h)}return i.set(c,u),l?await n(c,a.pan,u.pan):await s(c,a.pan,u.pan),nn(u)?await r(a,c,u.inputs[0]):await r(a,c,u),u};return{render(a,c){const u=i.get(c);return u!==void 0?Promise.resolve(u):o(a,c)}}},Zh=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},Qh=(n,t)=>async()=>{if(n===null)return!0;if(t===null)return!1;const e=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),r=URL.createObjectURL(e);let i=!1,o=!1;try{await s.audioWorklet.addModule(r);const a=new n(s,"a",{numberOfOutputs:0}),c=s.createOscillator();a.port.onmessage=()=>i=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await s.startRendering(),await new Promise(u=>setTimeout(u))}catch{}finally{URL.revokeObjectURL(r)}return i&&!o},Jh=(n,t)=>()=>{if(t===null)return Promise.resolve(!1);const e=new t(1,1,44100),s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(r=>{e.oncomplete=()=>{s.disconnect(),r(e.currentTime!==0)},e.startRendering()})},Kh=()=>new DOMException("","UnknownError"),tf={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ef=(n,t,e,s,r,i,o)=>class extends n{constructor(c,u){const l=r(c),h={...tf,...u},f=e(l,h),p=i(l)?s():null;super(c,!0,f,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},nf=(n,t,e)=>()=>{const s=new WeakMap,r=async(i,o)=>{let a=t(i);if(!gt(a,o)){const u={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,u)}return s.set(o,a),nn(a)?await e(i,o,a.inputs[0]):await e(i,o,a),a};return{render(i,o){const a=s.get(o);return a!==void 0?Promise.resolve(a):r(i,o)}}},sf=()=>typeof window>"u"?null:window,rf=(n,t)=>e=>{e.copyFromChannel=(s,r,i=0)=>{const o=n(i),a=n(r);if(a>=e.numberOfChannels)throw t();const c=e.length,u=e.getChannelData(a),l=s.length;for(let h=o<0?-o:0;h+o<c&&h<l;h+=1)s[h]=u[h+o]},e.copyToChannel=(s,r,i=0)=>{const o=n(i),a=n(r);if(a>=e.numberOfChannels)throw t();const c=e.length,u=e.getChannelData(a),l=s.length;for(let h=o<0?-o:0;h+o<c&&h<l;h+=1)u[h+o]=s[h]}},of=n=>t=>{t.copyFromChannel=(e=>(s,r,i=0)=>{const o=n(i),a=n(r);if(o<t.length)return e.call(t,s,a,o)})(t.copyFromChannel),t.copyToChannel=(e=>(s,r,i=0)=>{const o=n(i),a=n(r);if(o<t.length)return e.call(t,s,a,o)})(t.copyToChannel)},af=n=>(t,e)=>{const s=e.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=s),n(t,"buffer",r=>()=>{const i=r.call(t);return i===s?null:i},r=>i=>r.call(t,i===null?s:i))},cf=(n,t)=>(e,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const r=e.createBufferSource();t(s,()=>{const a=s.numberOfInputs;for(let c=0;c<a;c+=1)r.connect(s,0,c)},()=>r.disconnect(s))},na=(n,t,e)=>n.copyFromChannel===void 0?n.getChannelData(e)[0]:(n.copyFromChannel(t,e),t[0]),sa=n=>{if(n===null)return!1;const t=n.length;return t%2!==0?n[Math.floor(t/2)]!==0:n[t/2-1]+n[t/2]!==0},Rn=(n,t,e,s)=>{let r=n;for(;!r.hasOwnProperty(t);)r=Object.getPrototypeOf(r);const{get:i,set:o}=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(n,t,{get:e(i),set:s(o)})},uf=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),lf=n=>({...n,channelCount:n.numberOfOutputs}),hf=n=>{const{imag:t,real:e}=n;return t===void 0?e===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(e,()=>0),real:e}:e===void 0?{...n,imag:t,real:Array.from(t,()=>0)}:{...n,imag:t,real:e}},ra=(n,t,e)=>{try{n.setValueAtTime(t,e)}catch(s){if(s.code!==9)throw s;ra(n,t,e+1e-7)}},ff=n=>{const t=n.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},df=n=>{const t=n.createBufferSource(),e=n.createBuffer(1,1,44100);t.buffer=e;try{t.start(0,1)}catch{return!1}return!0},pf=n=>{const t=n.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Lr=n=>{const t=n.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},ia=n=>{const t=n.createBuffer(1,1,44100),e=n.createBufferSource();e.buffer=t,e.start(),e.stop();try{return e.stop(),!0}catch{return!1}},Br=n=>{const t=n.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},mf=n=>{const{port1:t,port2:e}=new MessageChannel;try{t.postMessage(n)}finally{t.close(),e.close()}},gf=n=>{n.start=(t=>(e=0,s=0,r)=>{const i=n.buffer,o=i===null?s:Math.min(i.duration,s);i!==null&&o>i.duration-.5/n.context.sampleRate?t.call(n,e,0,0):t.call(n,e,o,r)})(n.start)},oa=(n,t)=>{const e=t.createGain();n.connect(e);const s=(r=>()=>{r.call(n,e),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),sn(n,e),n.stop=(r=>{let i=!1;return(o=0)=>{if(i)try{r.call(n,o)}catch{e.gain.setValueAtTime(0,o)}else r.call(n,o),i=!0}})(n.stop)},rn=(n,t)=>e=>{const s={value:n};return Object.defineProperties(e,{currentTarget:s,target:s}),typeof t=="function"?t.call(n,e):t.handleEvent.call(n,e)},_f=Rc(Oe),yf=Wc(Oe),vf=tl(Ps),aa=new WeakMap,wf=yl(aa),Bt=Mu(new Map,new WeakMap),Gt=sf(),ca=Hl(Bt,Xt),Wr=_l(vt),mt=Bh(vt,Wr,ke),bf=Xc(ca,K,mt),Q=bl(Ds),re=bh(Gt),Y=ql(re),ua=new WeakMap,la=ll(rn),Vn=Jl(Gt),$r=Pl(Vn),jr=Fl(Gt),ha=Rl(Gt),Cn=th(Gt),at=yu(Vc(qo),Bc(_f,yf,hs,vf,fs,vt,wf,Mn,K,Oe,te,ke,ts),Bt,Il(dr,fs,vt,K,xn,te),Xt,Fs,wt,Zu(hs,dr,vt,K,xn,Q,te,Y),sl(ua,vt,Lt),la,Q,$r,jr,ha,Y,Cn),Tf=Gc(at,bf,Xt,ca,Q,Y),zr=new WeakSet,Wi=Yl(Gt),fa=$u(new Uint32Array(1)),Gr=rf(fa,Xt),Xr=of(fa),da=Yc(zr,Bt,wt,Wi,re,Zh(Wi),Gr,Xr),Rs=$c(St),pa=Wh(Wr,En,ke),Ht=Vu(pa),on=Ql(Rs,Bt,ff,df,pf,Lr,ia,Br,gf,af(Rn),oa),Yt=Lh(vl(En),pa),xf=Jc(Ht,on,K,Yt,mt),Wt=vu(qc(Uo),ua,Pr,wu,Mc,Oc,Ec,Dc,Pc,lr,Ro,Vn,ra),Sf=Qc(at,xf,Wt,pt,on,Q,Y,rn),Cf=au(at,cu,Xt,pt,Kl(St,Rn),Q,Y,mt),kf=Iu(Ht,Ko,K,Yt,mt),Ee=zh(aa),Af=Nu(at,Wt,kf,Fs,Ko,Q,Y,Ee),de=Gl(Oe,jr),Nf=cf(pt,de),pe=ah(Vn,Nf),If=Du(pe,K,mt),Mf=Eu(at,If,pe,Q,Y),Of=Ru(Pn,K,mt),Ef=Fu(at,Of,Pn,Q,Y,lf),Df=lh(Rs,on,St,de),an=uh(Rs,Bt,Df,Lr,Br),Pf=Wu(Ht,an,K,Yt,mt),Ff=Bu(at,Wt,Pf,an,Q,Y,rn),ma=hh(wt,Rn),Rf=Gu(ma,K,mt),Vf=zu(at,Rf,ma,Q,Y,Ee),qf=Ku(Ht,ta,K,Yt,mt),Uf=Ju(at,Wt,qf,ta,Q,Y,Ee),ga=fh(wt),Lf=al(Ht,ga,K,Yt,mt),Bf=ol(at,Wt,Lf,ga,wt,Q,Y,Ee),Wf=ml(Ht,St,K,Yt,mt),$f=pl(at,Wt,Wf,St,Q,Y),jf=gh(Fs,pt,Fn,wt),Vs=$h(Bt,St,Fn,Jh(St,re)),zf=Nl(on,K,re,mt,Vs),Gf=dh(jf),Xf=kl(at,Gf,zf,Q,Y,Ee),Hf=uu(Wt,pe,an,Fn,wt,na,Y,Rn),_a=new WeakMap,Yf=zl(Cf,Hf,la,Y,_a,rn),ya=Th(Rs,Bt,Lr,ia,Br,oa),Zf=Ph(Ht,ya,K,Yt,mt),Qf=Dh(at,Wt,ya,Zf,Q,Y,rn),va=Uu(on),Jf=Ih(va,pt,St,sa,de),qs=Nh(va,pt,Jf,sa,de,Vn,Rn),Kf=Sh(hs,pt,pe,St,Fn,qs,wt,fs,na,de),wa=xh(Kf),td=Vh(Ht,pe,an,St,wa,K,re,Yt,mt,Vs),ed=Rh(at,Wt,wa,td,Q,Y,Ee),nd=Ch(Xt),sd=Uh(nd,Q,new WeakSet,hf),rd=Ah(pe,Pn,St,qs,wt,de),ba=kh(rd,wt),id=Yh(Ht,ba,K,Yt,mt),od=Hh(at,Wt,ba,id,Q,Y),ad=nf(qs,K,mt),cd=ef(at,pt,qs,ad,Q,Y,Ee),Ta=Ul(Gt),Hr=hl(Gt),xa=new WeakMap,ud=Tl(xa,re),ld=Ta?Lc(Bt,wt,ul(Gt),Hr,fl(Fc),Q,ud,Y,Cn,new WeakMap,new WeakMap,Qh(Cn,re),Gt):void 0,hd=Vl($r,Y),fd=Yu(zr,Bt,Hu,cl,new WeakSet,Q,hd,us,Sn,Gr,Xr),Sa=ku(ld,Tf,da,Sf,Af,Mf,Ef,Ff,Vf,fd,Uf,Bf,$f,Xf,Yf,Qf,ed,sd,od,cd),dd=Ll(at,_h,Q,Y),pd=Wl(at,yh,Q,Y),md=$l(at,vh,Q,Y),gd=wh(pt,Y),_d=jl(at,gd,Q),yd=ou(Sa,pt,wt,Kh,dd,pd,md,_d,Vn),Yr=xl(_a),vd=jc(Yr),Ca=qu(Xt),wd=el(Yr),ka=rl(Xt),Aa=new WeakMap,bd=gl(Aa,Lt),Td=oh(Ca,Xt,pt,pe,Pn,an,St,Fn,wt,ka,Hr,bd,de),xd=nh(pt,Td,St,wt,de),Sd=Cu(Ht,Ca,on,pe,Pn,an,St,wd,ka,Hr,K,Cn,re,Yt,mt,Vs),Cd=wl(xa),kd=jh(Aa),$i=Ta?Tu(vd,at,Wt,Sd,xd,vt,Cd,Q,Y,Cn,uf,kd,mf,rn):void 0,Ad=Xu(wt,re),Nd=Gh(zr,Bt,Wr,Yr,Vs,us,Gr,Xr),Id=Oh(Sa,Bt,pt,Ad,Nd),Md=Ml(Ds,$r),Od=Ol(Dr,jr),Ed=El(Pr,ha),Dd=Dl(Ds,Y);function Dt(n){return n===void 0}function z(n){return n!==void 0}function Pd(n){return typeof n=="function"}function he(n){return typeof n=="number"}function Se(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function Fd(n){return typeof n=="boolean"}function Ut(n){return Array.isArray(n)}function ee(n){return typeof n=="string"}function Xn(n){return ee(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function W(n,t){if(!n)throw new Error(t)}function ne(n,t,e=1/0){if(!(t<=n&&n<=e))throw new RangeError(`Value must be within [${t}, ${e}], got: ${n}`)}function Na(n){!n.isOffline&&n.state!=="running"&&Zr('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Ia=!1,ji=!1;function zi(n){Ia=n}function Rd(n){Dt(n)&&Ia&&!ji&&(ji=!0,Zr("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Ma=console;function Vd(...n){Ma.log(...n)}function Zr(...n){Ma.warn(...n)}function qd(n){return new yd(n)}function Ud(n,t,e){return new Id(n,t,e)}const At=typeof self=="object"?self:null,Ld=At&&(At.hasOwnProperty("AudioContext")||At.hasOwnProperty("webkitAudioContext"));function Bd(n,t,e){return W(z($i),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof At?.BaseAudioContext?At?.AudioWorkletNode:$i)(n,t,e)}function $t(n,t,e,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,t,e,s);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(i=(r<3?o(i):r>3?o(t,e,i):o(t,e))||i);return r>3&&i&&Object.defineProperty(t,e,i),i}function lt(n,t,e,s){function r(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):r(l.value).then(a,c)}u((s=s.apply(n,t||[])).next())})}class Wd{constructor(t,e,s,r){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),this._type==="worker"&&((e=this._worker)===null||e===void 0||e.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Ae(n){return Ed(n)}function le(n){return Od(n)}function es(n){return Dd(n)}function Ve(n){return Md(n)}function $d(n){return n instanceof da}function jd(n,t){return n==="value"||Ae(t)||le(t)||$d(t)}function We(n,...t){if(!t.length)return n;const e=t.shift();if(Se(n)&&Se(e))for(const s in e)jd(s,e[s])?n[s]=e[s]:Se(e[s])?(n[s]||Object.assign(n,{[s]:{}}),We(n[s],e[s])):Object.assign(n,{[s]:e[s]});return We(n,...t)}function zd(n,t){return n.length===t.length&&n.every((e,s)=>t[s]===e)}function L(n,t,e=[],s){const r={},i=Array.from(t);if(Se(i[0])&&s&&!Reflect.has(i[0],s)&&(Object.keys(i[0]).some(a=>Reflect.has(n,a))||(We(r,{[s]:i[0]}),e.splice(e.indexOf(s),1),i.shift())),i.length===1&&Se(i[0]))We(r,i[0]);else for(let o=0;o<e.length;o++)z(i[o])&&(r[e[o]]=i[o]);return We(n,r)}function Gd(n){return n.constructor.getDefaults()}function $e(n,t){return Dt(n)?t:n}function Gi(n,t){return t.forEach(e=>{Reflect.has(n,e)&&delete n[e]}),n}class ie{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||At&&this.toString()===At.TONE_DEBUG_CLASS)&&Vd(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ie.version=Fo;const Qr=1e-6;function Xe(n,t){return n>t+Qr}function yr(n,t){return Xe(n,t)||Ft(n,t)}function gs(n,t){return n+Qr<t}function Ft(n,t){return Math.abs(n-t)<Qr}function Xd(n,t,e){return Math.max(Math.min(n,e),t)}class Pt extends ie{constructor(){super(),this.name="Timeline",this._timeline=[];const t=L(Pt.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(W(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];W(yr(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(t){const e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Ft(this._timeline[e].time,t)){for(let s=e;s>=0&&Ft(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else this._timeline.length===1&&yr(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(this._timeline.length===0)return-1;let s=0;const r=this._timeline.length;let i=r;if(r>0&&this._timeline[r-1][e]<=t)return r-1;for(;s<i;){let o=Math.floor(s+(i-s)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Ft(a[e],t)){for(let u=o;u<this._timeline.length;u++){const l=this._timeline[u];if(Ft(l[e],t))o=u;else break}return o}else{if(gs(a[e],t)&&Xe(c[e],t))return o;Xe(a[e],t)?i=o:s=o+1}}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return s!==-1&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let r=this._search(t),i=this._search(e);return r!==-1&&i!==-1?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,r,i)):r===-1&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(s!==-1&&Ft(this._timeline[s].time,t)){let r=s;for(let i=s;i>=0&&Ft(this._timeline[i].time,t);i--)r=i;this._iterate(i=>{e(i)},r,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Oa=[];function Us(n){Oa.push(n)}function Hd(n){Oa.forEach(t=>t(n))}const Ea=[];function Ls(n){Ea.push(n)}function Yd(n){Ea.forEach(t=>t(n))}class qn extends ie{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(r=>{Dt(this._events)&&(this._events={}),this._events.hasOwnProperty(r)||(this._events[r]=[]),this._events[r].push(e)}),this}once(t,e){const s=(...r)=>{e(...r),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach(r=>{if(Dt(this._events)&&(this._events={}),this._events.hasOwnProperty(r))if(Dt(e))this._events[r]=[];else{const i=this._events[r];for(let o=i.length-1;o>=0;o--)i[o]===e&&i.splice(o,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let r=0,i=s.length;r<i;r++)s[r].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const s=Object.getOwnPropertyDescriptor(qn.prototype,e);Object.defineProperty(t.prototype,e,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class Da extends qn{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Un extends Da{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new Pt,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=L(Un.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((t=arguments[0])===null||t===void 0?void 0:t.latencyHint)||""):(this._context=qd({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new Wd(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((e=arguments[0])===null||e===void 0)&&e.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Hd(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return W(Ve(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return W(Ve(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return W(Ve(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){W(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){W(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){W(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){W(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return Bd(this.rawContext,t,e)}addAudioWorkletModule(t){return lt(this,void 0,void 0,function*(){W(z(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise})}workletsAreReady(){return lt(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Ve(this._context)?this._context.resume():Promise.resolve()}close(){return lt(this,void 0,void 0,function*(){Ve(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Yd(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=t;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=e,r.loop=!0,r.start(0),this._constants.set(t,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this.close(),this}_timeoutLoop(){const t=this.now();this._timeouts.forEachBefore(t,e=>{e.callback(),this._timeouts.remove(e)})}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,r=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),r()},id:s,time:i+e})};return r(),s}}class Zd extends Da{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t){return lt(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function st(n,t){Ut(t)?t.forEach(e=>st(n,e)):Object.defineProperty(n,t,{enumerable:!0,writable:!1})}function Jr(n,t){Ut(t)?t.forEach(e=>Jr(n,e)):Object.defineProperty(n,t,{writable:!0})}const H=()=>{};class J extends ie{constructor(){super(),this.name="ToneAudioBuffer",this.onload=H;const t=L(J.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,ee(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:H,onload:H,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Nt().sampleRate}set(t){return t instanceof J?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return lt(this,void 0,void 0,function*(){const e=J.load(t).then(s=>{this.set(s),this.onload(this)});J.downloads.push(e);try{yield e}finally{const s=J.downloads.indexOf(e);J.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Ut(t)&&t[0].length>0,s=e?t.length:1,r=e?t[0].length:t.length,i=Nt(),o=i.createBuffer(s,r,i.sampleRate),a=!e&&s===1?[t]:t;for(let c=0;c<s;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(t){if(he(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length);const s=this.numberOfChannels;for(let r=0;r<s;r++){const i=this.toArray(r);for(let o=0;o<i.length;o++)e[o]+=i[o]}e=e.map(r=>r/s),this.fromArray(e)}return this}toArray(t){if(he(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const e=[];for(let s=0;s<this.numberOfChannels;s++)e[s]=this.getChannelData(s);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){W(this.loaded,"Buffer is not loaded");const s=Math.floor(t*this.sampleRate),r=Math.floor(e*this.sampleRate);W(s<r,"The start time must be less than the end time");const i=r-s,o=Nt().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(s,r),a);return new J(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new J().fromArray(t)}static fromUrl(t){return lt(this,void 0,void 0,function*(){return yield new J().load(t)})}static load(t){return lt(this,void 0,void 0,function*(){const e=J.baseUrl===""||J.baseUrl.endsWith("/")?J.baseUrl:J.baseUrl+"/",s=yield fetch(e+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const r=yield s.arrayBuffer();return yield Nt().decodeAudioData(r)})}static supportsType(t){const e=t.split("."),s=e[e.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return lt(this,void 0,void 0,function*(){for(yield Promise.resolve();J.downloads.length;)yield J.downloads[0]})}}J.baseUrl="";J.downloads=[];class Kr extends Un{constructor(){super({clockSource:"offline",context:es(arguments[0])?arguments[0]:Ud(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:es(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=es(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return lt(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s===0&&(yield new Promise(r=>setTimeout(r,1)))}})}render(){return lt(this,arguments,void 0,function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new J(e)})}close(){return Promise.resolve()}}const Pa=new Zd;let Te=Pa;function Nt(){return Te===Pa&&Ld&&Fa(new Un),Te}function Fa(n,t=!1){t&&Te.dispose(),Ve(n)?Te=new Un(n):es(n)?Te=new Kr(n):Te=n}function Qd(){return Te.resume()}if(At&&!At.TONE_SILENCE_LOGGING){const t=` * Tone.js v${Fo} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Jd(n){return Math.pow(10,n/20)}function Kd(n){return 20*(Math.log(n)/Math.LN10)}function Ra(n){return Math.pow(2,n/12)}let Bs=440;function tp(){return Bs}function ep(n){Bs=n}function vr(n){return Math.round(Va(n))}function Va(n){return 69+12*Math.log2(n/Bs)}function np(n){return Bs*Math.pow(2,(n-69)/12)}class ti extends ie{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),r=e==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/s)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(e)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let r=0;return t&&t!=="0"&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r+=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r+=this._beatsToUnits(parseFloat(s)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof ti&&this.fromType(this._val),Dt(this._val))return this._noArg();if(ee(this._val)&&Dt(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Se(this._val)){let t=0;for(const e in this._val)if(z(this._val[e])){const s=this._val[e],r=new this.constructor(this.context,e).valueOf()*s;t+=r}return t}if(z(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}else return ee(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class qt extends ti{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new qt(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),r=this.valueOf(),a=Math.round(r/s)*s-r;return r+a*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);e.push(o+"n."),e.push(o+"n"),e.push(o+"t")}e.push("0");let s=e[0],r=new qt(this.context,e[0]).toSeconds();return e.forEach(i=>{const o=new qt(this.context,i).toSeconds();Math.abs(o-t)<Math.abs(r-t)&&(s=i,r=o)}),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let r=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=r.toString();return i.length>3&&(r=parseFloat(parseFloat(i).toFixed(3))),[s,e,r].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return vr(this.toFrequency())}_now(){return this.context.now()}}class Et extends qt{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return tp()}static set A4(t){ep(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:Et.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const r=sp[t.toLowerCase()]+(parseInt(e,10)+1)*12;return this.defaultUnits==="midi"?r:Et.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let r=1;return t&&t!=="0"&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(r*=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(r*=this._beatsToUnits(parseFloat(s)/4)),r}}})}transpose(t){return new Et(this.context,this.valueOf()*Ra(t))}harmonize(t){return t.map(e=>this.transpose(e))}toMidi(){return vr(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Et.A4);let s=Math.round(12*e)+57;const r=Math.floor(s/12);return r<0&&(s+=-12*r),rp[s%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return np(t)}static ftom(t){return vr(t)}}const sp={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},rp=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class bn extends qt{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class xt extends ie{constructor(){super();const t=L(xt.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Nt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return Rd(t),new qt(this.context,t).toSeconds()}toFrequency(t){return new Et(this.context,t).toFrequency()}toTicks(t){return new bn(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(s=>{Dt(t[s])&&delete e[s]}),e}get(){const t=Gd(this);return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const s=this[e];z(s)&&z(s.value)&&z(s.setValueAtTime)?t[e]=s.value:s instanceof xt?t[e]=s._getPartialProperties(t[e]):Ut(s)||he(s)||ee(s)||Fd(s)?t[e]=s:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&z(this[e])&&(this[e]&&z(this[e].value)&&z(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof xt?this[e].set(t[e]):this[e]=t[e])}),this}}class ei extends Pt{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return e!==null?e.state:this._initial}setStateAtTime(t,e,s){return ne(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){const s=this._search(e);for(let r=s;r>=0;r--){const i=this._timeline[r];if(i.state===t)return i}}getNextState(t,e){const s=this._search(e);if(s!==-1)for(let r=s;r<this._timeline.length;r++){const i=this._timeline[r];if(i.state===t)return i}}}class Z extends xt{constructor(){const t=L(Z.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,W(z(t.param)&&(Ae(t.param)||t.param instanceof Z),"param must be an AudioParam");!Ae(t.param);)t.param=t.param._param;this._swappable=z(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Pt(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,z(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(xt.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return z(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return z(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return z(this.maxValue)&&z(this.minValue)&&ne(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Jd(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?Kd(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),r=this._fromType(t);return W(isFinite(r)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(r),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),r=this._events.get(e);let i=this._initialValue;if(r===null)i=this._initialValue;else if(r.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const o=this._events.getBefore(r.time);let a;o===null?a=this._initialValue:a=o.value,r.type==="setTargetAtTime"&&(i=this._exponentialApproach(r.time,a,r.value,r.constant,e))}else if(s===null)i=r.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let o=r.value;if(r.type==="setTargetAtTime"){const a=this._events.getBefore(r.time);a===null?o=this._initialValue:o=a.value}s.type==="linearRampToValueAtTime"?i=this._linearInterpolate(r.time,o,s.time,s.value,e):i=this._exponentialInterpolate(r.time,o,s.time,s.value,e)}else i=r.value;return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(e)===0&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),r=this.toSeconds(e);return W(isFinite(s)&&isFinite(r),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:r,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,r),this._param.linearRampToValueAtTime(s,r),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=Ft(s,0)?this._minOutput:s,this._assertRange(s);const r=this.toSeconds(e);return W(isFinite(s)&&isFinite(r),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,r),this._param.exponentialRampToValueAtTime(s,r),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const r=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,r),this.cancelAndHoldAtTime(e+s*.9),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const r=this._fromType(t);W(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(r),W(isFinite(r)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(r,i,s),this}setValueCurveAtTime(t,e,s,r=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*r;this.setValueAtTime(this._toType(i),e);const o=s/(t.length-1);for(let a=1;a<t.length;a++){const c=this._fromType(t[a])*r;this.linearRampToValueAtTime(this._toType(c),e+a*o)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return W(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));W(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const r=this._events.get(e),i=this._events.getAfter(e);return r&&Ft(r.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),e):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&s.type==="setTargetAtTime"){const r=this._events.getAfter(s.time),i=r?r.time:e+2,o=(i-e)/10;for(let a=e;a<i;a+=o)t.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,r=>{r.type==="cancelScheduledValues"?t.cancelScheduledValues(r.time):r.type==="setTargetAtTime"?t.setTargetAtTime(r.value,r.time,r.constant):t[r.type](r.value,r.time)}),this}setParam(t){W(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,r,i){return s+(e-s)*Math.exp(-(i-t)/r)}_linearInterpolate(t,e,s,r,i){return e+(r-e)*((i-t)/(s-t))}_exponentialInterpolate(t,e,s,r,i){return e*Math.pow(r/e,(i-t)/(s-t))}}class U extends xt{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return z(this.input)?Ae(this.input)||this.input instanceof Z?1:this.input.numberOfInputs:0}get numberOfOutputs(){return z(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return z(t)&&(t instanceof U||le(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(s=>{s.channelCount=t.channelCount,s.channelCountMode=t.channelCountMode,s.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();W(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return cn(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Zr("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return ip(this,t,e,s),this}chain(...t){return _s(this,...t),this}fan(...t){return t.forEach(e=>this.connect(e)),this}dispose(){return super.dispose(),z(this.input)&&(this.input instanceof U?this.input.dispose():le(this.input)&&this.input.disconnect()),z(this.output)&&(this.output instanceof U?this.output.dispose():le(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function _s(...n){const t=n.shift();n.reduce((e,s)=>(e instanceof U?e.connect(s):le(e)&&cn(e,s),s),t)}function cn(n,t,e=0,s=0){for(W(z(n),"Cannot connect from undefined node"),W(z(t),"Cannot connect to undefined node"),(t instanceof U||le(t))&&W(t.numberOfInputs>0,"Cannot connect to node with no inputs"),W(n.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof U||t instanceof Z;)z(t.input)&&(t=t.input);for(;n instanceof U;)z(n.output)&&(n=n.output);Ae(t)?n.connect(t,e):n.connect(t,e,s)}function ip(n,t,e=0,s=0){if(z(t))for(;t instanceof U;)t=t.input;for(;!le(n);)z(n.output)&&(n=n.output);Ae(t)?n.disconnect(t,e):le(t)?n.disconnect(t,e,s):n.disconnect()}class ft extends U{constructor(){const t=L(ft.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Z({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),st(this,"gain")}static getDefaults(){return Object.assign(U.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class He extends U{constructor(t){super(t),this.onended=H,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ft({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const s=this.toSeconds(e);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(U.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:H})}_startGain(t,e=1){W(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){W(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?e*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==H&&(this.onended(this),this.onended=H,!this.context.isOffline)){const t=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(t):setTimeout(t,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),W(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=H,this}}class ni extends He{constructor(){const t=L(ni.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),cn(this._source,this._gainNode),this.offset=new Z({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(He.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ot extends U{constructor(){const t=L(ot.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new ni({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(U.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return si(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,r){return this._param.setValueCurveAtTime(t,e,s,r),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function si(n,t,e,s){(t instanceof Z||Ae(t)||t instanceof ot&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof ot&&(t.overridden=!0)),cn(n,t,e,s)}class ri extends Z{constructor(){const t=L(ri.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new Pt(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Z.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const r=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(1/s,1));for(let a=0;a<=o;a++){const c=s*a+e,u=this._exponentialApproach(i.time,i.value,r,s,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const r=this._events.get(s),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,s);return r.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),r=this._events.get(e),i=Math.round(Math.max((e-r.time)*10,1)),o=(e-r.time)/i;for(let a=0;a<=i;a++){const c=o*a+r.time,u=this._exponentialInterpolate(r.time,r.value,e,s,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}_getTicksUntilEvent(t,e){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Dt(t.ticks)){const o=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(o,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let r=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&i.type==="setValueAtTime"&&(r=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+r)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(e);return this.getTimeOfTick(r+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&s.type==="linearRampToValueAtTime"&&e.value!==s.value){const r=this._fromType(this.getValueAtTime(e.time)),o=(this._fromType(this.getValueAtTime(s.time))-r)/(s.time-e.time),a=Math.sqrt(Math.pow(r,2)-2*o*(e.ticks-t)),c=(-r+a)/o,u=(-r-a)/o;return(c>0?c:u)+e.time}else return e?e.value===0?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),r=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+r)-i}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class ii extends ot{constructor(){const t=L(ii.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new ri({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(ot.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class oi extends xt{constructor(){const t=L(oi.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new ei,this._tickOffset=new Pt,this._ticksAtTime=new Pt,this._secondsAtTime=new Pt,this.frequency=new ii({context:this.context,units:t.units,value:t.frequency}),st(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},xt.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),z(e)&&this.setTicksAtTime(e,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(t){const e=this.toSeconds(t);if(this._state.getValueAtTime(e)==="stopped"){const s=this._state.get(e);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),r=this._ticksAtTime.get(e),i={state:"paused",time:e};this._state.add(i);let o=r||s,a=r?r.ticks:0,c=null;return this._state.forEachBetween(o.time,e+this.sampleTime,u=>{let l=o.time;const h=this._tickOffset.get(u.time);h&&h.time>=o.time&&(a=h.ticks,l=h.time),o.state==="started"&&u.state!=="started"&&(a+=this.frequency.getTicksAtTime(u.time)-this.frequency.getTicksAtTime(l),u.time!==i.time&&(c={state:u.state,time:u.time,ticks:a})),o=u}),this._state.remove(i),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);const r=this._secondsAtTime.get(t);let i=r||e,o=r?r.seconds:0,a=null;return this._state.forEachBetween(i.time,t+this.sampleTime,c=>{let u=i.time;const l=this._tickOffset.get(c.time);l&&l.time>=i.time&&(o=l.seconds,u=l.time),i.state==="started"&&c.state!=="started"&&(o+=c.time-u,c.time!==s.time&&(a={state:c.state,time:c.time,seconds:o})),i=c}),this._state.remove(s),a&&this._secondsAtTime.add(a),o}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),r=this._state.get(e),i=Math.max(s.time,r.time),o=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(t,e,s){let r=this._state.get(t);this._state.forEachBetween(t,e,o=>{r&&r.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(r.time,t),o.time-this.sampleTime,s),r=o});let i=null;if(r&&r.state==="started"){const o=Math.max(r.time,t),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(r.time),u=a-c;let l=Math.ceil(u)-u;l=Ft(l,1)?0:l;let h=this.frequency.getTimeOfTick(a+l);for(;h<e;){try{s(h,Math.round(this.getTicksAtTime(h)))}catch(f){i=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Ws extends xt{constructor(){const t=L(Ws.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=H,this._lastUpdate=0,this._state=new ei("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new oi({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,st(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(xt.getDefaults(),{callback:H,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Na(this.context);const s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),r=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(r+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,s=>{switch(s.state){case"started":const r=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,r);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(t,e,(s,r)=>{this.callback(s,r)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}qn.mixin(Ws);class un extends U{constructor(){const t=L(un.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new ft({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,st(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class ai extends U{constructor(){const t=L(ai.getDefaults(),arguments);super(t),this.name="Destination",this.input=new un({context:this.context}),this.output=new ft({context:this.context}),this.volume=this.input.volume,_s(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),_s(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Us(n=>{n.destination=new ai({context:n})});Ls(n=>{n.destination.dispose()});class op extends U{constructor(){super(...arguments),this.name="Listener",this.positionX=new Z({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Z({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Z({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Z({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Z({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Z({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Z({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Z({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Z({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(U.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Us(n=>{n.listener=new op({context:n})});Ls(n=>{n.listener.dispose()});class ci extends ie{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=L(ci.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:H,onload:H,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return W(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,s=H,r=H){return ee(e)?(this.baseUrl&&e.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(t.toString(),new J(this.baseUrl+e,s,r))):this._buffers.set(t.toString(),new J(e,s,r)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class Ue extends bn{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class ap extends xt{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Pt,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;this._events.forEachBefore(t+this.anticipation,e=>{t-e.time<=this.expiration&&e.callback(),this._events.remove(e)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Us(n=>{n.draw=new ap({context:n})});Ls(n=>{n.draw.dispose()});class cp extends ie{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){W(z(t.time),"Events must have a time property"),W(z(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new up(t.time,t.time+t.duration,t);for(this._root===null?this._root=e:this._root.insert(e),this._length++;e!==null;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(this._root!==null){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,e=>this.remove(e)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,e){t.parent!==null?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{const e=t.getBalance();let s,r=null;if(e>0)if(t.left.right===null)s=t.left,s.right=t.right,r=s;else{for(s=t.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,r=s.parent,s.left=t.left,s.right=t.right)}else if(t.right.left===null)s=t.right,s.left=t.left,r=s;else{for(s=t.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,r=s.parent,s.left=t.left,s.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=s:t.parent.right=s:this._setRoot(s),r&&this._rebalance(r)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),r=t.right;r&&(t.right=r.left,r.left=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),r=t.left;r&&(t.left=r.right,r.right=t),e!==null?s?e.left=r:e.right=r:this._setRoot(r)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const e=[];if(this._root.search(t,e),e.length>0){let s=e[0];for(let r=1;r<e.length;r++)e[r].low>s.low&&(s=e[r]);return s.event}}return null}forEach(t){if(this._root!==null){const e=[];this._root.traverse(s=>e.push(s)),e.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,e){if(this._root!==null){const s=[];this._root.search(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}forEachFrom(t,e){if(this._root!==null){const s=[];this._root.searchAfter(t,s),s.forEach(r=>{r.event&&e(r.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class up{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(this.left!==null&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),this.left!==null&&this.left.searchAfter(t,e)),this.right!==null&&this.right.searchAfter(t,e)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class lp extends ie{constructor(t){super(),this.name="TimelineValue",this._timeline=new Pt({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Ye extends U{constructor(){super(L(Ye.getDefaults(),arguments,["context"]))}connect(t,e=0,s=0){return si(this,t,e,s),this}}class Ln extends Ye{constructor(){const t=L(Ln.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Ut(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Pd(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(ot.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let r=0,i=e;r<i;r++){const o=r/(i-1)*2-1;s[r]=t(o,r)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const e=["none","2x","4x"].some(s=>s.includes(t));W(e,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ui extends Ye{constructor(){const t=L(ui.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new Ln({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(Ye.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class fe{constructor(t,e){this.id=fe._eventId++,this._remainderTime=0;const s=Object.assign(fe.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:H,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}fe._eventId=0;class li extends fe{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(li.getDefaults(),e);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},fe.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return gs(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ue(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){gs(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ue(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);Xe(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class $s extends xt{constructor(){const t=L($s.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new lp(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Pt,this._repeatedEvents=new cp,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new Ws({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),st(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(xt.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!==0&&e%(this._swingTicks*2)!==0){const s=e%(this._swingTicks*2)/(this._swingTicks*2),r=Math.sin(s*Math.PI)*this._swingAmount;t+=new Ue(this.context,this._swingTicks*2/3).toSeconds()*r}zi(!0),this._timeline.forEachAtTime(e,s=>s.invoke(t)),zi(!1)}schedule(t,e){const s=new fe(this,{callback:t,time:new bn(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,r=1/0){const i=new li(this,{callback:t,duration:new qt(this.context,r).toTicks(),interval:new qt(this.context,e).toTicks(),time:new bn(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new fe(this,{callback:t,once:!0,time:new bn(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(e,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new Ue(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){this.context.resume();let s;return z(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Ut(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new qt(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new qt(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Ue(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Ue(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(e),r=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e),i=e+r;this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const e=this.now(),s=this.getTicksAtTime(e),r=t-s%t;return this._clock.nextTickTime(r,e)}}syncSignal(t,e){const s=this.now();let r=this.bpm,i=1/(60/r.getValueAtTime(s)/this.PPQ),o=[];if(t.units==="time"){const c=.015625/i,u=new ft(c),l=new ui(-1),h=new ft(c);r.chain(u,l,h),r=h,i=1/i,o=[u,l,h]}e||(t.getValueAtTime(s)!==0?e=t.getValueAtTime(s)/i:e=0);const a=new ft(e);return r.connect(a),a.connect(t._param),o.push(a),this._syncedSignals.push({initial:t.value,nodes:o,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.nodes.forEach(r=>r.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Jr(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}qn.mixin($s);Us(n=>{n.transport=new $s({context:n})});Ls(n=>{n.transport.dispose()});class It extends U{constructor(t){super(t),this.input=void 0,this._state=new ei("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=H,this._syncedStop=H,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new un({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,st(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,onstop:H,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let r=Dt(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),!this._synced&&this._state.getValueAtTime(r)==="started")W(Xe(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,e,s);else if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const i=this._state.get(r);i&&(i.offset=this.toSeconds($e(e,0)),i.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule(a=>{this._start(a,e,s)},r);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else Na(this.context),this._start(r,e,s);return this}stop(t){let e=Dt(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),this._state.getValueAtTime(e)==="started"||z(this._state.getNextState("started",e))){if(this.log("stop",e),!this._synced)this._stop(e);else{const s=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(s)}this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(Xe(e,0)){const s=this._state.get(e);if(s&&s.state==="started"&&s.time!==e){const r=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-r),this._start(t,this.toSeconds(s.offset)+r,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=H,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class js extends He{constructor(){const t=L(js.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,cn(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Z({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new J(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(He.getDefaults(),{url:new J,loop:!1,loopEnd:0,loopStart:0,onload:H,onerror:H,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,r=1){W(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,r),this.loop?e=$e(e,this.loopStart):e=$e(e,0);let o=Math.max(this.toSeconds(e),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),u=a-c;yr(o,a)&&(o=(o-c)%u+c),Ft(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,gs(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),z(s)){let a=this.toSeconds(s);a=Math.max(a,0),this.stop(i+a)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function De(n,t){return lt(this,void 0,void 0,function*(){const e=t/n.context.sampleRate,s=new Kr(1,e,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/e,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class hi extends He{constructor(){const t=L(hi.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],cn(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Z({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Z({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),st(this,["frequency","detune"])}static getDefaults(){return Object.assign(He.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ut extends It{constructor(){const t=L(ut.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new ot({context:this.context,units:"frequency",value:t.frequency}),st(this,"frequency"),this.detune=new ot({context:this.context,units:"cents",value:t.detune}),st(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(It.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new hi({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ut._periodicWaveCache.find(e=>e.phase===this._phase&&zd(e.partials,this._partials));{const t=ut._periodicWaveCache.find(e=>e.type===this._type&&e.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&e)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const s=this._getCachedPeriodicWave();if(z(s)){const{partials:r,wave:i}=s;this._wave=i,this._partials=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,i]=this._getRealImaginary(t,this._phase),o=this.context.createPeriodicWave(r,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ut._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),ut._periodicWaveCache.length>100&&ut._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){ne(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),this._type!=="custom")t===0?this.type=e:this.type=e+t.toString();else{const r=new Float32Array(t);this._partials.forEach((i,o)=>r[o]=i),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(t,e){let r=2048;const i=new Float32Array(r),o=new Float32Array(r);let a=1;if(t==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,r=a,this._partials.length===0)return[i,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),t=c[1],a=Math.max(a,2),r=a):this._partialCount=0,this._partials=[]}for(let c=1;c<r;++c){const u=2/(c*Math.PI);let l;switch(t){case"sine":l=c<=a?1:0,this._partials[c-1]=l;break;case"square":l=c&1?2*u:0,this._partials[c-1]=l;break;case"sawtooth":l=u*(c&1?1:-1),this._partials[c-1]=l;break;case"triangle":c&1?l=2*(u*u)*(c-1>>1&1?-1:1):l=0,this._partials[c-1]=l;break;case"custom":l=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}l!==0?(i[c]=-l*Math.sin(e*c),o[c]=l*Math.cos(e*c)):(i[c]=0,o[c]=0)}return[i,o]}_inverseFFT(t,e,s){let r=0;const i=t.length;for(let o=0;o<i;o++)r+=t[o]*Math.cos(o*s)+e[o]*Math.sin(o*s);return r}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const r=Math.PI*2,i=32;for(let o=0;o<i;o++)s=Math.max(this._inverseFFT(t,e,o/i*r),s);return Xd(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ut._periodicWaveCache=[];class hp extends Ye{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ln({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ze extends ot{constructor(){const t=L(Ze.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ft({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(ot.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class zs extends It{constructor(){const t=L(zs.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new hp({context:this.context}),this._modulationNode=new ft({context:this.context}),this._carrier=new ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ut({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ze({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),st(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ut.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Gs extends It{constructor(){const t=L(Gs.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new ft({context:this.context,gain:0}),this._carrier=new ut({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new ot({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ut({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Ze({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Ze({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),st(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ut.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Bn extends It{constructor(){const t=L(Bn.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new ft({context:this.context,gain:0}),this._thresh=new Ln({context:this.context,mapping:e=>e<=0?-1:1}),this.width=new ot({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),st(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(It.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Xs extends It{constructor(){const t=L(Xs.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new ot({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ot({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,st(this,["frequency","detune"])}static getDefaults(){return Object.assign(ut.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach((r,i)=>r.detune.value=e+s*i)}}get count(){return this._oscillators.length}set count(t){if(ne(t,1),this._oscillators.length!==t){this._forEach(e=>e.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const s=new ut({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:e===0?()=>this.onstop(this):H});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,this.state==="started"&&this._forEach(e=>e.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((e,s)=>e.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class Hs extends It{constructor(){const t=L(Hs.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ze({context:this.context,value:2}),this._pulse=new Bn({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),st(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(It.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Xi={am:zs,fat:Xs,fm:Gs,oscillator:ut,pulse:Bn,pwm:Hs};class ys extends It{constructor(){const t=L(ys.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new ot({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ot({context:this.context,units:"cents",value:t.detune}),st(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ut.getDefaults(),Gs.getDefaults(),zs.getDefaults(),Xs.getDefaults(),Bn.getDefaults(),Hs.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(e=>this._sourceType===e)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Xi[t],s=this.now();if(this._oscillator){const r=this._oscillator;r.stop(s),this.context.setTimeout(()=>r.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(e=this._oscillator.type),t==="fm"?this.type="fm"+e:t==="am"?this.type="am"+e:t==="fat"?this.type="fat"+e:t==="oscillator"?this.type=e:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,e){return t instanceof Xi[e]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&he(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&he(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ee(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return lt(this,arguments,void 0,function*(t=1024){return De(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function qa(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ne(i,n,t),e.set(this,i)}})}}function oe(n,t=1/0){const e=new WeakMap;return function(s,r){Reflect.defineProperty(s,r,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){ne(this.toSeconds(i),n,t),e.set(this,i)}})}}class Ys extends It{constructor(){const t=L(Ys.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new J({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(It.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:H,onerror:H,playbackRate:1,reverse:!1})}load(t){return lt(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=H){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){this._loop?e=$e(e,this._loopStart):e=$e(e,0);const r=this.toSeconds(e),i=s;s=$e(s,Math.max(this._buffer.duration-r,0));let o=this.toSeconds(s);o=o/this._playbackRate,t=this.toSeconds(t);const a=new js({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+o),this._state.setStateAtTime("stopped",t+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Dt(i)?a.start(t,r):a.start(t,r,o-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(e))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var r;(r=[...this._activeSources].pop())===null||r===void 0||r.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="started"){const r=this.toSeconds(t);this._stop(s),this._start(s,r)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&ne(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&ne(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(r=>r.cancelStop())),this._activeSources.forEach(r=>{r.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}$t([oe(0)],Ys.prototype,"fadeIn",void 0);$t([oe(0)],Ys.prototype,"fadeOut",void 0);class me extends U{constructor(){const t=L(me.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new ot({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(U.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(ee(t))return t;{let s;for(s in Hn)if(Hn[s][e]===t)return s;return t}}_setCurve(t,e,s){if(ee(s)&&Reflect.has(Hn,s)){const r=Hn[s];Se(r)?t!=="_decayCurve"&&(this[t]=r[e]):this[t]=r}else if(Ut(s)&&t!=="_decayCurve")this[t]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let r=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(t);if(o>0){const a=1/r;r=(1-o)/a}if(r<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(e,r,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(e,r,t);else{this._sig.cancelAndHoldAtTime(t);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,t,r,e)}if(i&&this.sustain<1){const a=e*this.sustain,c=t+r;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,i+c):this._sig.exponentialApproachValueAtTime(a,c,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(W(Ut(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return si(this,t,e,s),this}asArray(){return lt(this,arguments,void 0,function*(t=1024){const e=t/this.context.sampleRate,s=new Kr(1,e,this.context.sampleRate),r=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=r+this.toSeconds(this.release),o=i*.1,a=i+o,c=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/a,decay:e*this.toSeconds(this.decay)/a,release:e*this.toSeconds(this.release)/a,context:s}));return c._sig.toDestination(),c.triggerAttackRelease(e*(r+o)/a,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}$t([oe(0)],me.prototype,"attack",void 0);$t([oe(0)],me.prototype,"decay",void 0);$t([qa(0,1)],me.prototype,"sustain",void 0);$t([oe(0)],me.prototype,"release",void 0);const Hn=(()=>{let t,e;const s=[];for(t=0;t<128;t++)s[t]=Math.sin(t/127*(Math.PI/2));const r=[],i=6.4;for(t=0;t<127;t++){e=t/127;const f=Math.sin(e*(Math.PI*2)*i-Math.PI/2)+1;r[t]=f/10+e*.83}r[127]=1;const o=[],a=5;for(t=0;t<128;t++)o[t]=Math.ceil(t/127*a)/a;const c=[];for(t=0;t<128;t++)e=t/127,c[t]=.5*(1-Math.cos(Math.PI*e));const u=[];for(t=0;t<128;t++){e=t/127;const f=Math.pow(e,3)*4+.2,d=Math.cos(f*Math.PI*2*e);u[t]=Math.abs(d*(1-e))}function l(f){const d=new Array(f.length);for(let p=0;p<f.length;p++)d[p]=1-f[p];return d}function h(f){return f.slice(0).reverse()}return{bounce:{In:l(u),Out:u},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:r,Out:l(r)},sine:{In:c,Out:l(c)},step:{In:o,Out:l(o)}}})();let vs=class Ua extends U{constructor(){const t=L(Ua.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=e=>this._original_triggerRelease(e),this._volume=this.output=new un({context:this.context,volume:t.volume}),this.volume=this._volume.volume,st(this,"volume")}static getDefaults(){return Object.assign(U.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...r)=>{const i=r[e],o=this.context.transport.schedule(a=>{r[e]=a,s.apply(this,r)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,s,r){const i=this.toSeconds(s),o=this.toSeconds(e);return this.triggerAttack(t,i,r),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}};class Qe extends vs{constructor(){const t=L(Qe.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(vs.getDefaults(),{detune:0,onsilence:H,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const r=this.toSeconds(e);return this._triggerEnvelopeAttack(r,s),this.setNote(t,r),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),r=t instanceof Et?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,i,s)}else this.frequency.setValueAtTime(r,s);return this}}$t([oe(0)],Qe.prototype,"portamento",void 0);class fi extends me{constructor(){super(L(fi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ft({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class kn extends Qe{constructor(){const t=L(kn.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new ys(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new fi(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),st(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Qe.getDefaults(),{envelope:Object.assign(Gi(me.getDefaults(),Object.keys(U.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Gi(ys.getDefaults(),[...Object.keys(It.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+r)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class ws extends U{constructor(){const t=L(ws.getDefaults(),arguments,["frequency","type"]);super(t),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Z({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Z({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Z({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Z({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(U.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){W(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let o=0;o<t;o++){const c=Math.pow(o/t,2)*19980+20;e[o]=c}const s=new Float32Array(t),r=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,s,r),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class di extends U{constructor(){const t=L(di.getDefaults(),arguments,["frequency","type","rolloff"]);super(t),this.name="Filter",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._filters=[],this._filters=[],this.Q=new ot({context:this.context,units:"positive",value:t.Q}),this.frequency=new ot({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ot({context:this.context,units:"cents",value:t.detune}),this.gain=new ot({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,st(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(U.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){W(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._type=t,this._filters.forEach(s=>s.type=t)}get rolloff(){return this._rolloff}set rolloff(t){const e=he(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let r=s.indexOf(e);W(r!==-1,`rolloff can only be ${s.join(", ")}`),r+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(i=>i.disconnect()),this._filters=new Array(r);for(let i=0;i<r;i++){const o=new ws({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}this._internalChannels=this._filters,_s(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new ws({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((i,o)=>s[o]*=i)}),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),Jr(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Zs extends kn{constructor(){const t=L(Zs.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,st(this,["oscillator","envelope"])}static getDefaults(){return We(Qe.getDefaults(),kn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),r=this.toFrequency(t instanceof Et?t.toFrequency():t),i=r*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(r,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}$t([qa(0)],Zs.prototype,"octaves",void 0);$t([oe(0)],Zs.prototype,"pitchDecay",void 0);const La=new Set;function pi(n){La.add(n)}function Ba(n,t){const e=`registerProcessor("${n}", ${t})`;La.add(e)}const fp=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;pi(fp);const dp=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;pi(dp);const pp=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;pi(pp);const mp="feedback-comb-filter",gp=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Ba(mp,gp);class Je extends vs{constructor(){const t=L(Je.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach(s=>{const r=parseInt(s,10);if(W(Xn(s)||he(r)&&isFinite(r),`url key is neither a note or midi pitch: ${s}`),Xn(s)){const i=new Et(this.context,s).toMidi();e[i]=t.urls[s]}else he(r)&&isFinite(r)&&(e[r]=t.urls[r])}),this._buffers=new ci({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(vs.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:H,onerror:H,release:.1,urls:{}})}_findClosest(t){let s=0;for(;s<96;){if(this._buffers.has(t+s))return-s;if(this._buffers.has(t-s))return s;s++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach(r=>{const i=Va(new Et(this.context,r).toFrequency()),o=Math.round(i),a=i-o,c=this._findClosest(o),u=o-c,l=this._buffers.get(u),h=Ra(c+a),f=new js({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(e,0,l.duration/h,s),Ut(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const d=this._activeSources.get(o),p=d.indexOf(f);p!==-1&&d.splice(p,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(s=>{const r=new Et(this.context,s).toMidi();if(this._activeSources.has(r)&&this._activeSources.get(r).length){const i=this._activeSources.get(r);e=this.toSeconds(e),i.forEach(o=>{o.stop(e)}),this._activeSources.set(r,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,r=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,r),Ut(e)?(W(Ut(t),"notes must be an array when duration is array"),t.forEach((o,a)=>{const c=e[Math.min(a,e.length-1)];this.triggerRelease(o,i+this.toSeconds(c))})):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(W(Xn(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Xn(t)){const r=new Et(this.context,t).toMidi();this._buffers.add(r,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(e=>e.dispose())}),this._activeSources.clear(),this}}$t([oe(0)],Je.prototype,"attack",void 0);$t([oe(0)],Je.prototype,"release",void 0);class mi extends U{constructor(){const t=L(mi.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Z({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",st(this,"pan")}static getDefaults(){return Object.assign(U.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const _p="bit-crusher",yp=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Ba(_p,yp);class gi extends U{constructor(){const t=L(gi.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(U.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Tn extends U{constructor(){const t=L(Tn.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new ft({context:this.context}),this._split=new gi({context:this.context,channels:t.channels}),this.input.connect(this._split),ne(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(U.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{const s=this._buffers[e];this._type==="fft"?t.getFloatFrequencyData(s):this._type==="waveform"&&t.getFloatTimeDomainData(s)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((e,s)=>{e.fftSize=t*2,this._buffers[s]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){W(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(e=>e.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class ct extends U{constructor(){const t=L(ct.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new ft({context:this.context}),ct._allSolos.has(this.context)||ct._allSolos.set(this.context,new Set),ct._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(U.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),ct._allSolos.get(this.context).forEach(e=>e._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){ct._soloed.has(this.context)||ct._soloed.set(this.context,new Set),ct._soloed.get(this.context).add(this)}_removeSolo(){ct._soloed.has(this.context)&&ct._soloed.get(this.context).delete(this)}_isSoloed(){return ct._soloed.has(this.context)&&ct._soloed.get(this.context).has(this)}_noSolos(){return!ct._soloed.has(this.context)||ct._soloed.has(this.context)&&ct._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ct._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ct._allSolos=new Map;ct._soloed=new Map;class _i extends U{constructor(){const t=L(_i.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new mi({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new un({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,st(this,["pan","volume"])}static getDefaults(){return Object.assign(U.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Le extends U{constructor(){const t=L(Le.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new ct({solo:t.solo,context:this.context}),this._panVol=this.output=new _i({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),st(this,["pan","volume"])}static getDefaults(){return Object.assign(U.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Le.buses.has(t)||Le.buses.set(t,new ft({context:this.context})),Le.buses.get(t)}send(t,e=0){const s=this._getBus(t),r=new ft({context:this.context,units:"decibels",gain:e});return this.connect(r),r.connect(s),r}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Le.buses=new Map;function Ne(){return Nt().now()}Nt().transport;Nt().destination;Nt().destination;function Hi(){return Nt().destination}Nt().listener;Nt().draw;Nt();function vp(){return J.loaded()}function ns(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function wp(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function Wa(n){let t,e,s;n.length!==2?(t=ns,e=(a,c)=>ns(n(a),c),s=(a,c)=>n(a)-c):(t=n===ns||n===wp?n:bp,e=n,s=n);function r(a,c,u=0,l=a.length){if(u<l){if(t(c,c)!==0)return l;do{const h=u+l>>>1;e(a[h],c)<0?u=h+1:l=h}while(u<l)}return u}function i(a,c,u=0,l=a.length){if(u<l){if(t(c,c)!==0)return l;do{const h=u+l>>>1;e(a[h],c)<=0?u=h+1:l=h}while(u<l)}return u}function o(a,c,u=0,l=a.length){const h=r(a,c,u,l-1);return h>u&&s(a[h-1],c)>-s(a[h],c)?h-1:h}return{left:r,center:o,right:i}}function bp(){return 0}function Tp(n){return n===null?NaN:+n}const xp=Wa(ns),Sp=xp.right;Wa(Tp).center;const Cp=Math.sqrt(50),kp=Math.sqrt(10),Ap=Math.sqrt(2);function bs(n,t,e){const s=(t-n)/Math.max(0,e),r=Math.floor(Math.log10(s)),i=s/Math.pow(10,r),o=i>=Cp?10:i>=kp?5:i>=Ap?2:1;let a,c,u;return r<0?(u=Math.pow(10,-r)/o,a=Math.round(n*u),c=Math.round(t*u),a/u<n&&++a,c/u>t&&--c,u=-u):(u=Math.pow(10,r)*o,a=Math.round(n/u),c=Math.round(t/u),a*u<n&&++a,c*u>t&&--c),c<a&&.5<=e&&e<2?bs(n,t,e*2):[a,c,u]}function Np(n,t,e){if(t=+t,n=+n,e=+e,!(e>0))return[];if(n===t)return[n];const s=t<n,[r,i,o]=s?bs(t,n,e):bs(n,t,e);if(!(i>=r))return[];const a=i-r+1,c=new Array(a);if(s)if(o<0)for(let u=0;u<a;++u)c[u]=(i-u)/-o;else for(let u=0;u<a;++u)c[u]=(i-u)*o;else if(o<0)for(let u=0;u<a;++u)c[u]=(r+u)/-o;else for(let u=0;u<a;++u)c[u]=(r+u)*o;return c}function wr(n,t,e){return t=+t,n=+n,e=+e,bs(n,t,e)[2]}function Ip(n,t,e){t=+t,n=+n,e=+e;const s=t<n,r=s?wr(t,n,e):wr(n,t,e);return(s?-1:1)*(r<0?1/-r:r)}function Mp(n,t,e){n=+n,t=+t,e=(r=arguments.length)<2?(t=n,n=0,1):r<3?1:+e;for(var s=-1,r=Math.max(0,Math.ceil((t-n)/e))|0,i=new Array(r);++s<r;)i[s]=n+s*e;return i}var Op={value:()=>{}};function $a(){for(var n=0,t=arguments.length,e={},s;n<t;++n){if(!(s=arguments[n]+"")||s in e||/[\s.]/.test(s))throw new Error("illegal type: "+s);e[s]=[]}return new ss(e)}function ss(n){this._=n}function Ep(n,t){return n.trim().split(/^|\s+/).map(function(e){var s="",r=e.indexOf(".");if(r>=0&&(s=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:s}})}ss.prototype=$a.prototype={constructor:ss,on:function(n,t){var e=this._,s=Ep(n+"",e),r,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((r=(n=s[i]).type)&&(r=Dp(e[r],n.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(r=(n=s[i]).type)e[r]=Yi(e[r],n.name,t);else if(t==null)for(r in e)e[r]=Yi(e[r],n.name,null);return this},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new ss(n)},call:function(n,t){if((r=arguments.length-2)>0)for(var e=new Array(r),s=0,r,i;s<r;++s)e[s]=arguments[s+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(i=this._[n],s=0,r=i.length;s<r;++s)i[s].value.apply(t,e)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(t,e)}};function Dp(n,t){for(var e=0,s=n.length,r;e<s;++e)if((r=n[e]).name===t)return r.value}function Yi(n,t,e){for(var s=0,r=n.length;s<r;++s)if(n[s].name===t){n[s]=Op,n=n.slice(0,s).concat(n.slice(s+1));break}return e!=null&&n.push({name:t,value:e}),n}var br="http://www.w3.org/1999/xhtml";const Zi={svg:"http://www.w3.org/2000/svg",xhtml:br,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Qs(n){var t=n+="",e=t.indexOf(":");return e>=0&&(t=n.slice(0,e))!=="xmlns"&&(n=n.slice(e+1)),Zi.hasOwnProperty(t)?{space:Zi[t],local:n}:n}function Pp(n){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===br&&t.documentElement.namespaceURI===br?t.createElement(n):t.createElementNS(e,n)}}function Fp(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function ja(n){var t=Qs(n);return(t.local?Fp:Pp)(t)}function Rp(){}function yi(n){return n==null?Rp:function(){return this.querySelector(n)}}function Vp(n){typeof n!="function"&&(n=yi(n));for(var t=this._groups,e=t.length,s=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=s[r]=new Array(o),c,u,l=0;l<o;++l)(c=i[l])&&(u=n.call(c,c.__data__,l,i))&&("__data__"in c&&(u.__data__=c.__data__),a[l]=u);return new Mt(s,this._parents)}function qp(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Up(){return[]}function za(n){return n==null?Up:function(){return this.querySelectorAll(n)}}function Lp(n){return function(){return qp(n.apply(this,arguments))}}function Bp(n){typeof n=="function"?n=Lp(n):n=za(n);for(var t=this._groups,e=t.length,s=[],r=[],i=0;i<e;++i)for(var o=t[i],a=o.length,c,u=0;u<a;++u)(c=o[u])&&(s.push(n.call(c,c.__data__,u,o)),r.push(c));return new Mt(s,r)}function Ga(n){return function(){return this.matches(n)}}function Xa(n){return function(t){return t.matches(n)}}var Wp=Array.prototype.find;function $p(n){return function(){return Wp.call(this.children,n)}}function jp(){return this.firstElementChild}function zp(n){return this.select(n==null?jp:$p(typeof n=="function"?n:Xa(n)))}var Gp=Array.prototype.filter;function Xp(){return Array.from(this.children)}function Hp(n){return function(){return Gp.call(this.children,n)}}function Yp(n){return this.selectAll(n==null?Xp:Hp(typeof n=="function"?n:Xa(n)))}function Zp(n){typeof n!="function"&&(n=Ga(n));for(var t=this._groups,e=t.length,s=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&n.call(c,c.__data__,u,i)&&a.push(c);return new Mt(s,this._parents)}function Ha(n){return new Array(n.length)}function Qp(){return new Mt(this._enter||this._groups.map(Ha),this._parents)}function Ts(n,t){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=t}Ts.prototype={constructor:Ts,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,t){return this._parent.insertBefore(n,t)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Jp(n){return function(){return n}}function Kp(n,t,e,s,r,i){for(var o=0,a,c=t.length,u=i.length;o<u;++o)(a=t[o])?(a.__data__=i[o],s[o]=a):e[o]=new Ts(n,i[o]);for(;o<c;++o)(a=t[o])&&(r[o]=a)}function tm(n,t,e,s,r,i,o){var a,c,u=new Map,l=t.length,h=i.length,f=new Array(l),d;for(a=0;a<l;++a)(c=t[a])&&(f[a]=d=o.call(c,c.__data__,a,t)+"",u.has(d)?r[a]=c:u.set(d,c));for(a=0;a<h;++a)d=o.call(n,i[a],a,i)+"",(c=u.get(d))?(s[a]=c,c.__data__=i[a],u.delete(d)):e[a]=new Ts(n,i[a]);for(a=0;a<l;++a)(c=t[a])&&u.get(f[a])===c&&(r[a]=c)}function em(n){return n.__data__}function nm(n,t){if(!arguments.length)return Array.from(this,em);var e=t?tm:Kp,s=this._parents,r=this._groups;typeof n!="function"&&(n=Jp(n));for(var i=r.length,o=new Array(i),a=new Array(i),c=new Array(i),u=0;u<i;++u){var l=s[u],h=r[u],f=h.length,d=sm(n.call(l,l&&l.__data__,u,s)),p=d.length,m=a[u]=new Array(p),g=o[u]=new Array(p),_=c[u]=new Array(f);e(l,h,m,g,_,d,t);for(var w=0,T=0,v,y;w<p;++w)if(v=m[w]){for(w>=T&&(T=w+1);!(y=g[T])&&++T<p;);v._next=y||null}}return o=new Mt(o,s),o._enter=a,o._exit=c,o}function sm(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function rm(){return new Mt(this._exit||this._groups.map(Ha),this._parents)}function im(n,t,e){var s=this.enter(),r=this,i=this.exit();return typeof n=="function"?(s=n(s),s&&(s=s.selection())):s=s.append(n+""),t!=null&&(r=t(r),r&&(r=r.selection())),e==null?i.remove():e(i),s&&r?s.merge(r).order():r}function om(n){for(var t=n.selection?n.selection():n,e=this._groups,s=t._groups,r=e.length,i=s.length,o=Math.min(r,i),a=new Array(r),c=0;c<o;++c)for(var u=e[c],l=s[c],h=u.length,f=a[c]=new Array(h),d,p=0;p<h;++p)(d=u[p]||l[p])&&(f[p]=d);for(;c<r;++c)a[c]=e[c];return new Mt(a,this._parents)}function am(){for(var n=this._groups,t=-1,e=n.length;++t<e;)for(var s=n[t],r=s.length-1,i=s[r],o;--r>=0;)(o=s[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function cm(n){n||(n=um);function t(h,f){return h&&f?n(h.__data__,f.__data__):!h-!f}for(var e=this._groups,s=e.length,r=new Array(s),i=0;i<s;++i){for(var o=e[i],a=o.length,c=r[i]=new Array(a),u,l=0;l<a;++l)(u=o[l])&&(c[l]=u);c.sort(t)}return new Mt(r,this._parents).order()}function um(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function lm(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function hm(){return Array.from(this)}function fm(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var s=n[t],r=0,i=s.length;r<i;++r){var o=s[r];if(o)return o}return null}function dm(){let n=0;for(const t of this)++n;return n}function pm(){return!this.node()}function mm(n){for(var t=this._groups,e=0,s=t.length;e<s;++e)for(var r=t[e],i=0,o=r.length,a;i<o;++i)(a=r[i])&&n.call(a,a.__data__,i,r);return this}function gm(n){return function(){this.removeAttribute(n)}}function _m(n){return function(){this.removeAttributeNS(n.space,n.local)}}function ym(n,t){return function(){this.setAttribute(n,t)}}function vm(n,t){return function(){this.setAttributeNS(n.space,n.local,t)}}function wm(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(n):this.setAttribute(n,e)}}function bm(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}}function Tm(n,t){var e=Qs(n);if(arguments.length<2){var s=this.node();return e.local?s.getAttributeNS(e.space,e.local):s.getAttribute(e)}return this.each((t==null?e.local?_m:gm:typeof t=="function"?e.local?bm:wm:e.local?vm:ym)(e,t))}function Ya(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function xm(n){return function(){this.style.removeProperty(n)}}function Sm(n,t,e){return function(){this.style.setProperty(n,t,e)}}function Cm(n,t,e){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(n):this.style.setProperty(n,s,e)}}function km(n,t,e){return arguments.length>1?this.each((t==null?xm:typeof t=="function"?Cm:Sm)(n,t,e??"")):Ke(this.node(),n)}function Ke(n,t){return n.style.getPropertyValue(t)||Ya(n).getComputedStyle(n,null).getPropertyValue(t)}function Am(n){return function(){delete this[n]}}function Nm(n,t){return function(){this[n]=t}}function Im(n,t){return function(){var e=t.apply(this,arguments);e==null?delete this[n]:this[n]=e}}function Mm(n,t){return arguments.length>1?this.each((t==null?Am:typeof t=="function"?Im:Nm)(n,t)):this.node()[n]}function Za(n){return n.trim().split(/^|\s+/)}function vi(n){return n.classList||new Qa(n)}function Qa(n){this._node=n,this._names=Za(n.getAttribute("class")||"")}Qa.prototype={add:function(n){var t=this._names.indexOf(n);t<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var t=this._names.indexOf(n);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Ja(n,t){for(var e=vi(n),s=-1,r=t.length;++s<r;)e.add(t[s])}function Ka(n,t){for(var e=vi(n),s=-1,r=t.length;++s<r;)e.remove(t[s])}function Om(n){return function(){Ja(this,n)}}function Em(n){return function(){Ka(this,n)}}function Dm(n,t){return function(){(t.apply(this,arguments)?Ja:Ka)(this,n)}}function Pm(n,t){var e=Za(n+"");if(arguments.length<2){for(var s=vi(this.node()),r=-1,i=e.length;++r<i;)if(!s.contains(e[r]))return!1;return!0}return this.each((typeof t=="function"?Dm:t?Om:Em)(e,t))}function Fm(){this.textContent=""}function Rm(n){return function(){this.textContent=n}}function Vm(n){return function(){var t=n.apply(this,arguments);this.textContent=t??""}}function qm(n){return arguments.length?this.each(n==null?Fm:(typeof n=="function"?Vm:Rm)(n)):this.node().textContent}function Um(){this.innerHTML=""}function Lm(n){return function(){this.innerHTML=n}}function Bm(n){return function(){var t=n.apply(this,arguments);this.innerHTML=t??""}}function Wm(n){return arguments.length?this.each(n==null?Um:(typeof n=="function"?Bm:Lm)(n)):this.node().innerHTML}function $m(){this.nextSibling&&this.parentNode.appendChild(this)}function jm(){return this.each($m)}function zm(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Gm(){return this.each(zm)}function Xm(n){var t=typeof n=="function"?n:ja(n);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Hm(){return null}function Ym(n,t){var e=typeof n=="function"?n:ja(n),s=t==null?Hm:typeof t=="function"?t:yi(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),s.apply(this,arguments)||null)})}function Zm(){var n=this.parentNode;n&&n.removeChild(this)}function Qm(){return this.each(Zm)}function Jm(){var n=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function Km(){var n=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function tg(n){return this.select(n?Km:Jm)}function eg(n){return arguments.length?this.property("__data__",n):this.node().__data__}function ng(n){return function(t){n.call(this,t,this.__data__)}}function sg(n){return n.trim().split(/^|\s+/).map(function(t){var e="",s=t.indexOf(".");return s>=0&&(e=t.slice(s+1),t=t.slice(0,s)),{type:t,name:e}})}function rg(n){return function(){var t=this.__on;if(t){for(var e=0,s=-1,r=t.length,i;e<r;++e)i=t[e],(!n.type||i.type===n.type)&&i.name===n.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function ig(n,t,e){return function(){var s=this.__on,r,i=ng(t);if(s){for(var o=0,a=s.length;o<a;++o)if((r=s[o]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=e),r.value=t;return}}this.addEventListener(n.type,i,e),r={type:n.type,name:n.name,value:t,listener:i,options:e},s?s.push(r):this.__on=[r]}}function og(n,t,e){var s=sg(n+""),r,i=s.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,u=a.length,l;c<u;++c)for(r=0,l=a[c];r<i;++r)if((o=s[r]).type===l.type&&o.name===l.name)return l.value}return}for(a=t?ig:rg,r=0;r<i;++r)this.each(a(s[r],t,e));return this}function tc(n,t,e){var s=Ya(n),r=s.CustomEvent;typeof r=="function"?r=new r(t,e):(r=s.document.createEvent("Event"),e?(r.initEvent(t,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(t,!1,!1)),n.dispatchEvent(r)}function ag(n,t){return function(){return tc(this,n,t)}}function cg(n,t){return function(){return tc(this,n,t.apply(this,arguments))}}function ug(n,t){return this.each((typeof t=="function"?cg:ag)(n,t))}function*lg(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var s=n[t],r=0,i=s.length,o;r<i;++r)(o=s[r])&&(yield o)}var ec=[null];function Mt(n,t){this._groups=n,this._parents=t}function Wn(){return new Mt([[document.documentElement]],ec)}function hg(){return this}Mt.prototype=Wn.prototype={constructor:Mt,select:Vp,selectAll:Bp,selectChild:zp,selectChildren:Yp,filter:Zp,data:nm,enter:Qp,exit:rm,join:im,merge:om,selection:hg,order:am,sort:cm,call:lm,nodes:hm,node:fm,size:dm,empty:pm,each:mm,attr:Tm,style:km,property:Mm,classed:Pm,text:qm,html:Wm,raise:jm,lower:Gm,append:Xm,insert:Ym,remove:Qm,clone:tg,datum:eg,on:og,dispatch:ug,[Symbol.iterator]:lg};function $n(n){return typeof n=="string"?new Mt([[document.querySelector(n)]],[document.documentElement]):new Mt([[n]],ec)}function wi(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function nc(n,t){var e=Object.create(n.prototype);for(var s in t)e[s]=t[s];return e}function jn(){}var An=.7,xs=1/An,je="\\s*([+-]?\\d+)\\s*",Nn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fg=/^#([0-9a-f]{3,8})$/,dg=new RegExp(`^rgb\\(${je},${je},${je}\\)$`),pg=new RegExp(`^rgb\\(${zt},${zt},${zt}\\)$`),mg=new RegExp(`^rgba\\(${je},${je},${je},${Nn}\\)$`),gg=new RegExp(`^rgba\\(${zt},${zt},${zt},${Nn}\\)$`),_g=new RegExp(`^hsl\\(${Nn},${zt},${zt}\\)$`),yg=new RegExp(`^hsla\\(${Nn},${zt},${zt},${Nn}\\)$`),Qi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};wi(jn,Ie,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Ji,formatHex:Ji,formatHex8:vg,formatHsl:wg,formatRgb:Ki,toString:Ki});function Ji(){return this.rgb().formatHex()}function vg(){return this.rgb().formatHex8()}function wg(){return sc(this).formatHsl()}function Ki(){return this.rgb().formatRgb()}function Ie(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=fg.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?to(t):e===3?new Tt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Yn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Yn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=dg.exec(n))?new Tt(t[1],t[2],t[3],1):(t=pg.exec(n))?new Tt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=mg.exec(n))?Yn(t[1],t[2],t[3],t[4]):(t=gg.exec(n))?Yn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_g.exec(n))?so(t[1],t[2]/100,t[3]/100,1):(t=yg.exec(n))?so(t[1],t[2]/100,t[3]/100,t[4]):Qi.hasOwnProperty(n)?to(Qi[n]):n==="transparent"?new Tt(NaN,NaN,NaN,0):null}function to(n){return new Tt(n>>16&255,n>>8&255,n&255,1)}function Yn(n,t,e,s){return s<=0&&(n=t=e=NaN),new Tt(n,t,e,s)}function bg(n){return n instanceof jn||(n=Ie(n)),n?(n=n.rgb(),new Tt(n.r,n.g,n.b,n.opacity)):new Tt}function Tr(n,t,e,s){return arguments.length===1?bg(n):new Tt(n,t,e,s??1)}function Tt(n,t,e,s){this.r=+n,this.g=+t,this.b=+e,this.opacity=+s}wi(Tt,Tr,nc(jn,{brighter(n){return n=n==null?xs:Math.pow(xs,n),new Tt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?An:Math.pow(An,n),new Tt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Tt(Ce(this.r),Ce(this.g),Ce(this.b),Ss(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eo,formatHex:eo,formatHex8:Tg,formatRgb:no,toString:no}));function eo(){return`#${xe(this.r)}${xe(this.g)}${xe(this.b)}`}function Tg(){return`#${xe(this.r)}${xe(this.g)}${xe(this.b)}${xe((isNaN(this.opacity)?1:this.opacity)*255)}`}function no(){const n=Ss(this.opacity);return`${n===1?"rgb(":"rgba("}${Ce(this.r)}, ${Ce(this.g)}, ${Ce(this.b)}${n===1?")":`, ${n})`}`}function Ss(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ce(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function xe(n){return n=Ce(n),(n<16?"0":"")+n.toString(16)}function so(n,t,e,s){return s<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new Vt(n,t,e,s)}function sc(n){if(n instanceof Vt)return new Vt(n.h,n.s,n.l,n.opacity);if(n instanceof jn||(n=Ie(n)),!n)return new Vt;if(n instanceof Vt)return n;n=n.rgb();var t=n.r/255,e=n.g/255,s=n.b/255,r=Math.min(t,e,s),i=Math.max(t,e,s),o=NaN,a=i-r,c=(i+r)/2;return a?(t===i?o=(e-s)/a+(e<s)*6:e===i?o=(s-t)/a+2:o=(t-e)/a+4,a/=c<.5?i+r:2-i-r,o*=60):a=c>0&&c<1?0:o,new Vt(o,a,c,n.opacity)}function xg(n,t,e,s){return arguments.length===1?sc(n):new Vt(n,t,e,s??1)}function Vt(n,t,e,s){this.h=+n,this.s=+t,this.l=+e,this.opacity=+s}wi(Vt,xg,nc(jn,{brighter(n){return n=n==null?xs:Math.pow(xs,n),new Vt(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?An:Math.pow(An,n),new Vt(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,s=e+(e<.5?e:1-e)*t,r=2*e-s;return new Tt(nr(n>=240?n-240:n+120,r,s),nr(n,r,s),nr(n<120?n+240:n-120,r,s),this.opacity)},clamp(){return new Vt(ro(this.h),Zn(this.s),Zn(this.l),Ss(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Ss(this.opacity);return`${n===1?"hsl(":"hsla("}${ro(this.h)}, ${Zn(this.s)*100}%, ${Zn(this.l)*100}%${n===1?")":`, ${n})`}`}}));function ro(n){return n=(n||0)%360,n<0?n+360:n}function Zn(n){return Math.max(0,Math.min(1,n||0))}function nr(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const bi=n=>()=>n;function Sg(n,t){return function(e){return n+e*t}}function Cg(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(s){return Math.pow(n+s*t,e)}}function kg(n){return(n=+n)==1?rc:function(t,e){return e-t?Cg(t,e,n):bi(isNaN(t)?e:t)}}function rc(n,t){var e=t-n;return e?Sg(n,e):bi(isNaN(n)?t:n)}const Cs=(function n(t){var e=kg(t);function s(r,i){var o=e((r=Tr(r)).r,(i=Tr(i)).r),a=e(r.g,i.g),c=e(r.b,i.b),u=rc(r.opacity,i.opacity);return function(l){return r.r=o(l),r.g=a(l),r.b=c(l),r.opacity=u(l),r+""}}return s.gamma=n,s})(1);function Ag(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,s=t.slice(),r;return function(i){for(r=0;r<e;++r)s[r]=n[r]*(1-i)+t[r]*i;return s}}function Ng(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ig(n,t){var e=t?t.length:0,s=n?Math.min(e,n.length):0,r=new Array(s),i=new Array(e),o;for(o=0;o<s;++o)r[o]=Ti(n[o],t[o]);for(;o<e;++o)i[o]=t[o];return function(a){for(o=0;o<s;++o)i[o]=r[o](a);return i}}function Mg(n,t){var e=new Date;return n=+n,t=+t,function(s){return e.setTime(n*(1-s)+t*s),e}}function Rt(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function Og(n,t){var e={},s={},r;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in n?e[r]=Ti(n[r],t[r]):s[r]=t[r];return function(i){for(r in e)s[r]=e[r](i);return s}}var xr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,sr=new RegExp(xr.source,"g");function Eg(n){return function(){return n}}function Dg(n){return function(t){return n(t)+""}}function ic(n,t){var e=xr.lastIndex=sr.lastIndex=0,s,r,i,o=-1,a=[],c=[];for(n=n+"",t=t+"";(s=xr.exec(n))&&(r=sr.exec(t));)(i=r.index)>e&&(i=t.slice(e,i),a[o]?a[o]+=i:a[++o]=i),(s=s[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:Rt(s,r)})),e=sr.lastIndex;return e<t.length&&(i=t.slice(e),a[o]?a[o]+=i:a[++o]=i),a.length<2?c[0]?Dg(c[0].x):Eg(t):(t=c.length,function(u){for(var l=0,h;l<t;++l)a[(h=c[l]).i]=h.x(u);return a.join("")})}function Ti(n,t){var e=typeof t,s;return t==null||e==="boolean"?bi(t):(e==="number"?Rt:e==="string"?(s=Ie(t))?(t=s,Cs):ic:t instanceof Ie?Cs:t instanceof Date?Mg:Ng(t)?Ag:Array.isArray(t)?Ig:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Og:Rt)(n,t)}function Pg(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}var io=180/Math.PI,Sr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function oc(n,t,e,s,r,i){var o,a,c;return(o=Math.sqrt(n*n+t*t))&&(n/=o,t/=o),(c=n*e+t*s)&&(e-=n*c,s-=t*c),(a=Math.sqrt(e*e+s*s))&&(e/=a,s/=a,c/=a),n*s<t*e&&(n=-n,t=-t,c=-c,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(t,n)*io,skewX:Math.atan(c)*io,scaleX:o,scaleY:a}}var Qn;function Fg(n){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return t.isIdentity?Sr:oc(t.a,t.b,t.c,t.d,t.e,t.f)}function Rg(n){return n==null||(Qn||(Qn=document.createElementNS("http://www.w3.org/2000/svg","g")),Qn.setAttribute("transform",n),!(n=Qn.transform.baseVal.consolidate()))?Sr:(n=n.matrix,oc(n.a,n.b,n.c,n.d,n.e,n.f))}function ac(n,t,e,s){function r(u){return u.length?u.pop()+" ":""}function i(u,l,h,f,d,p){if(u!==h||l!==f){var m=d.push("translate(",null,t,null,e);p.push({i:m-4,x:Rt(u,h)},{i:m-2,x:Rt(l,f)})}else(h||f)&&d.push("translate("+h+t+f+e)}function o(u,l,h,f){u!==l?(u-l>180?l+=360:l-u>180&&(u+=360),f.push({i:h.push(r(h)+"rotate(",null,s)-2,x:Rt(u,l)})):l&&h.push(r(h)+"rotate("+l+s)}function a(u,l,h,f){u!==l?f.push({i:h.push(r(h)+"skewX(",null,s)-2,x:Rt(u,l)}):l&&h.push(r(h)+"skewX("+l+s)}function c(u,l,h,f,d,p){if(u!==h||l!==f){var m=d.push(r(d)+"scale(",null,",",null,")");p.push({i:m-4,x:Rt(u,h)},{i:m-2,x:Rt(l,f)})}else(h!==1||f!==1)&&d.push(r(d)+"scale("+h+","+f+")")}return function(u,l){var h=[],f=[];return u=n(u),l=n(l),i(u.translateX,u.translateY,l.translateX,l.translateY,h,f),o(u.rotate,l.rotate,h,f),a(u.skewX,l.skewX,h,f),c(u.scaleX,u.scaleY,l.scaleX,l.scaleY,h,f),u=l=null,function(d){for(var p=-1,m=f.length,g;++p<m;)h[(g=f[p]).i]=g.x(d);return h.join("")}}}var Vg=ac(Fg,"px, ","px)","deg)"),qg=ac(Rg,", ",")",")"),tn=0,yn=0,hn=0,cc=1e3,ks,vn,As=0,Me=0,Js=0,In=typeof performance=="object"&&performance.now?performance:Date,uc=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function xi(){return Me||(uc(Ug),Me=In.now()+Js)}function Ug(){Me=0}function Ns(){this._call=this._time=this._next=null}Ns.prototype=lc.prototype={constructor:Ns,restart:function(n,t,e){if(typeof n!="function")throw new TypeError("callback is not a function");e=(e==null?xi():+e)+(t==null?0:+t),!this._next&&vn!==this&&(vn?vn._next=this:ks=this,vn=this),this._call=n,this._time=e,Cr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cr())}};function lc(n,t,e){var s=new Ns;return s.restart(n,t,e),s}function Lg(){xi(),++tn;for(var n=ks,t;n;)(t=Me-n._time)>=0&&n._call.call(void 0,t),n=n._next;--tn}function oo(){Me=(As=In.now())+Js,tn=yn=0;try{Lg()}finally{tn=0,Wg(),Me=0}}function Bg(){var n=In.now(),t=n-As;t>cc&&(Js-=t,As=n)}function Wg(){for(var n,t=ks,e,s=1/0;t;)t._call?(s>t._time&&(s=t._time),n=t,t=t._next):(e=t._next,t._next=null,t=n?n._next=e:ks=e);vn=n,Cr(s)}function Cr(n){if(!tn){yn&&(yn=clearTimeout(yn));var t=n-Me;t>24?(n<1/0&&(yn=setTimeout(oo,n-In.now()-Js)),hn&&(hn=clearInterval(hn))):(hn||(As=In.now(),hn=setInterval(Bg,cc)),tn=1,uc(oo))}}function ao(n,t,e){var s=new Ns;return t=t==null?0:+t,s.restart(r=>{s.stop(),n(r+t)},t,e),s}var $g=$a("start","end","cancel","interrupt"),jg=[],hc=0,co=1,kr=2,rs=3,uo=4,Ar=5,is=6;function Ks(n,t,e,s,r,i){var o=n.__transition;if(!o)n.__transition={};else if(e in o)return;zg(n,e,{name:t,index:s,group:r,on:$g,tween:jg,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:hc})}function Si(n,t){var e=jt(n,t);if(e.state>hc)throw new Error("too late; already scheduled");return e}function Zt(n,t){var e=jt(n,t);if(e.state>rs)throw new Error("too late; already running");return e}function jt(n,t){var e=n.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function zg(n,t,e){var s=n.__transition,r;s[t]=e,e.timer=lc(i,0,e.time);function i(u){e.state=co,e.timer.restart(o,e.delay,e.time),e.delay<=u&&o(u-e.delay)}function o(u){var l,h,f,d;if(e.state!==co)return c();for(l in s)if(d=s[l],d.name===e.name){if(d.state===rs)return ao(o);d.state===uo?(d.state=is,d.timer.stop(),d.on.call("interrupt",n,n.__data__,d.index,d.group),delete s[l]):+l<t&&(d.state=is,d.timer.stop(),d.on.call("cancel",n,n.__data__,d.index,d.group),delete s[l])}if(ao(function(){e.state===rs&&(e.state=uo,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=kr,e.on.call("start",n,n.__data__,e.index,e.group),e.state===kr){for(e.state=rs,r=new Array(f=e.tween.length),l=0,h=-1;l<f;++l)(d=e.tween[l].value.call(n,n.__data__,e.index,e.group))&&(r[++h]=d);r.length=h+1}}function a(u){for(var l=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(c),e.state=Ar,1),h=-1,f=r.length;++h<f;)r[h].call(n,l);e.state===Ar&&(e.on.call("end",n,n.__data__,e.index,e.group),c())}function c(){e.state=is,e.timer.stop(),delete s[t];for(var u in s)return;delete n.__transition}}function Gg(n,t){var e=n.__transition,s,r,i=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((s=e[o]).name!==t){i=!1;continue}r=s.state>kr&&s.state<Ar,s.state=is,s.timer.stop(),s.on.call(r?"interrupt":"cancel",n,n.__data__,s.index,s.group),delete e[o]}i&&delete n.__transition}}function Xg(n){return this.each(function(){Gg(this,n)})}function Hg(n,t){var e,s;return function(){var r=Zt(this,n),i=r.tween;if(i!==e){s=e=i;for(var o=0,a=s.length;o<a;++o)if(s[o].name===t){s=s.slice(),s.splice(o,1);break}}r.tween=s}}function Yg(n,t,e){var s,r;if(typeof e!="function")throw new Error;return function(){var i=Zt(this,n),o=i.tween;if(o!==s){r=(s=o).slice();for(var a={name:t,value:e},c=0,u=r.length;c<u;++c)if(r[c].name===t){r[c]=a;break}c===u&&r.push(a)}i.tween=r}}function Zg(n,t){var e=this._id;if(n+="",arguments.length<2){for(var s=jt(this.node(),e).tween,r=0,i=s.length,o;r<i;++r)if((o=s[r]).name===n)return o.value;return null}return this.each((t==null?Hg:Yg)(e,n,t))}function Ci(n,t,e){var s=n._id;return n.each(function(){var r=Zt(this,s);(r.value||(r.value={}))[t]=e.apply(this,arguments)}),function(r){return jt(r,s).value[t]}}function fc(n,t){var e;return(typeof t=="number"?Rt:t instanceof Ie?Cs:(e=Ie(t))?(t=e,Cs):ic)(n,t)}function Qg(n){return function(){this.removeAttribute(n)}}function Jg(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Kg(n,t,e){var s,r=e+"",i;return function(){var o=this.getAttribute(n);return o===r?null:o===s?i:i=t(s=o,e)}}function t_(n,t,e){var s,r=e+"",i;return function(){var o=this.getAttributeNS(n.space,n.local);return o===r?null:o===s?i:i=t(s=o,e)}}function e_(n,t,e){var s,r,i;return function(){var o,a=e(this),c;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),c=a+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a)))}}function n_(n,t,e){var s,r,i;return function(){var o,a=e(this),c;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),c=a+"",o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a)))}}function s_(n,t){var e=Qs(n),s=e==="transform"?qg:fc;return this.attrTween(n,typeof t=="function"?(e.local?n_:e_)(e,s,Ci(this,"attr."+n,t)):t==null?(e.local?Jg:Qg)(e):(e.local?t_:Kg)(e,s,t))}function r_(n,t){return function(e){this.setAttribute(n,t.call(this,e))}}function i_(n,t){return function(e){this.setAttributeNS(n.space,n.local,t.call(this,e))}}function o_(n,t){var e,s;function r(){var i=t.apply(this,arguments);return i!==s&&(e=(s=i)&&i_(n,i)),e}return r._value=t,r}function a_(n,t){var e,s;function r(){var i=t.apply(this,arguments);return i!==s&&(e=(s=i)&&r_(n,i)),e}return r._value=t,r}function c_(n,t){var e="attr."+n;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var s=Qs(n);return this.tween(e,(s.local?o_:a_)(s,t))}function u_(n,t){return function(){Si(this,n).delay=+t.apply(this,arguments)}}function l_(n,t){return t=+t,function(){Si(this,n).delay=t}}function h_(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?u_:l_)(t,n)):jt(this.node(),t).delay}function f_(n,t){return function(){Zt(this,n).duration=+t.apply(this,arguments)}}function d_(n,t){return t=+t,function(){Zt(this,n).duration=t}}function p_(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?f_:d_)(t,n)):jt(this.node(),t).duration}function m_(n,t){if(typeof t!="function")throw new Error;return function(){Zt(this,n).ease=t}}function g_(n){var t=this._id;return arguments.length?this.each(m_(t,n)):jt(this.node(),t).ease}function __(n,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;Zt(this,n).ease=e}}function y_(n){if(typeof n!="function")throw new Error;return this.each(__(this._id,n))}function v_(n){typeof n!="function"&&(n=Ga(n));for(var t=this._groups,e=t.length,s=new Array(e),r=0;r<e;++r)for(var i=t[r],o=i.length,a=s[r]=[],c,u=0;u<o;++u)(c=i[u])&&n.call(c,c.__data__,u,i)&&a.push(c);return new se(s,this._parents,this._name,this._id)}function w_(n){if(n._id!==this._id)throw new Error;for(var t=this._groups,e=n._groups,s=t.length,r=e.length,i=Math.min(s,r),o=new Array(s),a=0;a<i;++a)for(var c=t[a],u=e[a],l=c.length,h=o[a]=new Array(l),f,d=0;d<l;++d)(f=c[d]||u[d])&&(h[d]=f);for(;a<s;++a)o[a]=t[a];return new se(o,this._parents,this._name,this._id)}function b_(n){return(n+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function T_(n,t,e){var s,r,i=b_(t)?Si:Zt;return function(){var o=i(this,n),a=o.on;a!==s&&(r=(s=a).copy()).on(t,e),o.on=r}}function x_(n,t){var e=this._id;return arguments.length<2?jt(this.node(),e).on.on(n):this.each(T_(e,n,t))}function S_(n){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==n)return;t&&t.removeChild(this)}}function C_(){return this.on("end.remove",S_(this._id))}function k_(n){var t=this._name,e=this._id;typeof n!="function"&&(n=yi(n));for(var s=this._groups,r=s.length,i=new Array(r),o=0;o<r;++o)for(var a=s[o],c=a.length,u=i[o]=new Array(c),l,h,f=0;f<c;++f)(l=a[f])&&(h=n.call(l,l.__data__,f,a))&&("__data__"in l&&(h.__data__=l.__data__),u[f]=h,Ks(u[f],t,e,f,u,jt(l,e)));return new se(i,this._parents,t,e)}function A_(n){var t=this._name,e=this._id;typeof n!="function"&&(n=za(n));for(var s=this._groups,r=s.length,i=[],o=[],a=0;a<r;++a)for(var c=s[a],u=c.length,l,h=0;h<u;++h)if(l=c[h]){for(var f=n.call(l,l.__data__,h,c),d,p=jt(l,e),m=0,g=f.length;m<g;++m)(d=f[m])&&Ks(d,t,e,m,f,p);i.push(f),o.push(l)}return new se(i,o,t,e)}var N_=Wn.prototype.constructor;function I_(){return new N_(this._groups,this._parents)}function M_(n,t){var e,s,r;return function(){var i=Ke(this,n),o=(this.style.removeProperty(n),Ke(this,n));return i===o?null:i===e&&o===s?r:r=t(e=i,s=o)}}function dc(n){return function(){this.style.removeProperty(n)}}function O_(n,t,e){var s,r=e+"",i;return function(){var o=Ke(this,n);return o===r?null:o===s?i:i=t(s=o,e)}}function E_(n,t,e){var s,r,i;return function(){var o=Ke(this,n),a=e(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(n),Ke(this,n))),o===c?null:o===s&&c===r?i:(r=c,i=t(s=o,a))}}function D_(n,t){var e,s,r,i="style."+t,o="end."+i,a;return function(){var c=Zt(this,n),u=c.on,l=c.value[i]==null?a||(a=dc(t)):void 0;(u!==e||r!==l)&&(s=(e=u).copy()).on(o,r=l),c.on=s}}function P_(n,t,e){var s=(n+="")=="transform"?Vg:fc;return t==null?this.styleTween(n,M_(n,s)).on("end.style."+n,dc(n)):typeof t=="function"?this.styleTween(n,E_(n,s,Ci(this,"style."+n,t))).each(D_(this._id,n)):this.styleTween(n,O_(n,s,t),e).on("end.style."+n,null)}function F_(n,t,e){return function(s){this.style.setProperty(n,t.call(this,s),e)}}function R_(n,t,e){var s,r;function i(){var o=t.apply(this,arguments);return o!==r&&(s=(r=o)&&F_(n,o,e)),s}return i._value=t,i}function V_(n,t,e){var s="style."+(n+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,R_(n,t,e??""))}function q_(n){return function(){this.textContent=n}}function U_(n){return function(){var t=n(this);this.textContent=t??""}}function L_(n){return this.tween("text",typeof n=="function"?U_(Ci(this,"text",n)):q_(n==null?"":n+""))}function B_(n){return function(t){this.textContent=n.call(this,t)}}function W_(n){var t,e;function s(){var r=n.apply(this,arguments);return r!==e&&(t=(e=r)&&B_(r)),t}return s._value=n,s}function $_(n){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;return this.tween(t,W_(n))}function j_(){for(var n=this._name,t=this._id,e=pc(),s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,c,u=0;u<a;++u)if(c=o[u]){var l=jt(c,t);Ks(c,n,e,u,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new se(s,this._parents,n,e)}function z_(){var n,t,e=this,s=e._id,r=e.size();return new Promise(function(i,o){var a={value:o},c={value:function(){--r===0&&i()}};e.each(function(){var u=Zt(this,s),l=u.on;l!==n&&(t=(n=l).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),u.on=t}),r===0&&i()})}var G_=0;function se(n,t,e,s){this._groups=n,this._parents=t,this._name=e,this._id=s}function pc(){return++G_}var Qt=Wn.prototype;se.prototype={constructor:se,select:k_,selectAll:A_,selectChild:Qt.selectChild,selectChildren:Qt.selectChildren,filter:v_,merge:w_,selection:I_,transition:j_,call:Qt.call,nodes:Qt.nodes,node:Qt.node,size:Qt.size,empty:Qt.empty,each:Qt.each,on:x_,attr:s_,attrTween:c_,style:P_,styleTween:V_,text:L_,textTween:$_,remove:C_,tween:Zg,delay:h_,duration:p_,ease:g_,easeVarying:y_,end:z_,[Symbol.iterator]:Qt[Symbol.iterator]};function X_(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var H_={time:null,delay:0,duration:250,ease:X_};function Y_(n,t){for(var e;!(e=n.__transition)||!(e=e[t]);)if(!(n=n.parentNode))throw new Error(`transition ${t} not found`);return e}function Z_(n){var t,e;n instanceof se?(t=n._id,n=n._name):(t=pc(),(e=H_).time=xi(),n=n==null?null:n+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],a=o.length,c,u=0;u<a;++u)(c=o[u])&&Ks(c,n,t,u,o,e||Y_(c,t));return new se(s,this._parents,n,t)}Wn.prototype.interrupt=Xg;Wn.prototype.transition=Z_;const Nr=Math.PI,Ir=2*Nr,be=1e-6,Q_=Ir-be;function mc(n){this._+=n[0];for(let t=1,e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function J_(n){let t=Math.floor(n);if(!(t>=0))throw new Error(`invalid digits: ${n}`);if(t>15)return mc;const e=10**t;return function(s){this._+=s[0];for(let r=1,i=s.length;r<i;++r)this._+=Math.round(arguments[r]*e)/e+s[r]}}class K_{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?mc:J_(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,s,r){this._append`Q${+t},${+e},${this._x1=+s},${this._y1=+r}`}bezierCurveTo(t,e,s,r,i,o){this._append`C${+t},${+e},${+s},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(t,e,s,r,i){if(t=+t,e=+e,s=+s,r=+r,i=+i,i<0)throw new Error(`negative radius: ${i}`);let o=this._x1,a=this._y1,c=s-t,u=r-e,l=o-t,h=a-e,f=l*l+h*h;if(this._x1===null)this._append`M${this._x1=t},${this._y1=e}`;else if(f>be)if(!(Math.abs(h*c-u*l)>be)||!i)this._append`L${this._x1=t},${this._y1=e}`;else{let d=s-o,p=r-a,m=c*c+u*u,g=d*d+p*p,_=Math.sqrt(m),w=Math.sqrt(f),T=i*Math.tan((Nr-Math.acos((m+f-g)/(2*_*w)))/2),v=T/w,y=T/_;Math.abs(v-1)>be&&this._append`L${t+v*l},${e+v*h}`,this._append`A${i},${i},0,0,${+(h*d>l*p)},${this._x1=t+y*c},${this._y1=e+y*u}`}}arc(t,e,s,r,i,o){if(t=+t,e=+e,s=+s,o=!!o,s<0)throw new Error(`negative radius: ${s}`);let a=s*Math.cos(r),c=s*Math.sin(r),u=t+a,l=e+c,h=1^o,f=o?r-i:i-r;this._x1===null?this._append`M${u},${l}`:(Math.abs(this._x1-u)>be||Math.abs(this._y1-l)>be)&&this._append`L${u},${l}`,s&&(f<0&&(f=f%Ir+Ir),f>Q_?this._append`A${s},${s},0,1,${h},${t-a},${e-c}A${s},${s},0,1,${h},${this._x1=u},${this._y1=l}`:f>be&&this._append`A${s},${s},0,${+(f>=Nr)},${h},${this._x1=t+s*Math.cos(i)},${this._y1=e+s*Math.sin(i)}`)}rect(t,e,s,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${s=+s}v${+r}h${-s}Z`}toString(){return this._}}function t0(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);return n.text()}function e0(n,t){return fetch(n,t).then(t0)}function n0(n){return(t,e)=>e0(t,e).then(s=>new DOMParser().parseFromString(s,n))}const s0=n0("application/xml");function r0(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Is(n,t){if(!isFinite(n)||n===0)return null;var e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"),s=n.slice(0,e);return[s.length>1?s[0]+s.slice(2):s,+n.slice(e+1)]}function en(n){return n=Is(Math.abs(n)),n?n[1]:NaN}function i0(n,t){return function(e,s){for(var r=e.length,i=[],o=0,a=n[0],c=0;r>0&&a>0&&(c+a+1>s&&(a=Math.max(1,s-c)),i.push(e.substring(r-=a,r+a)),!((c+=a+1)>s));)a=n[o=(o+1)%n.length];return i.reverse().join(t)}}function o0(n){return function(t){return t.replace(/[0-9]/g,function(e){return n[+e]})}}var a0=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ms(n){if(!(t=a0.exec(n)))throw new Error("invalid format: "+n);var t;return new ki({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ms.prototype=ki.prototype;function ki(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}ki.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function c0(n){t:for(var t=n.length,e=1,s=-1,r;e<t;++e)switch(n[e]){case".":s=r=e;break;case"0":s===0&&(s=e),r=e;break;default:if(!+n[e])break t;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(r+1):n}var Os;function u0(n,t){var e=Is(n,t);if(!e)return Os=void 0,n.toPrecision(t);var s=e[0],r=e[1],i=r-(Os=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=s.length;return i===o?s:i>o?s+new Array(i-o+1).join("0"):i>0?s.slice(0,i)+"."+s.slice(i):"0."+new Array(1-i).join("0")+Is(n,Math.max(0,t+i-1))[0]}function lo(n,t){var e=Is(n,t);if(!e)return n+"";var s=e[0],r=e[1];return r<0?"0."+new Array(-r).join("0")+s:s.length>r+1?s.slice(0,r+1)+"."+s.slice(r+1):s+new Array(r-s.length+2).join("0")}const ho={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:r0,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>lo(n*100,t),r:lo,s:u0,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function fo(n){return n}var po=Array.prototype.map,mo=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function l0(n){var t=n.grouping===void 0||n.thousands===void 0?fo:i0(po.call(n.grouping,Number),n.thousands+""),e=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",r=n.decimal===void 0?".":n.decimal+"",i=n.numerals===void 0?fo:o0(po.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function u(h,f){h=Ms(h);var d=h.fill,p=h.align,m=h.sign,g=h.symbol,_=h.zero,w=h.width,T=h.comma,v=h.precision,y=h.trim,b=h.type;b==="n"?(T=!0,b="g"):ho[b]||(v===void 0&&(v=12),y=!0,b="g"),(_||d==="0"&&p==="=")&&(_=!0,d="0",p="=");var S=(f&&f.prefix!==void 0?f.prefix:"")+(g==="$"?e:g==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():""),x=(g==="$"?s:/[%p]/.test(b)?o:"")+(f&&f.suffix!==void 0?f.suffix:""),N=ho[b],A=/[defgprs%]/.test(b);v=v===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function k(C){var M=S,I=x,P,E,D;if(b==="c")I=N(C)+I,C="";else{C=+C;var $=C<0||1/C<0;if(C=isNaN(C)?c:N(Math.abs(C),v),y&&(C=c0(C)),$&&+C==0&&m!=="+"&&($=!1),M=($?m==="("?m:a:m==="-"||m==="("?"":m)+M,I=(b==="s"&&!isNaN(C)&&Os!==void 0?mo[8+Os/3]:"")+I+($&&m==="("?")":""),A){for(P=-1,E=C.length;++P<E;)if(D=C.charCodeAt(P),48>D||D>57){I=(D===46?r+C.slice(P+1):C.slice(P))+I,C=C.slice(0,P);break}}}T&&!_&&(C=t(C,1/0));var F=M.length+C.length+I.length,R=F<w?new Array(w-F+1).join(d):"";switch(T&&_&&(C=t(R+C,R.length?w-I.length:1/0),R=""),p){case"<":C=M+C+I+R;break;case"=":C=M+R+C+I;break;case"^":C=R.slice(0,F=R.length>>1)+M+C+I+R.slice(F);break;default:C=R+M+C+I;break}return i(C)}return k.toString=function(){return h+""},k}function l(h,f){var d=Math.max(-8,Math.min(8,Math.floor(en(f)/3)))*3,p=Math.pow(10,-d),m=u((h=Ms(h),h.type="f",h),{suffix:mo[8+d/3]});return function(g){return m(p*g)}}return{format:u,formatPrefix:l}}var Jn,gc,_c;h0({thousands:",",grouping:[3],currency:["$",""]});function h0(n){return Jn=l0(n),gc=Jn.format,_c=Jn.formatPrefix,Jn}function f0(n){return Math.max(0,-en(Math.abs(n)))}function d0(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(en(t)/3)))*3-en(Math.abs(n)))}function p0(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,en(t)-en(n))+1}function m0(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function g0(n){return function(){return n}}function _0(n){return+n}var go=[0,1];function Be(n){return n}function Mr(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:g0(isNaN(t)?NaN:.5)}function y0(n,t){var e;return n>t&&(e=n,n=t,t=e),function(s){return Math.max(n,Math.min(t,s))}}function v0(n,t,e){var s=n[0],r=n[1],i=t[0],o=t[1];return r<s?(s=Mr(r,s),i=e(o,i)):(s=Mr(s,r),i=e(i,o)),function(a){return i(s(a))}}function w0(n,t,e){var s=Math.min(n.length,t.length)-1,r=new Array(s),i=new Array(s),o=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<s;)r[o]=Mr(n[o],n[o+1]),i[o]=e(t[o],t[o+1]);return function(a){var c=Sp(n,a,1,s)-1;return i[c](r[c](a))}}function b0(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function T0(){var n=go,t=go,e=Ti,s,r,i,o=Be,a,c,u;function l(){var f=Math.min(n.length,t.length);return o!==Be&&(o=y0(n[0],n[f-1])),a=f>2?w0:v0,c=u=null,h}function h(f){return f==null||isNaN(f=+f)?i:(c||(c=a(n.map(s),t,e)))(s(o(f)))}return h.invert=function(f){return o(r((u||(u=a(t,n.map(s),Rt)))(f)))},h.domain=function(f){return arguments.length?(n=Array.from(f,_0),l()):n.slice()},h.range=function(f){return arguments.length?(t=Array.from(f),l()):t.slice()},h.rangeRound=function(f){return t=Array.from(f),e=Pg,l()},h.clamp=function(f){return arguments.length?(o=f?!0:Be,l()):o!==Be},h.interpolate=function(f){return arguments.length?(e=f,l()):e},h.unknown=function(f){return arguments.length?(i=f,h):i},function(f,d){return s=f,r=d,l()}}function x0(){return T0()(Be,Be)}function S0(n,t,e,s){var r=Ip(n,t,e),i;switch(s=Ms(s??",f"),s.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(t));return s.precision==null&&!isNaN(i=d0(r,o))&&(s.precision=i),_c(s,o)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(i=p0(r,Math.max(Math.abs(n),Math.abs(t))))&&(s.precision=i-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(i=f0(r))&&(s.precision=i-(s.type==="%")*2);break}}return gc(s)}function C0(n){var t=n.domain;return n.ticks=function(e){var s=t();return Np(s[0],s[s.length-1],e??10)},n.tickFormat=function(e,s){var r=t();return S0(r[0],r[r.length-1],e??10,s)},n.nice=function(e){e==null&&(e=10);var s=t(),r=0,i=s.length-1,o=s[r],a=s[i],c,u,l=10;for(a<o&&(u=o,o=a,a=u,u=r,r=i,i=u);l-- >0;){if(u=wr(o,a,e),u===c)return s[r]=o,s[i]=a,t(s);if(u>0)o=Math.floor(o/u)*u,a=Math.ceil(a/u)*u;else if(u<0)o=Math.ceil(o*u)/u,a=Math.floor(a*u)/u;else break;c=u}return n},n}function Es(){var n=x0();return n.copy=function(){return b0(n,Es())},m0.apply(n,arguments),C0(n)}function Re(n){return function(){return n}}function k0(n){let t=3;return n.digits=function(e){if(!arguments.length)return t;if(e==null)t=null;else{const s=Math.floor(e);if(!(s>=0))throw new RangeError(`invalid digits: ${e}`);t=s}return n},()=>new K_(t)}function A0(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function yc(n){this._context=n}yc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;default:this._context.lineTo(n,t);break}}};function N0(n){return new yc(n)}function I0(n){return n[0]}function M0(n){return n[1]}function O0(n,t){var e=Re(!0),s=null,r=N0,i=null,o=k0(a);n=typeof n=="function"?n:n===void 0?I0:Re(n),t=typeof t=="function"?t:t===void 0?M0:Re(t);function a(c){var u,l=(c=A0(c)).length,h,f=!1,d;for(s==null&&(i=r(d=o())),u=0;u<=l;++u)!(u<l&&e(h=c[u],u,c))===f&&((f=!f)?i.lineStart():i.lineEnd()),f&&i.point(+n(h,u,c),+t(h,u,c));if(d)return i=null,d+""||null}return a.x=function(c){return arguments.length?(n=typeof c=="function"?c:Re(+c),a):n},a.y=function(c){return arguments.length?(t=typeof c=="function"?c:Re(+c),a):t},a.defined=function(c){return arguments.length?(e=typeof c=="function"?c:Re(!!c),a):e},a.curve=function(c){return arguments.length?(r=c,s!=null&&(i=r(s)),a):r},a.context=function(c){return arguments.length?(c==null?s=i=null:i=r(s=c),a):s},a}function wn(n,t,e){this.k=n,this.x=t,this.y=e}wn.prototype={constructor:wn,scale:function(n){return n===1?this:new wn(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new wn(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};wn.prototype;const os={1:{groupId:"String 1",centerY:244.16,startX:234.55,endX:1207.16,rectHeight:4.703,colors:["#FFFFFF","#C0C0C0","#626262","#383838","#1A1A1A"]},2:{groupId:"String 2",centerY:264.73,startX:234.54,endX:1207.6,rectHeight:4.788,colors:["#F8E8E0","#D8A8A0","#B06058","#783830","#381818"]},3:{groupId:"String 3",centerY:285.31,startX:234.54,endX:1207.6,rectHeight:4.871,colors:["#F8E0C8","#D8B088","#A87048","#704828","#382010"]},4:{groupId:"String 4",centerY:305.89,startX:234.54,endX:1207.6,rectHeight:4.703,colors:["#FFE8B0","#FFC868","#E89018","#A06008","#584000"]},5:{groupId:"String 5",centerY:326.47,startX:234.46,endX:1207.6,rectHeight:4.703,colors:["#FFF0D8","#F0D0A0","#D8A860","#987840","#585030"]},6:{groupId:"String 6",centerY:347.04,startX:234.62,endX:1207.23,rectHeight:4.703,colors:["#FFFFFF","#F0ECE4","#D8D4C8","#A09C90","#606058"]}},E0={1:1153.6,2:1098.6,3:1045.6,4:996.6,5:954.6,6:914.6,7:875.6,8:838.6,9:804.6,10:775.6,11:749.6,12:724.6,13:700.6,14:676.6,15:653.6,16:630.6,17:609.6},rr=60,D0={1:2,2:2.3,3:2.6,4:3,5:3.5,6:4},P0={1:40,2:35,3:30,4:26,5:22,6:18};class F0{svg;stringsGroup;vibrationState={};stringPaths={};initialized=!1;constructor(t){this.svg=$n(t),this.stringsGroup=this.svg.select("#Strings_2");for(let e=1;e<=6;e++)this.vibrationState[e]={active:!1,noteStartTime:0,noteDuration:1,fret:0,velocity:1};this.initStrings()}initStrings(){const t=this.svg.select("defs");for(let e=1;e<=6;e++){const s=os[e];if(!s)continue;this.stringsGroup.select(`#${CSS.escape(s.groupId)}`).attr("display","none");const r=`string-metallic-${e}`,i=s.rectHeight/2,o=t.append("linearGradient").attr("id",r).attr("x1","0").attr("y1",String(s.centerY-i)).attr("x2","0").attr("y2",String(s.centerY+i)).attr("gradientUnits","userSpaceOnUse"),[a,c,u,l,h]=s.colors;o.append("stop").attr("offset","0%").attr("stop-color",a),o.append("stop").attr("offset","25%").attr("stop-color",c),o.append("stop").attr("offset","50%").attr("stop-color",u),o.append("stop").attr("offset","78%").attr("stop-color",l),o.append("stop").attr("offset","100%").attr("stop-color",h);const f=this.stringsGroup.append("path").attr("fill","none").attr("stroke","black").attr("stroke-opacity",.18).attr("stroke-width",1).attr("stroke-linecap","round"),d=this.stringsGroup.append("path").attr("fill","none").attr("stroke",`url(#${r})`).attr("stroke-width",s.rectHeight).attr("stroke-linecap","round"),p=this.stringsGroup.append("path").attr("fill","none").attr("stroke","white").attr("stroke-opacity",.3).attr("stroke-width",1).attr("stroke-linecap","round");this.stringPaths[e]={basePath:d,highlightPath:p,shadowPath:f},this.drawStraightString(e)}this.initialized=!0}drawStraightString(t){const e=os[t],s=this.stringPaths[t];if(!e||!s)return;const{startX:r,endX:i,centerY:o,rectHeight:a}=e,c=a/2,u=r+c,l=i-c;s.basePath.attr("d",`M${u},${o}L${l},${o}`),s.highlightPath.attr("d",`M${u},${o-c+.5}L${l},${o-c+.5}`),s.shadowPath.attr("d",`M${u},${o+c-.5}L${l},${o+c-.5}`)}updateStringPaths(t,e){const s=this.vibrationState[t],r=os[t],i=this.stringPaths[t];if(!r||!i)return;if(!s.active){this.drawStraightString(t);return}const o=Math.min(1,(e-s.noteStartTime)/s.noteDuration),a=D0[t]*s.velocity*Math.exp(-4.5*o);if(a<.05){this.drawStraightString(t),s.active=!1;return}const{startX:c,endX:u,centerY:l,rectHeight:h}=r,f=h/2,d=c+f,p=u-f,m=P0[t],g=e,_=s.fret>0?E0[s.fret]:null,T=(_!==null?_:p)-d,v=[],y=[],b=[];for(let S=0;S<=rr;S++){const x=d+T*S/rr,N=S/rr,A=Math.sin(1*Math.PI*N)*Math.sin(m*g),k=.4*Math.sin(2*Math.PI*N)*Math.sin(m*1.7*g),C=.15*Math.sin(3*Math.PI*N)*Math.sin(m*2.8*g),M=a*(A+k+C),I=S===0?"M":"L";v.push(`${I}${x.toFixed(1)},${(l+M).toFixed(2)}`),y.push(`${I}${x.toFixed(1)},${(l-f+.5+M).toFixed(2)}`),b.push(`${I}${x.toFixed(1)},${(l+f-.5+M).toFixed(2)}`)}_!==null&&(v.push(`L${p},${l}`),y.push(`L${p},${l-f+.5}`),b.push(`L${p},${l+f-.5}`)),i.basePath.attr("d",v.join("")),i.highlightPath.attr("d",y.join("")),i.shadowPath.attr("d",b.join(""))}updateAll(t,e){if(!this.initialized)return;const s={};for(const r of e){const i=s[r.string];(!i||r.time>i.time)&&(s[r.string]=r)}for(let r=1;r<=6;r++){const i=s[r],o=this.vibrationState[r];i?(!o.active||i.time!==o.noteStartTime||i.fret!==o.fret)&&(o.active=!0,o.noteStartTime=i.time,o.noteDuration=i.duration,o.fret=i.fret,o.velocity=i.velocity??1):o.active&&(t-o.noteStartTime)/o.noteDuration>=1&&(o.active=!1),this.updateStringPaths(r,t)}}stopAll(){for(let t=1;t<=6;t++)this.vibrationState[t].active=!1,this.drawStraightString(t)}}const ir={1:244.16,2:264.73,3:285.31,4:305.89,5:326.47,6:347.04},R0={1:"#2B2222",2:"#801110",3:"#8C3C24",4:"#FE8601",5:"#E7A85D",6:"#EAE5D5"},_o={1:1153.6,2:1098.6,3:1045.6,4:996.6,5:954.6,6:914.6,7:875.6,8:838.6,9:804.6,10:775.6,11:749.6,12:724.6,13:700.6,14:676.6,15:653.6,16:630.6,17:609.6},V0=1210,q0=481,U0=7.443,L0=6,B0=.2,W0=.06,yo=.15;function fn(n){return 1-(1-n)*(1-n)}function $0(n){if(n<=0)return null;const t=_o[n];if(t===void 0)return null;const e=n===1?V0:_o[n-1];return e===void 0?null:(t+e)/2}function j0(n){const t={};for(const e of n){const s=t[e.string];(!s||e.time>s.time)&&(t[e.string]=e)}return Object.values(t)}class z0{svg;fingersGroup;strumsGroup;stringAnimator;notes=[];playStartTime=0;isActive=!1;songEndTime=0;fingerStates={};fingerCircles={};constructor(t){this.svg=$n(t),this.stringAnimator=new F0(t),this.initGroups();for(let e=1;e<=6;e++)this.fingerStates[e]={visible:!1,currentX:0,targetX:0,animStartX:0,animStartElapsed:0,lastKnownFretX:null,fadePhase:"stable",fadeStartElapsed:0},this.fingerCircles[e]=null}initGroups(){this.svg.select("#Fingers").attr("display","none"),this.svg.select("#Strum").attr("display","none"),this.createFingerGradient();const t=this.svg.select("#Guitar");this.strumsGroup=t.append("g").attr("id","dynamic-strums"),this.fingersGroup=t.append("g").attr("id","dynamic-fingers")}createFingerGradient(){const t=this.svg.select("defs"),e="dynamic-finger-stroke";t.select(`#${e}`).empty()&&t.append("linearGradient").attr("id",e).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data([{offset:"0%",color:"white"},{offset:"100%",color:"#999999"}]).enter().append("stop").attr("offset",s=>s.offset).attr("stop-color",s=>s.color)}async load(t,e=1){this.notes=[];let s=0;t.tracks.forEach(r=>{r.notes.forEach(i=>{this.notes.push({key:`n${s++}`,time:i.time,duration:i.duration*e,string:i.string,fret:i.fret,velocity:i.velocity})})}),this.notes.sort((r,i)=>r.time-i.time),this.songEndTime=this.notes.length>0?Math.max(...this.notes.map(r=>r.time+r.duration)):0}start(t){this.playStartTime=t,this.isActive=!0}hideFingerCircle(t){const e=this.fingerCircles[t];e&&(e.remove(),this.fingerCircles[t]=null),this.fingerStates[t].visible=!1}updateFingerCircles(t,e){const s={};for(const r of e){const i=s[r.string];(!i||r.time>i.time)&&(s[r.string]=r)}for(let r=1;r<=6;r++){const i=s[r],o=this.fingerStates[r],a=this.fingerCircles[r];let c=null,u=!1;if(i&&(i.fret>0?c=$0(i.fret):u=!0),o.fadePhase==="out")if(c!==null)o.fadePhase="in",o.fadeStartElapsed=t;else{const h=Math.min(1,(t-o.fadeStartElapsed)/yo);a?.attr("fill-opacity",(1-fn(h))*.55),a?.attr("stroke-opacity",1-fn(h)),h>=1&&this.hideFingerCircle(r);continue}if(c===null){u&&o.visible&&(o.fadePhase="out",o.fadeStartElapsed=t,o.lastKnownFretX=null);continue}if(o.visible)c!==o.targetX&&(o.animStartX=o.currentX,o.targetX=c,o.animStartElapsed=t);else{const h=o.lastKnownFretX,d=h!==null&&h!==c?h:c;o.currentX=d,o.animStartX=d,o.targetX=c,o.animStartElapsed=t,o.fadePhase="in",o.fadeStartElapsed=t,o.visible=!0,this.fingerCircles[r]=this.fingersGroup.append("circle").attr("cx",d).attr("cy",ir[r]).attr("r",U0).attr("fill",R0[r]).attr("fill-opacity",0).attr("stroke-opacity",0).attr("stroke","url(#dynamic-finger-stroke)").attr("stroke-width",1.2)}const l=Math.min(1,Math.max(0,(t-o.animStartElapsed)/W0));if(o.currentX=o.animStartX+(o.targetX-o.animStartX)*fn(l),this.fingerCircles[r].attr("cx",o.currentX),o.fadePhase==="in"){const h=Math.min(1,(t-o.fadeStartElapsed)/yo);this.fingerCircles[r].attr("fill-opacity",fn(h)*.55),this.fingerCircles[r].attr("stroke-opacity",fn(h)),h>=1&&(o.fadePhase="stable")}o.lastKnownFretX=c}}stop(){this.isActive=!1;for(let t=1;t<=6;t++)this.hideFingerCircle(t),this.fingerStates[t].lastKnownFretX=null;this.strumsGroup.selectAll("*").remove(),this.stringAnimator.stopAll()}updateFingersAndStrum(t){if(!this.isActive||this.notes.length===0)return;const e=t-this.playStartTime,s=this.notes.filter(o=>o.time<=e&&e<o.time+o.duration);if(this.stringAnimator.updateAll(e,s),e>=this.songEndTime)for(let o=1;o<=6;o++){const a=this.fingerStates[o];a.visible&&a.fadePhase!=="out"&&(a.fadePhase="out",a.fadeStartElapsed=e)}this.updateFingerCircles(e,s);const r=j0(this.notes.filter(o=>{const a=Math.min(o.duration,B0);return o.time<=e&&e<o.time+a})),i=this.strumsGroup.selectAll("circle").data(r,o=>String(o.string));i.enter().append("circle").attr("cx",q0).attr("cy",o=>ir[o.string]).attr("r",L0).attr("fill","white").attr("fill-opacity",.53),i.attr("cy",o=>ir[o.string]),i.exit().remove()}}const G0="./img/Guitar.svg";class X0{container;visualizer;constructor(t,e){this.container=t,e&&this.container.addEventListener("click",e)}addGuitar(){s0(G0).then(t=>{const e=t.documentElement;e.id="guitar-svg",e.style.zIndex="1";const s=$n(e);s.select("#Fingers").remove(),s.select("#Strum").remove(),this.container.appendChild(e),this.visualizer=new z0(e)})}async load(t,e){this.visualizer&&await this.visualizer.load(t,e)}startVisualization(t){this.visualizer&&this.visualizer.start(t)}updateVisuals(t){this.visualizer&&this.visualizer.updateFingersAndStrum(t)}}class H0{container;width;height;svg;bars;yScale;margin={top:10,right:10,bottom:10,left:10};constructor(t,e=300,s=180){this.width=e,this.height=s;let r=document.querySelector(t);r||(r=document.createElement("div"),r.id=t.replace("#",""),document.body.appendChild(r)),this.container=r,this.container.style.position="absolute",this.container.style.top="20px",this.container.style.right="20px",this.container.style.zIndex="10",this.svg=$n(this.container).append("svg").attr("width",this.width).attr("height",this.height).style("background","rgba(0, 0, 0, 0.8)").style("border-radius","4px").style("border","1px solid rgba(255, 255, 255, 0.3)");const i=this.width-this.margin.left-this.margin.right,o=this.height-this.margin.top-this.margin.bottom;this.yScale=Es().domain([0,255]).range([o,0]);const a=this.svg.append("g").attr("transform",`translate(${this.margin.left}, ${this.margin.top})`),c=64;this.bars=a.selectAll(".bar").data(Mp(c)).enter().append("rect").attr("class","bar").attr("x",(u,l)=>l/c*i).attr("width",i/c-1).attr("y",o).attr("height",0).style("fill",(u,l)=>{const h=l/c,f=h*28,d=75+h*25,p=22+h*33;return`hsl(${f}, ${d}%, ${p}%)`})}updateBars(t){const s=t.fftValues,r=this.downsampleFFT(s,64),i=this.height-this.margin.top-this.margin.bottom;this.bars.data(r).transition().duration(50).attr("y",o=>this.yScale(o)).attr("height",o=>i-this.yScale(o))}downsampleFFT(t,e){const s=Math.ceil(t.length/e),r=[];for(let i=0;i<e;i++){const o=i*s,a=Math.min(o+s,t.length);let c=0;for(let l=o;l<a;l++){const h=Math.max(0,Math.min(255,t[l]+100));c+=h}const u=c/(a-o);r.push(u)}return r}}const Y0=Array.from({length:6},(n,t)=>os[t+1].colors[2]);class Z0{container;width;height;svg;path;stringPaths=[];line;xScale;yScale;margin={top:10,right:10,bottom:10,left:10};constructor(t,e=400,s=150){this.width=e,this.height=s;let r=document.querySelector(t);r||(r=document.createElement("div"),r.id=t.replace("#",""),document.body.appendChild(r)),this.container=r,this.container.style.position="absolute",this.container.style.bottom="20px",this.container.style.right="20px",this.container.style.zIndex="10",this.svg=$n(this.container).append("svg").attr("width",this.width).attr("height",this.height).style("background","rgba(0, 0, 0, 0.8)").style("border-radius","4px").style("border","1px solid rgba(255, 255, 255, 0.3)");const i=this.width-this.margin.left-this.margin.right,o=this.height-this.margin.top-this.margin.bottom;this.xScale=Es().domain([0,512]).range([0,i]),this.yScale=Es().domain([-1,1]).range([o,0]),this.line=O0().x((c,u)=>this.xScale(u)).y(c=>this.yScale(c));const a=this.svg.append("g").attr("transform",`translate(${this.margin.left}, ${this.margin.top})`);for(let c=0;c<6;c++){const u=a.append("path").attr("class",`waveform-string-${c+1}`).style("fill","none").style("stroke",Y0[c]).style("stroke-width",1.2).style("stroke-linecap","round").style("stroke-linejoin","round").style("opacity",.85);this.stringPaths.push(u)}this.path=a.append("path").attr("class","waveform-path").style("fill","none").style("stroke","rgba(255, 255, 255, 0.93)").style("stroke-width",2).style("stroke-linecap","round").style("stroke-linejoin","round")}updateWaveform(t){const e=Array.from(t.waveformValues);this.path.transition().duration(50).attr("d",this.line(e))}updateStringWaveforms(t){for(let e=0;e<this.stringPaths.length;e++){const s=t[e];!s||s.length===0||this.stringPaths[e].transition().duration(50).attr("d",this.line(Array.from(s)))}}}function vo(){const n={G1:"G1","G#1":"Gs1",A1:"A1","A#1":"As1",B1:"B1",C2:"C2","C#2":"Cs2",D2:"D2","D#2":"Ds2",E2:"E2",F2:"F2",G2:"G2",A2:"A2",B2:"B2",C3:"C3",D3:"D3",E3:"E3",F3:"F3","F#3":"Fs3",G3:"G3","G#3":"Gs3",A3:"A3","A#3":"As3",B3:"B3",C4:"C4","C#4":"Cs4",D4:"D4","D#4":"Ds4",E4:"E4",F4:"F4","F#4":"Fs4",G4:"G4",A4:"A4","A#4":"As4",B4:"B4",C5:"C5","C#5":"Cs5",D5:"D5","D#5":"Ds5",E5:"E5",F5:"F5","F#5":"Fs5",G5:"G5","G#5":"Gs5",A5:"A5","A#5":"As5",B5:"B5",C6:"C6"},t={};for(const[e,s]of Object.entries(n))t[e]=`${s}.mp3`;return t}class Q0{sampler;stringSamplers=new Map;synth;isReady=!1;async load(){this.synth=new kn({oscillator:{type:"triangle"},envelope:{attack:.02,decay:.4,sustain:.1,release:.8}});const t=new di({frequency:3e3,type:"lowpass"}).toDestination();this.synth.connect(t);try{this.sampler=new Je({urls:vo(),baseUrl:"./guitar/samples/"}).toDestination();for(let e=1;e<=6;e++){const s=new Je({urls:vo(),baseUrl:"./guitar/samples/"}).toDestination();this.stringSamplers.set(e,s)}await vp(),this.isReady=!0}catch(e){console.error("Failed to create guitar sampler:",e),this.isReady=!0}}play(t,e,s=Ne(),r=.8){try{this.sampler?this.sampler.triggerAttackRelease(t,e,s,r):this.synth&&this.synth.triggerAttackRelease(t,e,s)}catch(i){console.warn("Error playing note, falling back to synth:",i),this.synth&&this.synth.triggerAttackRelease(t,e,s)}}isLoaded(){return this.isReady}getStringSampler(t){return this.stringSamplers.get(t)}playOnString(t,e,s,r=Ne(),i=.8){const o=this.stringSamplers.get(t);try{o?o.triggerAttackRelease(e,s,r,i):this.play(e,s,r,i)}catch(a){console.warn("Error playing note on string sampler, falling back:",a),this.play(e,s,r,i)}}}function J0(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function s(){var r=!1;try{r=this instanceof s}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),e}var ye={},Kn={},or,wo;function K0(){if(wo)return or;wo=1;function n(r){var i=new s(r),o=i.readChunk();if(o.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+o.id+"'";for(var a=t(o.data),c=[],u=0;!i.eof()&&u<a.numTracks;u++){var l=i.readChunk();if(l.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var h=e(l.data);c.push(h)}return{header:a,tracks:c}}function t(r){var i=new s(r),o=i.readUInt16(),a=i.readUInt16(),c={format:o,numTracks:a},u=i.readUInt16();return u&32768?(c.framesPerSecond=256-(u>>8),c.ticksPerFrame=u&255):c.ticksPerBeat=u,c}function e(r){for(var i=new s(r),o=[];!i.eof();){var a=u();o.push(a)}return o;var c;function u(){var l={};l.deltaTime=i.readVarInt();var h=i.readUInt8();if((h&240)===240)if(h===255){l.meta=!0;var f=i.readUInt8(),d=i.readVarInt();switch(f){case 0:if(l.type="sequenceNumber",d!==2)throw"Expected length for sequenceNumber event is 2, got "+d;return l.number=i.readUInt16(),l;case 1:return l.type="text",l.text=i.readString(d),l;case 2:return l.type="copyrightNotice",l.text=i.readString(d),l;case 3:return l.type="trackName",l.text=i.readString(d),l;case 4:return l.type="instrumentName",l.text=i.readString(d),l;case 5:return l.type="lyrics",l.text=i.readString(d),l;case 6:return l.type="marker",l.text=i.readString(d),l;case 7:return l.type="cuePoint",l.text=i.readString(d),l;case 32:if(l.type="channelPrefix",d!=1)throw"Expected length for channelPrefix event is 1, got "+d;return l.channel=i.readUInt8(),l;case 33:if(l.type="portPrefix",d!=1)throw"Expected length for portPrefix event is 1, got "+d;return l.port=i.readUInt8(),l;case 47:if(l.type="endOfTrack",d!=0)throw"Expected length for endOfTrack event is 0, got "+d;return l;case 81:if(l.type="setTempo",d!=3)throw"Expected length for setTempo event is 3, got "+d;return l.microsecondsPerBeat=i.readUInt24(),l;case 84:if(l.type="smpteOffset",d!=5)throw"Expected length for smpteOffset event is 5, got "+d;var p=i.readUInt8(),m={0:24,32:25,64:29,96:30};return l.frameRate=m[p&96],l.hour=p&31,l.min=i.readUInt8(),l.sec=i.readUInt8(),l.frame=i.readUInt8(),l.subFrame=i.readUInt8(),l;case 88:if(l.type="timeSignature",d!=2&&d!=4)throw"Expected length for timeSignature event is 4 or 2, got "+d;return l.numerator=i.readUInt8(),l.denominator=1<<i.readUInt8(),d===4?(l.metronome=i.readUInt8(),l.thirtyseconds=i.readUInt8()):(l.metronome=36,l.thirtyseconds=8),l;case 89:if(l.type="keySignature",d!=2)throw"Expected length for keySignature event is 2, got "+d;return l.key=i.readInt8(),l.scale=i.readUInt8(),l;case 127:return l.type="sequencerSpecific",l.data=i.readBytes(d),l;default:return l.type="unknownMeta",l.data=i.readBytes(d),l.metatypeByte=f,l}}else if(h==240){l.type="sysEx";var d=i.readVarInt();return l.data=i.readBytes(d),l}else if(h==247){l.type="endSysEx";var d=i.readVarInt();return l.data=i.readBytes(d),l}else throw"Unrecognised MIDI event type byte: "+h;else{var g;if((h&128)===0){if(c===null)throw"Running status byte encountered before status byte";g=h,h=c,l.running=!0}else g=i.readUInt8(),c=h;var _=h>>4;switch(l.channel=h&15,_){case 8:return l.type="noteOff",l.noteNumber=g,l.velocity=i.readUInt8(),l;case 9:var w=i.readUInt8();return l.type=w===0?"noteOff":"noteOn",l.noteNumber=g,l.velocity=w,w===0&&(l.byte9=!0),l;case 10:return l.type="noteAftertouch",l.noteNumber=g,l.amount=i.readUInt8(),l;case 11:return l.type="controller",l.controllerType=g,l.value=i.readUInt8(),l;case 12:return l.type="programChange",l.programNumber=g,l;case 13:return l.type="channelAftertouch",l.amount=g,l;case 14:return l.type="pitchBend",l.value=g+(i.readUInt8()<<7)-8192,l;default:throw"Unrecognised MIDI event type: "+_}}}}function s(r){this.buffer=r,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var r=this.buffer[this.pos];return this.pos+=1,r},s.prototype.readInt8=function(){var r=this.readUInt8();return r&128?r-256:r},s.prototype.readUInt16=function(){var r=this.readUInt8(),i=this.readUInt8();return(r<<8)+i},s.prototype.readInt16=function(){var r=this.readUInt16();return r&32768?r-65536:r},s.prototype.readUInt24=function(){var r=this.readUInt8(),i=this.readUInt8(),o=this.readUInt8();return(r<<16)+(i<<8)+o},s.prototype.readInt24=function(){var r=this.readUInt24();return r&8388608?r-16777216:r},s.prototype.readUInt32=function(){var r=this.readUInt8(),i=this.readUInt8(),o=this.readUInt8(),a=this.readUInt8();return(r<<24)+(i<<16)+(o<<8)+a},s.prototype.readBytes=function(r){var i=this.buffer.slice(this.pos,this.pos+r);return this.pos+=r,i},s.prototype.readString=function(r){var i=this.readBytes(r);return String.fromCharCode.apply(null,i)},s.prototype.readVarInt=function(){for(var r=0;!this.eof();){var i=this.readUInt8();if(i&128)r+=i&127,r<<=7;else return r+i}return r},s.prototype.readChunk=function(){var r=this.readString(4),i=this.readUInt32(),o=this.readBytes(i);return{id:r,length:i,data:o}},or=n,or}var ar,bo;function ty(){if(bo)return ar;bo=1;function n(i,o){if(typeof i!="object")throw"Invalid MIDI data";o=o||{};var a=i.header||{},c=i.tracks||[],u,l=c.length,h=new r;for(t(h,a,l),u=0;u<l;u++)e(h,c[u],o);return h.buffer}function t(i,o,a){var c=o.format==null?1:o.format,u=128;o.timeDivision?u=o.timeDivision:o.ticksPerFrame&&o.framesPerSecond?u=-(o.framesPerSecond&255)<<8|o.ticksPerFrame&255:o.ticksPerBeat&&(u=o.ticksPerBeat&32767);var l=new r;l.writeUInt16(c),l.writeUInt16(a),l.writeUInt16(u),i.writeChunk("MThd",l.buffer)}function e(i,o,a){var c=new r,u,l=o.length,h=null;for(u=0;u<l;u++)(a.running===!1||!a.running&&!o[u].running)&&(h=null),h=s(c,o[u],h,a.useByte9ForNoteOff);i.writeChunk("MTrk",c.buffer)}function s(i,o,a,c){var u=o.type,l=o.deltaTime,h=o.text||"",f=o.data||[],d=null;switch(i.writeVarInt(l),u){case"sequenceNumber":i.writeUInt8(255),i.writeUInt8(0),i.writeVarInt(2),i.writeUInt16(o.number);break;case"text":i.writeUInt8(255),i.writeUInt8(1),i.writeVarInt(h.length),i.writeString(h);break;case"copyrightNotice":i.writeUInt8(255),i.writeUInt8(2),i.writeVarInt(h.length),i.writeString(h);break;case"trackName":i.writeUInt8(255),i.writeUInt8(3),i.writeVarInt(h.length),i.writeString(h);break;case"instrumentName":i.writeUInt8(255),i.writeUInt8(4),i.writeVarInt(h.length),i.writeString(h);break;case"lyrics":i.writeUInt8(255),i.writeUInt8(5),i.writeVarInt(h.length),i.writeString(h);break;case"marker":i.writeUInt8(255),i.writeUInt8(6),i.writeVarInt(h.length),i.writeString(h);break;case"cuePoint":i.writeUInt8(255),i.writeUInt8(7),i.writeVarInt(h.length),i.writeString(h);break;case"channelPrefix":i.writeUInt8(255),i.writeUInt8(32),i.writeVarInt(1),i.writeUInt8(o.channel);break;case"portPrefix":i.writeUInt8(255),i.writeUInt8(33),i.writeVarInt(1),i.writeUInt8(o.port);break;case"endOfTrack":i.writeUInt8(255),i.writeUInt8(47),i.writeVarInt(0);break;case"setTempo":i.writeUInt8(255),i.writeUInt8(81),i.writeVarInt(3),i.writeUInt24(o.microsecondsPerBeat);break;case"smpteOffset":i.writeUInt8(255),i.writeUInt8(84),i.writeVarInt(5);var p={24:0,25:32,29:64,30:96},m=o.hour&31|p[o.frameRate];i.writeUInt8(m),i.writeUInt8(o.min),i.writeUInt8(o.sec),i.writeUInt8(o.frame),i.writeUInt8(o.subFrame);break;case"timeSignature":i.writeUInt8(255),i.writeUInt8(88),i.writeVarInt(4),i.writeUInt8(o.numerator);var g=Math.floor(Math.log(o.denominator)/Math.LN2)&255;i.writeUInt8(g),i.writeUInt8(o.metronome),i.writeUInt8(o.thirtyseconds||8);break;case"keySignature":i.writeUInt8(255),i.writeUInt8(89),i.writeVarInt(2),i.writeInt8(o.key),i.writeUInt8(o.scale);break;case"sequencerSpecific":i.writeUInt8(255),i.writeUInt8(127),i.writeVarInt(f.length),i.writeBytes(f);break;case"unknownMeta":o.metatypeByte!=null&&(i.writeUInt8(255),i.writeUInt8(o.metatypeByte),i.writeVarInt(f.length),i.writeBytes(f));break;case"sysEx":i.writeUInt8(240),i.writeVarInt(f.length),i.writeBytes(f);break;case"endSysEx":i.writeUInt8(247),i.writeVarInt(f.length),i.writeBytes(f);break;case"noteOff":var _=c!==!1&&o.byte9||c&&o.velocity==0?144:128;d=_|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.noteNumber),i.writeUInt8(o.velocity);break;case"noteOn":d=144|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.noteNumber),i.writeUInt8(o.velocity);break;case"noteAftertouch":d=160|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.noteNumber),i.writeUInt8(o.amount);break;case"controller":d=176|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.controllerType),i.writeUInt8(o.value);break;case"programChange":d=192|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.programNumber);break;case"channelAftertouch":d=208|o.channel,d!==a&&i.writeUInt8(d),i.writeUInt8(o.amount);break;case"pitchBend":d=224|o.channel,d!==a&&i.writeUInt8(d);var w=8192+o.value,T=w&127,v=w>>7&127;i.writeUInt8(T),i.writeUInt8(v);break;default:throw"Unrecognized event type: "+u}return d}function r(){this.buffer=[]}return r.prototype.writeUInt8=function(i){this.buffer.push(i&255)},r.prototype.writeInt8=r.prototype.writeUInt8,r.prototype.writeUInt16=function(i){var o=i>>8&255,a=i&255;this.writeUInt8(o),this.writeUInt8(a)},r.prototype.writeInt16=r.prototype.writeUInt16,r.prototype.writeUInt24=function(i){var o=i>>16&255,a=i>>8&255,c=i&255;this.writeUInt8(o),this.writeUInt8(a),this.writeUInt8(c)},r.prototype.writeInt24=r.prototype.writeUInt24,r.prototype.writeUInt32=function(i){var o=i>>24&255,a=i>>16&255,c=i>>8&255,u=i&255;this.writeUInt8(o),this.writeUInt8(a),this.writeUInt8(c),this.writeUInt8(u)},r.prototype.writeInt32=r.prototype.writeUInt32,r.prototype.writeBytes=function(i){this.buffer=this.buffer.concat(Array.prototype.slice.call(i,0))},r.prototype.writeString=function(i){var o,a=i.length,c=[];for(o=0;o<a;o++)c.push(i.codePointAt(o));this.writeBytes(c)},r.prototype.writeVarInt=function(i){if(i<0)throw"Cannot write negative variable-length integer";if(i<=127)this.writeUInt8(i);else{var o=i,a=[];for(a.push(o&127),o>>=7;o;){var c=o&127|128;a.push(c),o>>=7}this.writeBytes(a.reverse())}},r.prototype.writeChunk=function(i,o){this.writeString(i),this.writeUInt32(o.length),this.writeBytes(o)},ar=n,ar}var To;function vc(){return To||(To=1,Kn.parseMidi=K0(),Kn.writeMidi=ty()),Kn}var cr={},ve={},xo;function wc(){if(xo)return ve;xo=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.insert=ve.search=void 0;function n(e,s,r){r===void 0&&(r="ticks");var i=0,o=e.length,a=o;if(o>0&&e[o-1][r]<=s)return o-1;for(;i<a;){var c=Math.floor(i+(a-i)/2),u=e[c],l=e[c+1];if(u[r]===s){for(var h=c;h<e.length;h++){var f=e[h];f[r]===s&&(c=h)}return c}else{if(u[r]<s&&l[r]>s)return c;u[r]>s?a=c:u[r]<s&&(i=c+1)}}return-1}ve.search=n;function t(e,s,r){if(r===void 0&&(r="ticks"),e.length){var i=n(e,s[r],r);e.splice(i+1,0,s)}else e.push(s)}return ve.insert=t,ve}var So;function Or(){return So||(So=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Header=n.keySignatureKeys=void 0;var t=wc(),e=new WeakMap;n.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=(function(){function r(i){var o=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",e.set(this,480),i){e.set(this,i.header.ticksPerBeat),i.tracks.forEach(function(c){c.forEach(function(u){u.meta&&(u.type==="timeSignature"?o.timeSignatures.push({ticks:u.absoluteTime,timeSignature:[u.numerator,u.denominator]}):u.type==="setTempo"?o.tempos.push({bpm:6e7/u.microsecondsPerBeat,ticks:u.absoluteTime}):u.type==="keySignature"&&o.keySignatures.push({key:n.keySignatureKeys[u.key+7],scale:u.scale===0?"major":"minor",ticks:u.absoluteTime}))})});var a=0;i.tracks[0].forEach(function(c){a+=c.deltaTime,c.meta&&(c.type==="trackName"?o.name=c.text:(c.type==="text"||c.type==="cuePoint"||c.type==="marker"||c.type==="lyrics")&&o.meta.push({text:c.text,ticks:a,type:c.type}))}),this.update()}}return r.prototype.update=function(){var i=this,o=0,a=0;this.tempos.sort(function(c,u){return c.ticks-u.ticks}),this.tempos.forEach(function(c,u){var l=u>0?i.tempos[u-1].bpm:i.tempos[0].bpm,h=c.ticks/i.ppq-a,f=60/l*h;c.time=f+o,o=c.time,a+=h}),this.timeSignatures.sort(function(c,u){return c.ticks-u.ticks}),this.timeSignatures.forEach(function(c,u){var l=u>0?i.timeSignatures[u-1]:i.timeSignatures[0],h=(c.ticks-l.ticks)/i.ppq,f=h/l.timeSignature[0]/(l.timeSignature[1]/4);l.measures=l.measures||0,c.measures=f+l.measures})},r.prototype.ticksToSeconds=function(i){var o=(0,t.search)(this.tempos,i);if(o!==-1){var a=this.tempos[o],c=a.time,u=(i-a.ticks)/this.ppq;return c+60/a.bpm*u}else{var l=i/this.ppq;return 60/120*l}},r.prototype.ticksToMeasures=function(i){var o=(0,t.search)(this.timeSignatures,i);if(o!==-1){var a=this.timeSignatures[o],c=(i-a.ticks)/this.ppq;return a.measures+c/(a.timeSignature[0]/a.timeSignature[1])/4}else return i/this.ppq/4},Object.defineProperty(r.prototype,"ppq",{get:function(){return e.get(this)},enumerable:!1,configurable:!0}),r.prototype.secondsToTicks=function(i){var o=(0,t.search)(this.tempos,i,"time");if(o!==-1){var a=this.tempos[o],c=a.time,u=i-c,l=u/(60/a.bpm);return Math.round(a.ticks+l*this.ppq)}else{var h=i/.5;return Math.round(h*this.ppq)}},r.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(i){return{bpm:i.bpm,ticks:i.ticks}}),timeSignatures:this.timeSignatures}},r.prototype.fromJSON=function(i){this.name=i.name,this.tempos=i.tempos.map(function(o){return Object.assign({},o)}),this.timeSignatures=i.timeSignatures.map(function(o){return Object.assign({},o)}),this.keySignatures=i.keySignatures.map(function(o){return Object.assign({},o)}),this.meta=i.meta.map(function(o){return Object.assign({},o)}),e.set(this,i.ppq),this.update()},r.prototype.setTempo=function(i){this.tempos=[{bpm:i,ticks:0}],this.update()},r})();n.Header=s})(cr)),cr}var dn={},ur={},Co;function bc(){return Co||(Co=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ControlChange=n.controlChangeIds=n.controlChangeNames=void 0,n.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},n.controlChangeIds=Object.keys(n.controlChangeNames).reduce(function(r,i){return r[n.controlChangeNames[i]]=i,r},{});var t=new WeakMap,e=new WeakMap,s=(function(){function r(i,o){t.set(this,o),e.set(this,i.controllerType),this.ticks=i.absoluteTime,this.value=i.value}return Object.defineProperty(r.prototype,"number",{get:function(){return e.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return n.controlChangeNames[this.number]?n.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){var i=t.get(this);return i.ticksToSeconds(this.ticks)},set:function(i){var o=t.get(this);this.ticks=o.secondsToTicks(i)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},r})();n.ControlChange=s})(ur)),ur}var pn={},ko;function ey(){if(ko)return pn;ko=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.createControlChanges=void 0;var n=bc();function t(){return new Proxy({},{get:function(e,s){if(e[s])return e[s];if(n.controlChangeIds.hasOwnProperty(s))return e[n.controlChangeIds[s]]},set:function(e,s,r){return n.controlChangeIds.hasOwnProperty(s)?e[n.controlChangeIds[s]]=r:e[s]=r,!0}})}return pn.createControlChanges=t,pn}var mn={},Ao;function ny(){if(Ao)return mn;Ao=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.PitchBend=void 0;var n=new WeakMap,t=(function(){function e(s,r){n.set(this,r),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(e.prototype,"time",{get:function(){var s=n.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var r=n.get(this);this.ticks=r.secondsToTicks(s)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e})();return mn.PitchBend=t,mn}var gn={},Jt={},No;function sy(){return No||(No=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.DrumKitByPatchID=Jt.InstrumentFamilyByID=Jt.instrumentByPatchID=void 0,Jt.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],Jt.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],Jt.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),Jt}var Io;function ry(){if(Io)return gn;Io=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.Instrument=void 0;var n=sy(),t=new WeakMap,e=(function(){function s(r,i){if(this.number=0,t.set(this,i),this.number=0,r){var o=r.find(function(a){return a.type==="programChange"});o&&(this.number=o.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?n.DrumKitByPatchID[this.number]:n.instrumentByPatchID[this.number]},set:function(r){var i=n.instrumentByPatchID.indexOf(r);i!==-1&&(this.number=i)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":n.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var r=t.get(this);return r.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(r){this.number=r.number},s})();return gn.Instrument=e,gn}var _n={},Mo;function iy(){if(Mo)return _n;Mo=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.Note=void 0;function n(o){var a=Math.floor(o/12)-1;return t(o)+a.toString()}function t(o){var a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],c=o%12;return a[c]}function e(o){var a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return a.indexOf(o)}var s=(function(){var o=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,a={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(c){var u=o.exec(c),l=u[1],h=u[2],f=a[l.toLowerCase()];return f+(parseInt(h,10)+1)*12}})(),r=new WeakMap,i=(function(){function o(a,c,u){r.set(this,u),this.midi=a.midi,this.velocity=a.velocity,this.noteOffVelocity=c.velocity,this.ticks=a.ticks,this.durationTicks=c.ticks-a.ticks}return Object.defineProperty(o.prototype,"name",{get:function(){return n(this.midi)},set:function(a){this.midi=s(a)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(a){var c=a-this.octave;this.midi+=c*12},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pitch",{get:function(){return t(this.midi)},set:function(a){this.midi=12*(this.octave+1)+e(a)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"duration",{get:function(){var a=r.get(this);return a.ticksToSeconds(this.ticks+this.durationTicks)-a.ticksToSeconds(this.ticks)},set:function(a){var c=r.get(this),u=c.secondsToTicks(this.time+a);this.durationTicks=u-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"time",{get:function(){var a=r.get(this);return a.ticksToSeconds(this.ticks)},set:function(a){var c=r.get(this);this.ticks=c.secondsToTicks(a)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"bars",{get:function(){var a=r.get(this);return a.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),o.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},o})();return _n.Note=i,_n}var Oo;function Eo(){if(Oo)return dn;Oo=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.Track=void 0;var n=wc(),t=bc(),e=ey(),s=ny(),r=ry(),i=iy(),o=new WeakMap,a=(function(){function c(u,l){var h=this;if(this.name="",this.notes=[],this.controlChanges=(0,e.createControlChanges)(),this.pitchBends=[],o.set(this,l),u){var f=u.find(function(v){return v.type==="trackName"});this.name=f?f.text:""}if(this.instrument=new r.Instrument(u,this),this.channel=0,u){for(var d=u.filter(function(v){return v.type==="noteOn"}),p=u.filter(function(v){return v.type==="noteOff"}),m=function(){var v=d.shift();g.channel=v.channel;var y=p.findIndex(function(S){return S.noteNumber===v.noteNumber&&S.absoluteTime>=v.absoluteTime});if(y!==-1){var b=p.splice(y,1)[0];g.addNote({durationTicks:b.absoluteTime-v.absoluteTime,midi:v.noteNumber,noteOffVelocity:b.velocity/127,ticks:v.absoluteTime,velocity:v.velocity/127})}},g=this;d.length;)m();var _=u.filter(function(v){return v.type==="controller"});_.forEach(function(v){h.addCC({number:v.controllerType,ticks:v.absoluteTime,value:v.value/127})});var w=u.filter(function(v){return v.type==="pitchBend"});w.forEach(function(v){h.addPitchBend({ticks:v.absoluteTime,value:v.value/Math.pow(2,13)})});var T=u.find(function(v){return v.type==="endOfTrack"});this.endOfTrackTicks=T!==void 0?T.absoluteTime:void 0}}return c.prototype.addNote=function(u){var l=o.get(this),h=new i.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},l);return Object.assign(h,u),(0,n.insert)(this.notes,h,"ticks"),this},c.prototype.addCC=function(u){var l=o.get(this),h=new t.ControlChange({controllerType:u.number},l);return delete u.number,Object.assign(h,u),Array.isArray(this.controlChanges[h.number])||(this.controlChanges[h.number]=[]),(0,n.insert)(this.controlChanges[h.number],h,"ticks"),this},c.prototype.addPitchBend=function(u){var l=o.get(this),h=new s.PitchBend({},l);return Object.assign(h,u),(0,n.insert)(this.pitchBends,h,"ticks"),this},Object.defineProperty(c.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var u=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,l=0;l<this.notes.length-1;l++){var h=this.notes[l].time+this.notes[l].duration;u<h&&(u=h)}return u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var u=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,l=0;l<this.notes.length-1;l++){var h=this.notes[l].ticks+this.notes[l].durationTicks;u<h&&(u=h)}return u},enumerable:!1,configurable:!0}),c.prototype.fromJSON=function(u){var l=this;this.name=u.name,this.channel=u.channel,this.instrument=new r.Instrument(void 0,this),this.instrument.fromJSON(u.instrument),u.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=u.endOfTrackTicks);for(var h in u.controlChanges)u.controlChanges[h]&&u.controlChanges[h].forEach(function(f){l.addCC({number:f.number,ticks:f.ticks,value:f.value})});u.notes.forEach(function(f){l.addNote({durationTicks:f.durationTicks,midi:f.midi,ticks:f.ticks,velocity:f.velocity})})},c.prototype.toJSON=function(){for(var u={},l=0;l<127;l++)this.controlChanges.hasOwnProperty(l)&&(u[l]=this.controlChanges[l].map(function(f){return f.toJSON()}));var h={channel:this.channel,controlChanges:u,pitchBends:this.pitchBends.map(function(f){return f.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(f){return f.toJSON()})};return this.endOfTrackTicks!==void 0&&(h.endOfTrackTicks=this.endOfTrackTicks),h},c})();return dn.Track=a,dn}var we={};function oy(n){var t=[];return Tc(n,t),t}function Tc(n,t){for(var e=0;e<n.length;e++){var s=n[e];Array.isArray(s)?Tc(s,t):t.push(s)}}const ay=Object.freeze(Object.defineProperty({__proto__:null,flatten:oy},Symbol.toStringTag,{value:"Module"})),cy=J0(ay);var Do;function uy(){if(Do)return we;Do=1;var n=we&&we.__spreadArray||function(_,w,T){if(T||arguments.length===2)for(var v=0,y=w.length,b;v<y;v++)(b||!(v in w))&&(b||(b=Array.prototype.slice.call(w,0,v)),b[v]=w[v]);return _.concat(b||Array.prototype.slice.call(w))};Object.defineProperty(we,"__esModule",{value:!0}),we.encode=void 0;var t=vc(),e=Or(),s=cy;function r(_,w){return[{absoluteTime:_.ticks,channel:w,deltaTime:0,noteNumber:_.midi,type:"noteOn",velocity:Math.floor(_.velocity*127)},{absoluteTime:_.ticks+_.durationTicks,channel:w,deltaTime:0,noteNumber:_.midi,type:"noteOff",velocity:Math.floor(_.noteOffVelocity*127)}]}function i(_){return(0,s.flatten)(_.notes.map(function(w){return r(w,_.channel)}))}function o(_,w){return{absoluteTime:_.ticks,channel:w,controllerType:_.number,deltaTime:0,type:"controller",value:Math.floor(_.value*127)}}function a(_){for(var w=[],T=0;T<127;T++)_.controlChanges.hasOwnProperty(T)&&_.controlChanges[T].forEach(function(v){w.push(o(v,_.channel))});return w}function c(_,w){return{absoluteTime:_.ticks,channel:w,deltaTime:0,type:"pitchBend",value:_.value}}function u(_){var w=[];return _.pitchBends.forEach(function(T){w.push(c(T,_.channel))}),w}function l(_){return{absoluteTime:0,channel:_.channel,deltaTime:0,programNumber:_.instrument.number,type:"programChange"}}function h(_){return{absoluteTime:0,deltaTime:0,meta:!0,text:_,type:"trackName"}}function f(_){return{absoluteTime:_.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/_.bpm),type:"setTempo"}}function d(_){return{absoluteTime:_.ticks,deltaTime:0,denominator:_.timeSignature[1],meta:!0,metronome:24,numerator:_.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function p(_){var w=e.keySignatureKeys.indexOf(_.key);return{absoluteTime:_.ticks,deltaTime:0,key:w+7,meta:!0,scale:_.scale==="major"?0:1,type:"keySignature"}}function m(_){return{absoluteTime:_.ticks,deltaTime:0,meta:!0,text:_.text,type:_.type}}function g(_){var w={header:{format:1,numTracks:_.tracks.length+1,ticksPerBeat:_.header.ppq},tracks:n([n(n(n(n([{absoluteTime:0,deltaTime:0,meta:!0,text:_.header.name,type:"trackName"}],_.header.keySignatures.map(function(T){return p(T)}),!0),_.header.meta.map(function(T){return m(T)}),!0),_.header.tempos.map(function(T){return f(T)}),!0),_.header.timeSignatures.map(function(T){return d(T)}),!0)],_.tracks.map(function(T){return n(n(n([h(T.name),l(T)],i(T),!0),a(T),!0),u(T),!0)}),!0)};return w.tracks=w.tracks.map(function(T){T=T.sort(function(y,b){return y.absoluteTime-b.absoluteTime});var v=0;return T.forEach(function(y){y.deltaTime=y.absoluteTime-v,v=y.absoluteTime,delete y.absoluteTime}),T.push({deltaTime:0,meta:!0,type:"endOfTrack"}),T}),new Uint8Array((0,t.writeMidi)(w))}return we.encode=g,we}var Po;function ly(){return Po||(Po=1,(function(n){var t=ye&&ye.__awaiter||function(h,f,d,p){function m(g){return g instanceof d?g:new d(function(_){_(g)})}return new(d||(d=Promise))(function(g,_){function w(y){try{v(p.next(y))}catch(b){_(b)}}function T(y){try{v(p.throw(y))}catch(b){_(b)}}function v(y){y.done?g(y.value):m(y.value).then(w,T)}v((p=p.apply(h,f||[])).next())})},e=ye&&ye.__generator||function(h,f){var d={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},p,m,g,_;return _={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function w(v){return function(y){return T([v,y])}}function T(v){if(p)throw new TypeError("Generator is already executing.");for(;d;)try{if(p=1,m&&(g=v[0]&2?m.return:v[0]?m.throw||((g=m.return)&&g.call(m),0):m.next)&&!(g=g.call(m,v[1])).done)return g;switch(m=0,g&&(v=[v[0]&2,g.value]),v[0]){case 0:case 1:g=v;break;case 4:return d.label++,{value:v[1],done:!1};case 5:d.label++,m=v[1],v=[0];continue;case 7:v=d.ops.pop(),d.trys.pop();continue;default:if(g=d.trys,!(g=g.length>0&&g[g.length-1])&&(v[0]===6||v[0]===2)){d=0;continue}if(v[0]===3&&(!g||v[1]>g[0]&&v[1]<g[3])){d.label=v[1];break}if(v[0]===6&&d.label<g[1]){d.label=g[1],g=v;break}if(g&&d.label<g[2]){d.label=g[2],d.ops.push(v);break}g[2]&&d.ops.pop(),d.trys.pop();continue}v=f.call(h,d)}catch(y){v=[6,y],m=0}finally{p=g=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Header=n.Track=n.Midi=void 0;var s=vc(),r=Or(),i=Eo(),o=uy(),a=(function(){function h(f){var d=this,p=null;if(f){var m=f instanceof ArrayBuffer?new Uint8Array(f):f;p=(0,s.parseMidi)(m),p.tracks.forEach(function(g){var _=0;g.forEach(function(w){_+=w.deltaTime,w.absoluteTime=_})}),p.tracks=l(p.tracks)}this.header=new r.Header(p),this.tracks=[],f&&(this.tracks=p.tracks.map(function(g){return new i.Track(g,d.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return h.fromUrl=function(f){return t(this,void 0,void 0,function(){var d,p;return e(this,function(m){switch(m.label){case 0:return[4,fetch(f)];case 1:return d=m.sent(),d.ok?[4,d.arrayBuffer()]:[3,3];case 2:return p=m.sent(),[2,new h(p)];case 3:throw new Error("Could not load '".concat(f,"'"))}})})},Object.defineProperty(h.prototype,"name",{get:function(){return this.header.name},set:function(f){this.header.name=f},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"duration",{get:function(){var f=this.tracks.map(function(d){return d.duration});return Math.max.apply(Math,f)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"durationTicks",{get:function(){var f=this.tracks.map(function(d){return d.durationTicks});return Math.max.apply(Math,f)},enumerable:!1,configurable:!0}),h.prototype.addTrack=function(){var f=new i.Track(void 0,this.header);return this.tracks.push(f),f},h.prototype.toArray=function(){return(0,o.encode)(this)},h.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(f){return f.toJSON()})}},h.prototype.fromJSON=function(f){var d=this;this.header=new r.Header,this.header.fromJSON(f.header),this.tracks=f.tracks.map(function(p){var m=new i.Track(void 0,d.header);return m.fromJSON(p),m})},h.prototype.clone=function(){var f=new h;return f.fromJSON(this.toJSON()),f},h})();n.Midi=a;var c=Eo();Object.defineProperty(n,"Track",{enumerable:!0,get:function(){return c.Track}});var u=Or();Object.defineProperty(n,"Header",{enumerable:!0,get:function(){return u.Header}});function l(h){for(var f=[],d=0;d<h.length;d++)for(var p=f.length,m=new Map,g=Array(16).fill(0),_=0,w=h[d];_<w.length;_++){var T=w[_],v=p,y=T.channel;if(y!==void 0){T.type==="programChange"&&(g[y]=T.programNumber);var b=g[y],S="".concat(b," ").concat(y);m.has(S)?v=m.get(S):(v=p+m.size,m.set(S,v))}f[v]||f.push([]),f[v].push(T)}return f}})(ye)),ye}var hy=ly();class fy{sampler;midi;isPlaying=!1;playConfig={durationMultiplier:1,velocityMultiplier:1};constructor(t){this.sampler=t}async load(t,e){this.playConfig=e??this.playConfig;try{const r=await(await fetch(t)).arrayBuffer();this.midi=new hy.Midi(r)}catch(s){throw console.error("Failed to load MIDI file:",s),s}}async play(){if(!this.midi){console.warn("No MIDI file loaded. Call load() first.");return}if(this.isPlaying){console.warn("Already playing MIDI");return}this.isPlaying=!0;const t=Ne();try{this.midi.tracks.forEach(s=>{s.notes.forEach(r=>{this.sampler.play(r.name,r.duration*this.playConfig.durationMultiplier,t+r.time,r.velocity*this.playConfig.velocityMultiplier)})});const e=Math.max(...this.midi.tracks.flatMap(s=>s.notes.map(r=>r.time+r.duration)));setTimeout(()=>{this.isPlaying=!1},e*1e3)}catch(e){console.error("Error playing MIDI:",e),this.isPlaying=!1}}stop(){this.isPlaying=!1}isCurrentlyPlaying(){return this.isPlaying}}class dy{sampler;isPlaying=!1;intervalId;constructor(t){this.sampler=t}play(t,e=2){if(this.isPlaying){console.warn("Loop already playing. Call stop() first.");return}this.isPlaying=!0;const s=Math.min(e*.8,1);this.sampler.play(t,s,Ne()),this.intervalId=setInterval(()=>{this.isPlaying&&this.sampler.play(t,s,Ne())},e*1e3)}stop(){this.isPlaying=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}isCurrentlyPlaying(){return this.isPlaying}}const py=[{type:"json",name:"Loop E2",jsonPath:"./data/loop-e2.json",loop:{intervalSeconds:1}},{type:"json",name:"The Last of Us (JSON)",jsonPath:"./data/the-last-of-us.json",playConfig:{durationMultiplier:2.5,velocityMultiplier:.7}},{type:"json",name:"The Last of Us - String 1 (Loop)",jsonPath:"./data/the-last-of-us-string1.json",loop:{intervalSeconds:2},playConfig:{durationMultiplier:2.5,velocityMultiplier:.7}}];class my{sampler;jsonData;isPlaying=!1;shouldLoop=!1;loopConfig;playTimeoutId;playStartTime=0;onPlayCallback;playConfig={durationMultiplier:1,velocityMultiplier:1};constructor(t){this.sampler=t}async load(t,e,s){this.playConfig=e??this.playConfig,this.loopConfig=s;try{const i=await(await fetch(t)).json();this.jsonData=i}catch(r){throw console.error("Failed to load JSON file:",r),r}}async play(){if(!this.jsonData){console.warn("No JSON file loaded. Call load() first.");return}if(this.isPlaying){console.warn("Already playing JSON data");return}this.isPlaying=!0,this.shouldLoop=!!this.loopConfig;const t=Ne();this.playStartTime=t,this.onPlayCallback?.(this.playStartTime);try{this.jsonData.tracks.forEach(s=>{s.notes.forEach(r=>{this.sampler.playOnString(r.string,r.name,r.duration*this.playConfig.durationMultiplier,t+r.time,r.velocity*this.playConfig.velocityMultiplier)})});const e=Math.max(...this.jsonData.tracks.flatMap(s=>s.notes.map(r=>r.time+r.duration)));this.playTimeoutId=window.setTimeout(()=>{if(this.isPlaying=!1,this.shouldLoop&&this.loopConfig){const s=typeof this.loopConfig=="object"?this.loopConfig.intervalSeconds??e:e;this.playTimeoutId=window.setTimeout(()=>{this.shouldLoop&&this.play()},s*1e3)}},e*1e3)}catch(e){console.error("Error playing JSON data:",e),this.isPlaying=!1}}stop(){this.shouldLoop=!1,this.isPlaying=!1,this.playTimeoutId!==void 0&&(window.clearTimeout(this.playTimeoutId),this.playTimeoutId=void 0)}setLooping(t){this.shouldLoop=t}getLooping(){return this.shouldLoop}isCurrentlyPlaying(){return this.isPlaying}getPlayStartTime(){return this.playStartTime}onPlay(t){this.onPlayCallback=t}}class gy{ctx;isInitialized=!1;fftAnalyzer;waveformAnalyzer;stringWaveformAnalyzers=[];analyzerState={fftValues:new Float32Array(0),waveformValues:new Float32Array(0),stringWaveformValues:Array.from({length:6},()=>new Float32Array(0))};analyzerListeners=[];guitarSampler;midiPlayer;loopPlayer;jsonPlayer;async init(){this.ctx=new(window.AudioContext||window.webkitAudioContext),Fa(this.ctx)}async resumeAudioContext(){if(this.ctx.state==="suspended"&&await this.ctx.resume(),await Qd(),!this.isInitialized){this.isInitialized=!0,await new Promise(t=>setTimeout(t,100)),this.fftAnalyzer=new Tn("fft"),this.fftAnalyzer.size=1024,Hi().connect(this.fftAnalyzer),this.waveformAnalyzer=new Tn("waveform"),this.waveformAnalyzer.size=512,Hi().connect(this.waveformAnalyzer),this.guitarSampler=new Q0,await this.guitarSampler.load();for(let t=1;t<=6;t++){const e=new Tn("waveform");e.size=512;const s=this.guitarSampler.getStringSampler(t);s&&s.connect(e),this.stringWaveformAnalyzers[t-1]=e}this.midiPlayer=new fy(this.guitarSampler),this.loopPlayer=new dy(this.guitarSampler),this.jsonPlayer=new my(this.guitarSampler)}}getAnalyzerState(){return this.analyzerState}onAnalyzerUpdate(t){return this.analyzerListeners.push(t),()=>{this.analyzerListeners=this.analyzerListeners.filter(e=>e!==t)}}updateAnalyzerState(){const t=this.fftAnalyzer.getValue(),e=this.waveformAnalyzer.getValue();this.analyzerState.fftValues=t,this.analyzerState.waveformValues=e;for(let s=0;s<this.stringWaveformAnalyzers.length;s++)this.analyzerState.stringWaveformValues[s]=this.stringWaveformAnalyzers[s].getValue();this.analyzerListeners.forEach(s=>{s(this.analyzerState)})}}(async()=>{const n=new gy;await n.init();const t=new H0("#frequency-plot",300,180),e=new Z0("#waveform-plot",400,150);let s=null,r=null;const i=()=>{const u=()=>{n.updateAnalyzerState(),c.updateVisuals(Ne()),s=requestAnimationFrame(u)};u()},o=()=>{s!==null&&(cancelAnimationFrame(s),s=null)},a=async()=>{await n.resumeAudioContext(),r&&r(),r=n.onAnalyzerUpdate(l=>{t.updateBars(l),e.updateWaveform(l),e.updateStringWaveforms(l.stringWaveformValues)}),o(),i();const u=py[1];{const h=await(await fetch(u.jsonPath)).json();await c.load(h,u.playConfig?.durationMultiplier),await n.jsonPlayer.load(u.jsonPath,u.playConfig,u.loop),n.jsonPlayer.onPlay(f=>c.startVisualization(f)),n.jsonPlayer.play()}},c=new X0(document.getElementById("app"),a);c.addGuitar()})();
